define(["./chunks/vendor-e2ecbc23","./chunks/useClientService-0039200a","./chunks/useAppDefaults-5dde407f","./chunks/functions-31457630","./chunks/useRoute-035af8cd","./chunks/useRequest-915f01e1"],(function(e,t,n,i,r,o){"use strict";const a=e.defineComponent({name:"TextEditor",components:{AppTopBar:e.__vue_component__$4},beforeRouteLeave(e,t,n){if(this.isDirty){const e={variation:"danger",icon:"warning",title:this.$gettext("Unsaved changes"),message:this.$gettext("Your changes were not saved. Do you want to save them?"),cancelText:this.$gettext("Don't Save"),confirmText:this.$gettext("Save"),onCancel:()=>{this.hideModal(),n()},onConfirm:()=>{this.save(),this.hideModal(),n()}};this.createModal(e)}else n()},setup(){const i=n.useAppDefaults({applicationId:"text-editor"}),{applicationConfig:r,currentFileContext:o,getFileResource:a,getFileContents:s,putFileContents:l}=i,d=e.ref(),c=e.ref(),u=e.ref(),h=e.ref(!0),f=e.ref(),p=e.q((function*(){const n=e.unref(o).path;f.value=yield a(e.unref(n),[t.DavProperty.Permissions,t.DavProperty.Name]),h.value=![t.DavPermission.Updateable,t.DavPermission.FileUpdateable].some((e=>(f.value.permissions||"").indexOf(e)>-1));const i=yield s(e.unref(n),{});d.value=c.value=i.body,u.value=i.headers["OC-ETag"]})).restartable();p.perform();const v=e.q((function*(){const t=e.unref(o).path,n=e.unref(c);try{const i=yield l(e.unref(t),n,{previousEntityTag:e.unref(u)});d.value=n,u.value=i["OC-ETag"]}catch(e){switch(e.statusCode){case 412:this.errorPopup(this.$gettext("This file was updated outside this window. Please refresh the page (all changes will be lost)."));break;case 500:this.errorPopup(this.$gettext("Error when contacting the server"));break;case 401:this.errorPopup(this.$gettext("You're not authorized to save this file"));break;default:this.errorPopup(e.message||e)}}})).restartable(),g=e.computed((()=>e.unref(c)&&y?e.sanitizeHtml_1(e.marked_umd.marked(e.unref(c))):null)),m=e.computed((()=>e.unref(d)!==e.unref(c))),w=e.computed((()=>p.isError)),x=e.computed((()=>p.isRunning||v.isRunning)),y=e.computed((()=>"md"===e.unref(P)||!e.unref(b).showPreviewOnlyMd)),P=e.computed((()=>e.unref(e.unref(o).path).split(".").pop())),b=e.computed((()=>{const{showPreviewOnlyMd:t=!0}=e.unref(r);return{showPreviewOnlyMd:t}}));e.onMounted((()=>{document.addEventListener("keydown",D,!1),window.addEventListener("beforeunload",S)})),e.onBeforeUnmount((()=>{window.removeEventListener("beforeunload",S),document.removeEventListener("keydown",D,!1)}));const M=function(){v.perform()},D=function(e){(e.ctrlKey||e.metaKey)&&"KeyS"===e.code&&(e.preventDefault(),M())},S=function(t){e.unref(m)&&(t.preventDefault(),t.returnValue="")};return{...i,loadFileTask:p,saveFileTask:v,isLoading:x,isError:w,showPreview:y,isDirty:m,isReadOnly:h,currentContent:c,renderedMarkdown:g,config:b,resource:f,save:M,handleSKey:D,handleUnload:S}},methods:{...e.mapActions(["createModal","hideModal","showMessage"]),errorPopup(e){this.showMessage({title:this.$gettext("An error occurred"),desc:e,status:"danger"})}}});var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"oc-height-1-1",attrs:{id:"text-editor"}},[n("app-top-bar",{attrs:{resource:e.resource},on:{close:e.closeApp},scopedSlots:e._u([{key:"right",fn:function(){return[e.isLoading?e._e():n("oc-button",{attrs:{id:"text-editor-controls-save","aria-label":e.$gettext("Save"),disabled:e.isReadOnly||!e.isDirty},on:{click:e.save}},[n("oc-icon",{attrs:{name:"save",size:"small"}})],1)]},proxy:!0}])}),e._v(" "),e.isLoading?n("div",{staticClass:"oc-text-center"},[n("oc-spinner",{attrs:{"aria-label":e.$gettext("Loading editor content")}})],1):e.isError?n("div",{staticClass:"oc-text-center"},[n("div",{staticClass:"oc-position-center oc-text-center"},[n("oc-icon",{attrs:{size:"xxlarge",name:"error-warning","fill-type":"line"}})],1)]):n("div",{staticClass:"oc-flex editor-wrapper-height oc-px-s oc-pt-rm oc-pb-s"},[n("div",{staticClass:"oc-height-1-1",class:e.showPreview?"oc-width-1-2":"oc-width-1-1"},[n("oc-textarea",{staticClass:"oc-height-1-1",attrs:{id:"text-editor-input",name:"input","full-width":"",label:"",rows:20,disabled:e.isReadOnly},model:{value:e.currentContent,callback:function(t){e.currentContent=t},expression:"currentContent"}})],1),e._v(" "),e.showPreview?n("div",{staticClass:"oc-container oc-width-1-2"},[n("div",{attrs:{id:"text-editor-preview"},domProps:{innerHTML:e._s(e.renderedMarkdown)}})]):e._e()])],1)};s._withStripped=!0;var l={cs:{Save:"Uložit"},de:{"An error occurred":"Ein Fehler ist aufgetreten","Don't Save":"Verwerfen","Error when contacting the server":"Fehler beim Kontaktieren des Servers",extensionItem:"Erweiterungselement","JavaScript file":"JavaScript-Datei","JSON file":"JSON-Datei","Loading editor content":"Lade Editor Inhalt","Markdown file":"Markdown-Datei",msg:"Nachricht","PHP file":"PHP-Datei","Plain text file":"Text-Datei","Python file":"Python-Datei",Save:"Speichern","Text Editor":"Texteditor","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Die Datei wurde außerhalb des Fensters aktualisiert. Bitte die Seite neu laden (alle Änderungen gehen verloren).","Unsaved changes":"Ungespeicherte Änderungen","XML file":"XML-Datei","YAML file":"YAML-Datei","You're not authorized to save this file":"Keine ausreichenden Berechtigungen für das Speichern der Datei ","Your changes were not saved. Do you want to save them?":"Ungesicherte Änderungen. Möchtest Du sie speichern? "},es:{"Loading editor content":"Cargando el editor de contenido",msg:"msg",Save:"Guardar"},fr:{"An error occurred":"Une erreur est survenue","Don't Save":"Ne pas enregistrer","Error when contacting the server":"Erreur de communication avec le serveur","JavaScript file":"Fichier JavaScript","JSON file":"Fichier JSON","Loading editor content":"Chargement du contenu de l'éditeur","Markdown file":"Fichier Markdown",msg:"msg","PHP file":"Fichier PHP","Plain text file":"Fichier texte brut","Python file":"Fichier Python",Save:"Sauvegarder","Text Editor":"Éditeur de texte","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Ce fichier a été modifié en dehors de cette fenêtre. Veuillez rafraîchir la page (tous les changements seront perdus).","Unsaved changes":"Modifications non enregistrées","XML file":"Fichier XML","YAML file":"Fichier YAML","You're not authorized to save this file":"Vous n'êtes pas autorisé à enregistrer ce fichier","Your changes were not saved. Do you want to save them?":"Les modifications n'ont pas été enregistrées, souhaitez-vous les enregistrer ?"},gl:{msg:"msx",Save:"Gardar"},it:{}};const d="text-editor",c=[{path:"/:filePath*",component:e.normalizeComponent({render:s,staticRenderFns:[]},undefined,a,undefined,false,undefined,!1,void 0,void 0,void 0),name:"text-editor",meta:{title:"Text Editor",auth:!1,patchCleanPath:!0}}];return{appInfo:{name:"Text Editor",id:d,icon:"file-text",isFileEditor:!0,extensions:(()=>{const e=[{extension:"txt",label:"Plain text file"},{extension:"md",label:"Markdown file"},{extension:"js",label:"JavaScript file"},{extension:"json",label:"JSON file"},{extension:"xml",label:"XML file"},{extension:"py",label:"Python file"},{extension:"php",label:"PHP file"},{extension:"yaml",label:"YAML file"}];let t=window.Vue.$store.getters.extensionConfigByAppId(d).primaryExtensions||["txt","md"];return"string"==typeof t&&(t=[t]),e.reduce(((e,n)=>{const i=t.includes(n.extension);return n.canBeDefault=i,i&&(n.newFileMenu={menuTitle:e=>e(n.label)}),e.push(n),e}),[])})().map((e=>({extension:e.extension,...Object.prototype.hasOwnProperty.call(e,"newFileMenu")&&{newFileMenu:e.newFileMenu},...Object.prototype.hasOwnProperty.call(e,"canBeDefault")&&{canBeDefault:e.canBeDefault}})))},routes:c,translations:l}}));
