define(["./chunks/vendor-e2ecbc23","./chunks/useRoute-035af8cd","./chunks/useClientService-0039200a","./chunks/functions-31457630","./chunks/error-45f725fe","./chunks/useRequest-915f01e1","./chunks/loadPreview-ce302639","./chunks/manager-1f78e82e","./chunks/List-f2d4a9c4"],(function(e,t,s,i,a,r,o,n,l){"use strict";const c=()=>{const s=t.useRoute();return e.computed((()=>e.unref(s).name))},d=t=>{const i=s.useRouteQuery(t.name),r=a.useLocalStorage(h(t));return e.watch((()=>e.unref(i)?{value:e.unref(i),source:"route"}:e.unref(r)?{value:e.unref(r),source:"storage"}:{value:t.defaultValue,source:"default"}),(e=>{["route","default"].includes(e.source)&&(r.value=e.value===t.defaultValue?void 0:e.value),["storage","default"].includes(e.source)&&(i.value=e.value)}),{immediate:!0}),i},h=e=>["oc_options",e.routeName,e.name].filter(Boolean).join("_"),u=t=>{const i=t?.bus||e.bus,a=e.ref(!1),r=e.ref(null),o=i.subscribe(s.SideBarEventTopics.toggle,(()=>{a.value=!e.unref(a)})),n=i.subscribe(s.SideBarEventTopics.close,(()=>{a.value=!1,r.value=null})),l=i.subscribe(s.SideBarEventTopics.open,(()=>{a.value=!0,r.value=null})),c=i.subscribe(s.SideBarEventTopics.openWithPanel,(e=>{a.value=!0,r.value=e})),d=i.subscribe(s.SideBarEventTopics.setActivePanel,(e=>{r.value=e}));return e.onBeforeUnmount((()=>{i.unsubscribe(s.SideBarEventTopics.toggle,o),i.unsubscribe(s.SideBarEventTopics.close,n),i.unsubscribe(s.SideBarEventTopics.open,l),i.unsubscribe(s.SideBarEventTopics.openWithPanel,c),i.unsubscribe(s.SideBarEventTopics.setActivePanel,d)})),{sideBarOpen:a,sideBarActivePanel:r}},p=(t,s,i)=>new e.Fuse(t,{includeScore:!0,useExtendedSearch:!0,threshold:.3,keys:["name","type","icon","extension"]}).search(s,{limit:i}).map((e=>e.item)),m=(e,t)=>!(!e||!t)&&e.id===t.id,f=e=>({meta:e.meta,path:e.path,redirect:t=>{const s=e.redirect(t);return console.warn(`route "${e.path}" is deprecated, use "${s.path||s.name}" instead.`),s}}),g={path:"/",redirect:e=>s.createLocationSpaces("files-spaces-personal",e)};const b=e.defineComponent$1({setup(){const i=s.useStore();e.watch(t.useRoute(),((e,t)=>{i.dispatch("Files/resetFileSelection")}))},data:()=>({dragareaEnabled:!1}),created(){const t=e.bus.subscribe("drag-over",this.onDragOver),s=e.bus.subscribe("drag-out",this.hideDropzone),i=e.bus.subscribe("drop",this.hideDropzone);this.$on("beforeDestroy",(()=>{e.bus.unsubscribe("drag-over",t),e.bus.unsubscribe("drag-out",s),e.bus.unsubscribe("drop",i)}))},methods:{hideDropzone(){this.dragareaEnabled=!1},onDragOver(e){this.dragareaEnabled=(e.dataTransfer.types||[]).some((e=>"Files"===e))}}});var v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"files"}},[e.dragareaEnabled?s("div",{staticClass:"dragarea"}):e._e(),e._v(" "),s("router-view",{staticClass:"oc-width-expand",attrs:{tabindex:"0"}})],1)};v._withStripped=!0;const _=e.normalizeComponent({render:v,staticRenderFns:[]},undefined,b,"data-v-93518780",false,undefined,!1,void 0,void 0,void 0);class S{static Thumbnail=[36,36];static Preview=[1200,1200];static Avatar=64}class x{static Thumbnail="thumbnail";static Preview="preview";static Avatar="avatar"}class w{static perPageDefault="100";static perPageQueryName="items-per-page"}function y(t){const s=function(t){if(t.perPage)return e.computed((()=>e.unref(t.perPage)));const s=d({name:w.perPageQueryName,defaultValue:w.perPageDefault});return e.computed((()=>parseInt(String(e.unref(s)))))}(t),i=e.ref(t.page),a=e.computed((()=>Math.ceil(e.unref(t.items).length/e.unref(s))||1));return{items:e.computed((()=>{if(!e.unref(s))return e.unref(t.items);const a=(e.unref(i)-1)*e.unref(s),r=a+e.unref(s);return e.unref(t.items).slice(a,r)})),total:a,perPage:s}}class C{static sortByQueryName="sort-by";static sortDirQueryName="sort-dir"}var $;function E(t){const s=function(t){if(t.sortBy)return e.isRef(t.sortBy)?t.sortBy:e.ref(t.sortBy);return d({name:e.unref(t.sortByQueryName)||C.sortByQueryName,defaultValue:e.unref(R(e.unref(t.fields))?.name),routeName:e.unref(t.routeName||c())})}(t),i=function(t){if(t.sortDir)return e.isRef(t.sortDir)?t.sortDir:e.ref(t.sortDir);return d({name:e.unref(t.sortDirQueryName)||C.sortDirQueryName,defaultValue:e.unref(R(e.unref(t.fields))?.sortDir),routeName:e.unref(t.routeName||c())})}(t),a=e.computed((()=>T(e.unref(s))||e.unref(R(e.unref(o))?.name))),r=e.computed((()=>L(e.unref(i))||k(e.unref(a),e.unref(o)))),o=t.fields;return{items:e.computed((()=>{const s=e.unref(t.items);return e.unref(a)?I(s,e.unref(o),e.unref(a),e.unref(r)):s})),sortBy:a,sortDir:r,handleSort:({sortBy:e,sortDir:t})=>{s.value=e,i.value=t}}}!function(e){e.Desc="desc",e.Asc="asc"}($||($={}));const R=e=>{const t=e.filter((e=>e.sortable));return t?t[0]:null},k=(t,s)=>{const i=s.find((e=>e.name===t));return i&&i.sortDir?e.unref(i.sortDir):$.Desc},I=(e,t,s,i)=>{const a=t.find((e=>e.name===s));if(!a)return e;const{sortable:r}=a,o=new Intl.Collator(navigator.language,{sensitivity:"base",numeric:!0});if("name"===s){const t=[...e.filter((e=>"folder"===e.type))].sort(((e,t)=>F(e,t,o,s,i,r))),a=[...e.filter((e=>"folder"!==e.type))].sort(((e,t)=>F(e,t,o,s,i,r)));return i===$.Asc?t.concat(a):a.concat(t)}return[...e].sort(((e,t)=>F(e,t,o,s,i,r)))},F=(e,t,s,i,a,r)=>{let o=e[i],n=t[i];const l=a===$.Asc?1:-1;if(r)if("string"==typeof r){const e=e=>e.map((e=>e[r])).join("");o=e(o),n=e(n)}else"function"==typeof r&&(o=r(o),n=r(n));if(!isNaN(o)&&!isNaN(n))return(o-n)*l;return s.compare((o||"").toString(),(n||"").toString())*l},T=e=>Array.isArray(e)?e[0]:e,L=e=>{switch(T(e)){case $.Asc:return $.Asc;case $.Desc:return $.Desc}return null},D=t=>e.DateTime_1.fromRFC2822(t).toUTC().valueOf(),A=e=>e?[{name:"name",sortable:!0,sortDir:$.Asc},{name:"size",sortable:!0,sortDir:$.Desc},{name:"sharedWith",sortable:e=>e.length>0&&e[0].displayName,sortDir:$.Asc},{name:"owner",sortable:"displayName",sortDir:$.Asc},{name:"mdate",sortable:e=>D(e),sortDir:$.Desc},{name:"sdate",sortable:e=>D(e),sortDir:$.Desc},{name:"ddate",sortable:e=>D(e),sortDir:$.Desc}].filter((t=>Object.prototype.hasOwnProperty.call(e,t.name))):[],P=t=>{const i=t.store||s.useStore(),a=e.computed({get:()=>i.getters["Files/selectedFiles"],set(e){i.commit("Files/SET_FILE_SELECTION",e)}}),r=e.computed({get:()=>i.state.Files.selectedIds,set(e){i.commit("Files/SET_SELECTED_IDS",e)}});return{selectedResources:a,selectedResourcesIds:r,isResourceInSelection:t=>e.unref(r).includes(t.id)}},M=(t={})=>{const i=t.loadResourcesTask||s.folderService.getTask(),a=e.computed((()=>i.isRunning||!i.last)),r=s.useStore(),{refresh:o,y:n}=(()=>{const t=e.ref(0),s=async()=>{await e.nextTick();const s=document.querySelector("#files-app-bar"),i=s?s.getBoundingClientRect().height:0;t.value!==i&&(t.value=i)};return window.onresize=s,e.onMounted(s),{y:t,refresh:s}})(),l=e.computed((()=>r.getters["Files/activeFiles"]||[])),c=e.computed((()=>A(e.unref(l)[0]))),{sortBy:d,sortDir:h,items:p,handleSort:m}=E({items:l,fields:c}),f=s.useRouteQuery("page","1"),g=e.computed((()=>parseInt(String(f.value)))),{items:b,total:v}=y({page:g,items:p});return((t,i,a)=>{let r;e.onMounted((()=>{r=s.useStore().subscribe((e=>t.includes(e.type)&&i(e)),a)})),e.onBeforeUnmount((()=>r()))})(["Files/UPSERT_RESOURCE"],(async({payload:t})=>{await e.nextTick(),((e,t=3500)=>{const s=document.querySelectorAll(`[data-item-id='${e}']`)[0];s&&(s.classList.add("oc-table-accentuated"),setTimeout((()=>{s.classList.remove("oc-table-accentuated")}),t))})(t.id)})),{fileListHeaderY:n,refreshFileListHeaderPosition:o,loadResourcesTask:i,areResourcesLoading:a,storeItems:l,fields:c,paginatedResources:b,paginationPages:v,paginationPage:g,handleSort:m,sortBy:d,sortDir:h,...P({store:r}),...u()}},O=(i,...a)=>{const r=e.ref(!1),o=s.useRouter(),n=t.useRoute();return e.watch(n,(()=>{r.value=i(o,...a)}),{immediate:!0}),r};var N={computed:{...e.mapGetters("Files",["files","currentFolder"]),...e.mapGetters(["capabilities"]),...e.mapState("Files",["areFileExtensionsShown"]),$_rename_items(){return[{name:"rename",icon:"pencil",label:()=>this.$gettext("Rename"),handler:this.$_rename_trigger,isEnabled:({resources:e})=>{if(s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project"))return!1;if(s.isLocationSharesActive(this.$router,"files-shares-with-me")&&!1===this.capabilities?.files_sharing?.can_rename)return!1;if(1!==e.length)return!1;if(!0===this.capabilities?.spaces?.share_jail&&(s.isLocationSharesActive(this.$router,"files-shares-with-me")||s.isLocationSpacesActive(this.$router,"files-spaces-share")&&"/"===e[0].path))return!1;return!e.some((e=>!e.canRename()))},componentType:"button",class:"oc-files-actions-rename-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapActions("Files",["renameFile"]),async $_rename_trigger({resources:e}){let t;if(m(e[0],this.currentFolder)){const i=e[0].webDavPath.slice(0,-e[0].path.length),a=s.getParentPaths(e[0].path,!1).map((e=>i+e));t=await this.$client.files.list(a[0],1),t=t.map(s.buildResource)}const i=s.extractNameWithoutExtension(e[0]),a=e[0].isFolder||this.areFileExtensionsShown?e[0].name:i,r=this.$gettextInterpolate(e[0].isFolder?this.$gettext("Rename folder %{name}"):this.$gettext("Rename file %{name}"),{name:a}),o=e[0].isFolder||this.areFileExtensionsShown?e[0].name:i,n=e[0].isFolder||!this.areFileExtensionsShown?null:[0,i.length],l={variation:"passive",title:r,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Rename"),hasInput:!0,inputValue:o,inputSelectionRange:n,inputLabel:e[0].isFolder?this.$gettext("Folder name"):this.$gettext("File name"),onCancel:this.hideModal,onConfirm:t=>{this.areFileExtensionsShown||(t=`${t}.${e[0].extension}`),this.$_rename_renameResource(e[0],t)},onInput:s=>{this.areFileExtensionsShown||(s=`${s}.${e[0].extension}`),this.$_rename_checkNewName(e[0],s,t)}};this.createModal(l)},$_rename_checkNewName(e,t,s){const i=e.path.substring(0,e.path.length-e.name.length)+t;if(!t)return this.setModalInputErrorMessage(this.$gettext("The name cannot be empty"));if(/[/]/.test(t))return this.setModalInputErrorMessage(this.$gettext('The name cannot contain "/"'));if("."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to "."'));if(".."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to ".."'));if(/\s+$/.test(t))return this.setModalInputErrorMessage(this.$gettext("The name cannot end with whitespace"));if(!this.flatFileList){if(this.files.find((s=>s.path===i&&e.name!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}if(s){if(s.find((s=>s.path===i&&e.name!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}this.setModalInputErrorMessage(null)},$_rename_renameResource(e,t){this.toggleModalConfirmButton();const s=m(e,this.currentFolder),i=this.$store.getters["runtime/auth/isPublicLinkContextReady"];this.renameFile({client:this.$client,file:e,newValue:t,isPublicLinkContext:i,isSameResource:s}).then((()=>{if(this.hideModal(),s){const s=e.path.slice(1,e.path.lastIndexOf("/")+1);this.$router.push({params:{item:"/"+s+t||"/"},query:this.$route.query})}})).catch((s=>{this.toggleModalConfirmButton();let i=this.$gettext('Failed to rename "%{file}" to "%{newName}"');423===s.statusCode&&(i=this.$gettext('Failed to rename "%{file}" to "%{newName}" - the file is locked'));const a=this.$gettextInterpolate(i,{file:e.name,newName:t},!0);this.showMessage({title:a,status:"danger"})}))}}};class B{static Cut="cut";static Copy="copy"}const U=e=>(e||"").split("_")[0],z=(t,s,i=e.DateTime_1.DATETIME_MED)=>t.setLocale(U(s)).toLocaleString(i),q=(e,t)=>e.setLocale(U(t)).toRelative(),H=(t,s)=>{const i="string"==typeof t?parseInt(t):t;return i<0?"":isNaN(i)?"?":e.filesize_min(i,{round:i<1048576?0:1,locale:U(s)})},G=(e,t={})=>Object.keys(t).reduce(((s,i)=>(s[t[i]]=e[i],s)),{});const j=e.defineComponent$1({mixins:[N],model:{prop:"selectedIds",event:"select"},props:{resources:{type:Array,required:!0},resourceDomSelector:{type:Function,required:!1,default:e=>i.extractDomSelector(e.id)},arePathsDisplayed:{type:Boolean,required:!1,default:!1},areThumbnailsDisplayed:{type:Boolean,required:!1,default:!0},selectedIds:{type:Array,default:()=>[]},hasActions:{type:Boolean,required:!1,default:!0},targetRoute:{type:Object,required:!1,default:null},targetRouteParamMapping:{type:Object,required:!1,default:()=>({storageId:"storageId"})},targetRouteQueryMapping:{type:Object,required:!1,default:()=>({})},areResourcesClickable:{type:Boolean,required:!1,default:!0},headerPosition:{type:Number,required:!1,default:0},isSelectable:{type:Boolean,required:!1,default:!0},disabled:{type:[String,Array],required:!1,default:null},paddingX:{type:String,required:!1,default:"small",validator:e=>/(xsmall|small|medium|large|xlarge)/.test(e)},dragDrop:{type:Boolean,required:!1,default:!1},hover:{type:Boolean,required:!1,default:!0},sortBy:{type:String,required:!1,default:void 0},fieldsDisplayed:{type:Array,required:!1,default:null},sortDir:{type:String,required:!1,default:void 0,validator:e=>void 0===e||[$.Asc.toString(),$.Desc.toString()].includes(e)}},setup:()=>({hasShareJail:s.useCapabilityShareJailEnabled(),hasProjectSpaces:s.useCapabilityProjectSpacesEnabled()}),data:()=>({constants:{EVENT_TROW_MOUNTED:"rowMounted"}}),computed:{...e.mapGetters(["configuration"]),...e.mapState("Files",["areFileExtensionsShown","latestSelectedId","clipboardResources","clipboardAction"]),...e.mapState("runtime/spaces",["spaces"]),popperOptions:()=>({modifiers:[e.maxSize,{name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:e}){const{height:t}=e.modifiersData.maxSize;e.styles.popper.overflowY="auto",e.styles.popper.maxHeight=t-5+"px"}}]}),fields(){if(0===this.resources.length)return[];const e=this.resources[0],t=[];this.isSelectable&&t.push({name:"select",title:"",type:"slot",headerType:"slot",width:"shrink"});const s=A(e);return t.push(...[{name:"name",title:this.$gettext("Name"),type:"slot",width:"expand",wrap:"truncate"},{name:"indicators",title:this.$gettext("Shares"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"size",title:this.$gettext("Size"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"status",title:this.$gettext("Status"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"owner",title:this.$gettext("Shared by"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"sharedWith",title:this.$gettext("Shared with"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"mdate",title:this.$gettext("Modified"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.mdate)+" ("+this.formatDate(e.mdate)+")"},{name:"sdate",title:this.$gettext("Shared on"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.sdate)+" ("+this.formatDate(e.sdate)+")"},{name:"ddate",title:this.$gettext("Deleted"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.ddate)+" ("+this.formatDate(e.ddate)+")"}].filter((t=>{const s=Object.prototype.hasOwnProperty.call(e,t.name);return this.fieldsDisplayed?s&&this.fieldsDisplayed.includes(t.name):s})).map((e=>{const t=s.find((t=>t.name===e.name));return t&&Object.assign(e,{sortable:t.sortable,sortDir:t.sortDir}),e}))),this.hasActions&&t.push({name:"actions",title:this.$gettext("Actions"),type:"slot",alignH:"right",wrap:"nowrap"}),t},lazyLoading(){return this.configuration?.options?.displayResourcesLazy},areAllResourcesSelected(){return this.selectedIds.length===this.resources.length},selectedResources(){return this.resources.filter((e=>this.selectedIds.includes(e.id)))},allResourcesCheckboxLabel(){return this.$gettext("Select all resources")},contextMenuLabel(){return this.$gettext("Show context menu")},hoverableQuickActions(){return this.configuration?.options?.hoverableQuickActions}},methods:{...e.mapActions("Files",["toggleFileSelection"]),isResourceSelected(e){return this.selectedIds.includes(e.id)},isResourceCut(e){return this.clipboardAction===B.Cut&&this.clipboardResources.some((t=>t.id===e.id))},isLatestSelectedItem(e){return e.id===this.latestSelectedId},hasRenameAction(e){return this.$_rename_items.filter((t=>t.isEnabled({resources:[e]}))).length},openRenameDialog(e){this.$_rename_trigger({resources:[e]})},openSharingSidebar(t){t.share?.shareType!==i.ShareTypes.link.value?e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#peopleShares"):e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#linkShares")},folderLink(e){return this.createFolderLink(e.path,e)},parentFolderLink(t){return t.shareId&&"/"===t.path?s.createLocationShares("files-shares-with-me"):this.createFolderLink(e.dirname(t.path),t)},createFolderLink(t,i){if(null===this.targetRoute)return{};const a={item:t.replace(/^\//,"")||"/",...G(i,this.targetRouteParamMapping),...this.targetRoute.params},r={...G(i,this.targetRouteQueryMapping),...this.targetRoute.query};if(i.shareId)return s.createLocationSpaces("files-spaces-share",{params:{...a,shareName:e.basename(i.shareRoot)},query:{...r,shareId:i.shareId}});const o=this.getMatchingSpace(i.storageId);return this.hasProjectSpaces&&"project"===o?.driveType?s.createLocationSpaces("files-spaces-project",{params:{...a,storageId:o?.id||a.storageId},query:r}):{name:this.targetRoute.name,params:{...a,storageId:o?.id||a.storageId},query:r}},fileDragged(e){this.addSelectedResource(e)},fileDropped(e){this.$emit("fileDropped",e)},sort(e){this.$emit("sort",e)},addSelectedResource(e){this.isResourceSelected(e)||this.toggleFileSelection(e)},resetDropPosition(e,t,s){const i=this.$refs[e].tippy;void 0!==i&&(this.isResourceSelected(s)||this.emitSelect([s.id]),this.displayPositionedDropdown(i,t))},showContextMenu(e,t,s){t.preventDefault();const i=e.$el.getElementsByClassName("resource-table-btn-action-dropdown")[0];void 0!==i&&(this.isResourceSelected(s)||this.emitSelect([s.id]),this.displayPositionedDropdown(i._tippy,t))},displayPositionedDropdown(e,t){const s=this.$refs.contextMenuButton.$el.getBoundingClientRect();e.setProps({getReferenceClientRect:()=>({width:0,height:0,top:t.clientY,bottom:t.clientY,left:"contextmenu"===t.type?t.clientX:s.x,right:"contextmenu"===t.type?t.clientX:s.x})}),e.show()},rowMounted(e,t){this.$emit("rowMounted",e,t)},fileClicked(t){const s=t[0],i=t[1];return i&&i.metaKey?e.bus.publish("app.files.list.clicked.meta",s):i&&i.shiftKey?e.bus.publish("app.files.list.clicked.shift",s):this.emitSelect([s.id])},formatDate(t){return((t,s,i=e.DateTime_1.DATETIME_MED)=>z(e.DateTime_1.fromJSDate(t),s,i))(new Date(t),this.$language.current)},formatDateRelative(t){return((t,s)=>q(e.DateTime_1.fromJSDate(t),s))(new Date(t),this.$language.current)},setSelection(e,t){e?this.emitSelect([...this.selectedIds,t.id]):this.emitSelect(this.selectedIds.filter((e=>e!==t.id)))},emitSelect(t){e.bus.publish("app.files.list.clicked"),this.$emit("select",t)},toggleSelectionAll(){if(this.areAllResourcesSelected)return this.emitSelect([]);this.emitSelect(this.resources.map((e=>e.id)))},emitFileClick(e){this.$emit("fileClick",e)},isResourceClickable(e){return!!this.areResourcesClickable&&(Array.isArray(this.disabled)?!this.disabled.includes(e):this.disabled!==e)},getResourceCheckboxLabel(e){return"folder"===e.type?this.$gettext("Select folder"):this.$gettext("Select file")},getSharedWithAvatarDescription(e){const t="folder"===e.type?this.$gettext("folder"):this.$gettext("file"),s=e.sharedWith.filter((e=>!e.link)).length,i=e.sharedWith.filter((e=>!!e.link)).length,a=[s>0?this.$ngettext("This %{ resourceType } is shared via %{ shareCount } invite","This %{ resourceType } is shared via %{ shareCount } invites",s):"",i>0?this.$ngettext("This %{ resourceType } is shared via %{ linkCount } link","This %{ resourceType } is shared via %{ linkCount } links",i):""].join(" ");return this.$gettextInterpolate(a,{resourceType:t,shareCount:s,linkCount:i})},getOwnerAvatarDescription(e){const t=this.$gettext("This %{ resourceType } is owned by %{ ownerName }"),s="folder"===e.type?this.$gettext("folder"):this.$gettext("file");return this.$gettextInterpolate(t,{resourceType:s,ownerName:e.owner[0].displayName})},getMatchingSpace(e){return this.spaces.find((t=>t.id===e))},getDefaultParentFolderName(t){if(this.hasProjectSpaces){const e=this.getMatchingSpace(t.storageId);if("project"===e?.driveType)return e.name}return this.hasShareJail?t.shareId?"/"===t.path?this.$gettext("Shared with me"):e.basename(t.shareRoot):this.$gettext("Personal"):this.$gettext("All files and folders")}}});var V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-table",{class:e.hoverableQuickActions&&"hoverable-quick-actions",attrs:{data:e.resources,fields:e.fields,highlighted:e.selectedIds,disabled:e.disabled,sticky:!0,"header-position":e.headerPosition,"drag-drop":e.dragDrop,hover:e.hover,"item-dom-selector":e.resourceDomSelector,selection:e.selectedResources,"sort-by":e.sortBy,"sort-dir":e.sortDir,lazy:e.lazyLoading,"padding-x":"medium"},on:{highlight:e.fileClicked,rowMounted:e.rowMounted,contextmenuClicked:e.showContextMenu,itemDropped:e.fileDropped,itemDragged:e.fileDragged,sort:e.sort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("div",{staticClass:"resource-table-select-all"},[s("oc-checkbox",{attrs:{id:"resource-table-select-all",size:"large",label:e.allResourcesCheckboxLabel,"hide-label":!0,value:e.areAllResourcesSelected},on:{input:e.toggleSelectionAll}})],1)]},proxy:!0},{key:"select",fn:function(t){var i=t.item;return[s("oc-checkbox",{attrs:{id:"resource-table-select-"+e.resourceDomSelector(i),label:e.getResourceCheckboxLabel(i),"hide-label":!0,size:"large",value:e.isResourceSelected(i),outline:e.isLatestSelectedItem(i)},on:{input:function(t){return e.setSelection(t,i)}},nativeOn:{click:function(e){e.stopPropagation()}}})]}},{key:"name",fn:function(t){var i=t.item;return[s("div",{staticClass:"resource-table-resource-wrapper",class:[{"resource-table-resource-wrapper-limit-max-width":e.hasRenameAction(i)}]},[s("oc-resource",{key:i.path+"-"+e.resourceDomSelector(i)+"-"+i.thumbnail,class:{"resource-table-resource-cut":e.isResourceCut(i)},attrs:{resource:i,"is-path-displayed":e.arePathsDisplayed,"parent-folder-name-default":e.getDefaultParentFolderName(i),"is-thumbnail-displayed":e.areThumbnailsDisplayed,"is-extension-displayed":e.areFileExtensionsShown,"is-resource-clickable":e.isResourceClickable(i.id),"folder-link":e.folderLink(i),"parent-folder-link":e.parentFolderLink(i)},on:{click:function(t){return e.emitFileClick(i)}}}),e._v(" "),e.hasRenameAction(i)?s("oc-button",{staticClass:"resource-table-edit-name",attrs:{appearance:"raw"},on:{click:function(t){return e.openRenameDialog(i)}}},[s("oc-icon",{attrs:{name:"edit-2","fill-type":"line",size:"small"}})],1):e._e()],1)]}},{key:"status",fn:function(t){var s=t.item;return[e._t("status",null,{resource:s})]}},{key:"size",fn:function(e){var t=e.item;return[s("oc-resource-size",{attrs:{size:t.size||Number.NaN}})]}},{key:"mdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.mdate),expression:"formatDate(item.mdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.mdate))}})]}},{key:"indicators",fn:function(t){var i=t.item;return[i.indicators.length?s("oc-status-indicators",{attrs:{resource:i,indicators:i.indicators}}):e._e()]}},{key:"sdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.sdate),expression:"formatDate(item.sdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.sdate))}})]}},{key:"ddate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.ddate),expression:"formatDate(item.ddate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.ddate))}})]}},{key:"owner",fn:function(t){var i=t.item;return[s("oc-button",{attrs:{appearance:"raw",variation:"inverse"},on:{click:function(t){return e.openSharingSidebar(i)}}},[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.owner,"is-tooltip-displayed":!0,"accessible-description":e.getOwnerAvatarDescription(i)}})],1)]}},{key:"sharedWith",fn:function(t){var i=t.item;return[s("oc-button",{attrs:{appearance:"raw",variation:"inverse"},on:{click:function(t){return e.openSharingSidebar(i)}}},[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.sharedWith,stacked:!0,"max-displayed":3,"is-tooltip-displayed":!0,"accessible-description":e.getSharedWithAvatarDescription(i)}})],1)]}},{key:"actions",fn:function(t){var i=t.item;return[s("div",{staticClass:"resource-table-actions"},[e._t("quickActions",null,{resource:i}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.contextMenuLabel,expression:"contextMenuLabel"}],ref:"contextMenuButton",staticClass:"resource-table-btn-action-dropdown",attrs:{id:"context-menu-trigger-"+e.resourceDomSelector(i),"aria-label":e.contextMenuLabel,appearance:"raw"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.resetDropPosition("context-menu-drop-ref-"+e.resourceDomSelector(i),t,i)}}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{ref:"context-menu-drop-ref-"+e.resourceDomSelector(i),attrs:{"drop-id":"context-menu-drop-"+e.resourceDomSelector(i),toggle:"#context-menu-trigger-"+e.resourceDomSelector(i),"popper-options":e.popperOptions,mode:"click","close-on-click":"","padding-size":"small"},nativeOn:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[e._t("contextMenu",null,{resource:i})],2)],2)]}},e.$slots.footer?{key:"footer",fn:function(){return[e._t("footer")]},proxy:!0}:null],null,!0)})};V._withStripped=!0;const W=e.normalizeComponent({render:V,staticRenderFns:[]},undefined,j,undefined,false,undefined,!1,void 0,void 0,void 0);async function Q(e,t,a,r,o){const n=function(e){switch(e){case i.ShareStatus.accepted:return"POST";case i.ShareStatus.declined:return"DELETE";default:return null}}(t);if(!n)throw new Error("invalid new share status");let l=await o.requests.ocs({service:"apps/files_sharing",action:`api/v1/shares/pending/${e.share.id}`,method:n});if(200!==l.status)throw new Error(l.statusText);if(parseInt(l.headers.get("content-length"))>0&&(l=await l.json(),l.ocs.data.length>0)){const e=l.ocs.data[0];return s.buildSharedResource(e,!0,a,r)}return null}var J={computed:{...e.mapGetters(["capabilities"]),$_acceptShare_hasResharing(){return e.get(this.capabilities,"files_sharing.resharing",!0)},$_acceptShare_hasShareJail(){return e.get(this.capabilities,"spaces.share_jail",!1)},$_acceptShare_items(){return[{name:"accept-share",icon:"check",handler:this.$_acceptShare_trigger,label:({resources:e})=>this.$ngettext("Accept share","Accept shares",e.length),isEnabled:({resources:e})=>{if(!s.isLocationSharesActive(this.$router,"files-shares-with-me"))return!1;if(0===e.length)return!1;return!e.some((e=>e.status===i.ShareStatus.accepted))},componentType:"button",class:"oc-files-actions-accept-share-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE"]),...e.mapActions(["showMessage"]),...e.mapActions("Files",["resetFileSelection"]),async $_acceptShare_trigger({resources:t}){const s=[],a=[],r=new e._default({concurrency:4});t.forEach((e=>{a.push(r.add((async()=>{try{const t=await Q(e,i.ShareStatus.accepted,this.$_acceptShare_hasResharing,this.$_acceptShare_hasShareJail,this.$client);t&&this.UPDATE_RESOURCE(t)}catch(e){console.error(e),s.push(e)}})))})),await Promise.all(a),0!==s.length?this.showMessage({title:this.$ngettext("Failed to accept the selected share.","Failed to accept selected shares.",t.length),status:"danger"}):this.resetFileSelection()}}},Y={computed:{isMacOs:()=>window.navigator.platform.match("Mac"),getCopyShortcutString(){return this.isMacOs?this.$pgettext("Keyboard shortcut for macOS for copying files","⌘ + C"):this.$pgettext("Keyboard shortcut for non-macOS systems for copying files","Ctrl + C")},$_copy_items(){return[{name:"copy",icon:"file-copy-2",handler:this.$_copy_trigger,shortcut:this.getCopyShortcutString,label:()=>this.$pgettext("Action in the files list row to initiate copying resources","Copy"),isEnabled:({resources:e})=>!!(s.isLocationSpacesActive(this.$router,"files-spaces-personal")||s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationPublicActive(this.$router,"files-public-files")||s.isLocationCommonActive(this.$router,"files-common-favorites"))&&(0!==e.length&&(!s.isLocationPublicActive(this.$router,"files-public-files")||this.currentFolder.canCreate())),componentType:"button",class:"oc-files-actions-copy-trigger"}]}},methods:{...e.mapActions("Files",["copySelectedFiles"]),$_copy_trigger(){this.copySelectedFiles()}}},K={...e.mapGetters(["capabilities"]),$_declineShare_hasResharing(){return e.get(this.capabilities,"files_sharing.resharing",!0)},$_declineShare_hasShareJail(){return e.get(this.capabilities,"spaces.share_jail",!1)},computed:{$_declineShare_items(){return[{name:"decline-share",icon:"close",handler:this.$_declineShare_trigger,label:({resources:e})=>this.$ngettext("Decline share","Decline shares",e.length),isEnabled:({resources:e})=>{if(!s.isLocationSharesActive(this.$router,"files-shares-with-me")&&!s.isLocationSpacesActive(this.$router,"files-spaces-share"))return!1;if(0===e.length)return!1;if(s.isLocationSpacesActive(this.$router,"files-spaces-share")&&(e.length>1||"/"!==e[0].path))return!1;return!e.some((e=>e.status===i.ShareStatus.declined))},componentType:"button",class:"oc-files-actions-decline-share-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE"]),...e.mapActions(["showMessage"]),...e.mapActions("Files",["resetFileSelection"]),async $_declineShare_trigger({resources:t}){const a=[],r=[],o=new e._default({concurrency:4});if(t.forEach((e=>{r.push(o.add((async()=>{try{const t=await Q(e,i.ShareStatus.declined,this.$_declineShare_hasResharing,this.$_declineShare_hasShareJail,this.$client);t&&this.UPDATE_RESOURCE(t)}catch(e){console.error(e),a.push(e)}})))})),await Promise.all(r),0===a.length)return this.resetFileSelection(),void(s.isLocationSpacesActive(this.$router,"files-spaces-share")&&(this.showMessage({title:this.$ngettext("The selected share was declined successfully","The selected shares were declined successfully",t.length)}),this.$router.push(s.createLocationShares("files-shares-with-me"))));this.showMessage({title:this.$ngettext("Failed to decline the selected share","Failed to decline selected shares",t.length),status:"danger"})}}};function X(e){if(void 0===e)throw new Error('cloneStateObject: cannot clone "undefined"');return JSON.parse(JSON.stringify(e))}var Z={mixins:[{data:()=>({deleteResources_queue:new e._default({concurrency:4}),deleteResources_deleteOps:[],resourcesToDelete:[]}),computed:{...e.mapGetters("Files",["selectedFiles"]),...e.mapGetters(["user","configuration","capabilities"]),$_deleteResources_isInTrashbin(){return s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project")},$_deleteResources_resources(){return X(this.resourcesToDelete)},$_deleteResources_dialogTitle(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;let s=null;return 1===e.length?(s=t?this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete folder %{name}"):this.$gettext("Delete folder %{name}"):this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete file %{name}"):this.$gettext("Delete file %{name}"),this.$gettextInterpolate(s,{name:e[0].name},!0)):(s=this.$_deleteResources_isInTrashbin?this.$ngettext("Permanently delete selected resource?","Permanently delete %{amount} selected resources?",e.length):this.$ngettext("Delete selected resource?","Delete %{amount} selected resources?",e.length),this.$gettextInterpolate(s,{amount:e.length},!1))},$_deleteResources_dialogMessage(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;return 1===e.length?t?this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this folder? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this folder?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this file? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this file?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete all selected resources? All their content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete all selected resources?")}},methods:{...e.mapActions("Files",["pushResourcesToDeleteList","removeFilesFromTrashbin","deleteFiles"]),...e.mapActions(["showMessage","toggleModalConfirmButton","hideModal","createModal"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),...e.mapMutations(["SET_QUOTA"]),$_deleteResources_trashbin_deleteOp(e){const t=s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?s.buildWebDavSpacesTrashPath(this.$route.params.storageId):s.buildWebDavFilesTrashPath(this.user.id);return this.$client.fileTrash.clearTrashBin(t,e.id).then((()=>{this.removeFilesFromTrashbin([e]);const t=this.$gettext('"%{file}" was deleted successfully');this.showMessage({title:this.$gettextInterpolate(t,{file:e.name},!0)})})).catch((t=>{if(423===t.statusCode){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));return void this.deleteResources_deleteOps.push(t)}console.error(t);const s=this.$gettext('Failed to delete "%{file}"');this.showMessage({title:this.$gettextInterpolate(s,{file:e.name},!0),status:"danger"})}))},$_deleteResources_trashbin_delete(){this.toggleModalConfirmButton();for(const e of this.$_deleteResources_resources){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));this.deleteResources_deleteOps.push(t)}Promise.all(this.deleteResources_deleteOps).then((()=>{this.hideModal(),this.toggleModalConfirmButton()}))},$_deleteResources_filesList_delete(){const e=this.$store.getters["runtime/auth/isPublicLinkContextReady"];this.deleteFiles({client:this.$client,files:this.$_deleteResources_resources,isPublicLinkContext:e,$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate}).then((async()=>{if(this.hideModal(),this.toggleModalConfirmButton(),s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-personal"))if(this.capabilities?.spaces?.enabled){const e=this.$store.getters["runtime/auth/accessToken"],t=s.clientService.graphAuthenticated(this.configuration.server,e),i=await t.drives.getDrive(this.$_deleteResources_resources[0].storageId);this.UPDATE_SPACE_FIELD({id:i.data.id,field:"spaceQuota",value:i.data.quota})}else{const e=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(e.quota)}let e;if(this.resourcesToDelete.length&&m(this.resourcesToDelete[0],this.currentFolder)){const t=this.resourcesToDelete[0].path,s=t.lastIndexOf("/");e=t.slice(0,-1!==s?s:0)}void 0!==e&&this.$router.push({params:{item:e}})}))},$_deleteResources_delete(){this.toggleModalConfirmButton(),this.$_deleteResources_isInTrashbin?this.$_deleteResources_trashbin_delete():this.$_deleteResources_filesList_delete()},$_deleteResources_displayDialog(e){this.resourcesToDelete=[...e];const t={variation:"danger",icon:"alarm-warning",title:this.$_deleteResources_dialogTitle,message:this.$_deleteResources_dialogMessage,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:this.$_deleteResources_delete};this.createModal(t)}}}],computed:{...e.mapState("Files",["currentFolder"]),...e.mapGetters(["capabilities"]),$_delete_items(){return[{name:"delete",icon:"delete-bin-5",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>{if(!(s.isLocationSpacesActive(this.$router,"files-spaces-personal")||s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationPublicActive(this.$router,"files-public-files")))return!1;if(0===e.length)return!1;if(s.isLocationSpacesActive(this.$router,"files-spaces-share")&&"/"===e[0].path)return!1;return!e.some((e=>!e.canBeDeleted()))},componentType:"button",class:"oc-files-actions-delete-trigger"},{name:"delete-permanent",icon:"delete-bin-5",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>!(!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project"))&&(!1!==this.capabilities?.files?.permanent_deletion&&e.length>0),componentType:"button",class:"oc-files-actions-delete-permanent-trigger"}]}},methods:{$_delete_trigger({resources:e}){this.$_deleteResources_displayDialog(e)}}};var ee={computed:{$_isFilesAppActive(){return"files"===a.activeApp(this.$route)}}};const te=new class{serverUrl;capability;initialize(t,s=[]){this.serverUrl=t;const i=s.filter((e=>e.enabled)).sort(((t,s)=>e.semver.rcompare(t.version,s.version)));this.capability=i.length?i[0]:null}get available(){return!!this.capability?.version}get fileIdsSupported(){return e.semver.major(this.capability?.version)>=2}async triggerDownload(e){const t=e.clientService||s.clientService;if(!this.available)throw new a.RuntimeError("no archiver available");if((e.fileIds?.length||0)+(e.files?.length||0)===0)throw new a.RuntimeError("requested archive with empty list of resources");const i=this.buildDownloadUrl({...e,clientService:t});if(!i)throw new a.RuntimeError("download url could not be built");const r=e.publicToken?i:await t.owncloudSdk.signUrl(i);return window.location=r,r}buildDownloadUrl(t){const s=[];t.publicToken&&s.push(`public-token=${t.publicToken}`);switch(e.semver.major(this.capability.version)){case 2:return s.push(...t.fileIds.map((e=>`id=${e}`))),this.url+"?"+s.join("&");case 1:{const e=Math.random().toString(36).substring(2);return s.push(`dir=${encodeURIComponent(t.dir)}`,...t.files.map((e=>`files[]=${encodeURIComponent(e)}`)),`downloadStartSecret=${e}`),this.url+"?"+s.join("&")}default:return}}get url(){if(!this.available)throw new a.RuntimeError("no archiver available");return/^https?:\/\//i.test(this.capability.archiver_url)?this.capability.archiver_url:[this.serverUrl.replace(/\/+$/,""),this.capability.archiver_url.replace(/^\/+/,"")].join("/")}};const se=new class{serverUrl;capability;initialize(e=null){this.capability=e}get available(){return!!this.capability?.version}get supportedMimeTypes(){return this.capability?.supportedMimeTypes||[]}isMimetypeSupported(e,t=!1){if(!this.supportedMimeTypes.length)return!0;return this.getSupportedMimeTypes(t?"image/":null).includes(e)}getSupportedMimeTypes(e){return e?this.supportedMimeTypes.filter((t=>t.startsWith(e))):this.supportedMimeTypes}};class ie{static filterSearch;static sdkSearch}var ae={mixins:[ee],computed:{$_downloadArchive_items(){return[{name:"download-archive",icon:"inbox-archive",handler:this.$_downloadArchive_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>{if(this.$_isFilesAppActive&&!s.isLocationSpacesActive(this.$router,"files-spaces-personal")&&!s.isLocationSpacesActive(this.$router,"files-spaces-project")&&!s.isLocationSpacesActive(this.$router,"files-spaces-share")&&!s.isLocationPublicActive(this.$router,"files-public-files")&&!s.isLocationCommonActive(this.$router,"files-common-favorites")&&!s.isLocationSharesActive(this.$router,"files-shares-with-me"))return!1;if(0===e.length)return!1;if(1===e.length&&!e[0].isFolder)return!1;if(!te.available)return!1;if(!te.fileIdsSupported&&s.isLocationCommonActive(this.$router,"files-common-favorites"))return!1;return!e.some((e=>!e.canDownload()))},canBeDefault:!0,componentType:"button",class:"oc-files-actions-download-archive-trigger"}]}},methods:{async $_downloadArchive_trigger({resources:t}){const i=te.fileIdsSupported?{fileIds:t.map((e=>e.fileId))}:{dir:e.path.dirname(e.head(t).path)||"/",files:t.map((e=>e.name))};await te.triggerDownload({...i,...s.isLocationPublicActive(this.$router,"files-public-files")&&{publicToken:this.$route.params.item.split("/")[0]}}).catch((e=>{console.error(e),this.showMessage({title:this.$ngettext("Failed to download the selected folder.","Failed to download the selected files.",this.selectedFiles.length),status:"danger"})}))}}},re={mixins:[ee],computed:{$_downloadFile_items(){return[{name:"download-file",icon:"file-download",handler:this.$_downloadFile_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>!!(!this.$_isFilesAppActive||s.isLocationSpacesActive(this.$router,"files-spaces-personal")||s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationPublicActive(this.$router,"files-public-files")||s.isLocationCommonActive(this.$router,"files-common-favorites")||s.isLocationSharesActive(this.$router,"files-shares-with-me"))&&(1===e.length&&(!e[0].isFolder&&e[0].canDownload())),canBeDefault:!0,componentType:"button",class:"oc-files-actions-download-file-trigger"}]}},methods:{$_downloadFile_trigger({resources:e}){this.downloadFile(e[0])}}},oe={mixins:[ee],computed:{$_favorite_items(){return[{name:"favorite",icon:"star",handler:this.$_favorite_trigger,label:({resources:e})=>e[0].starred?this.$gettext("Remove from favorites"):this.$gettext("Add to favorites"),isEnabled:({resources:e})=>!(this.$_isFilesAppActive&&!s.isLocationSpacesActive(this.$router,"files-spaces-personal")&&!s.isLocationCommonActive(this.$router,"files-common-favorites"))&&(1===e.length&&this.capabilities?.files?.favorites),componentType:"button",class:"oc-files-actions-favorite-trigger"}]}},methods:{...e.mapActions("Files",["markFavorite"]),$_favorite_trigger({resources:e}){this.markFavorite({client:this.$client,file:e[0]}).catch((()=>{const t=this.$gettext('Failed to change favorite state of "%{file}"'),s=this.$gettextInterpolate(t,{file:e[0].name},!0);this.showMessage({title:s,status:"danger"})}))}}};var ne={computed:{isMacOs:()=>window.navigator.platform.match("Mac"),getCutShortcutString(){return this.isMacOs?this.$pgettext("Keyboard shortcut for macOS for cutting files","⌘ + X"):this.$pgettext("Keyboard shortcut for non-macOS systems for cutting files","Ctrl + X")},$_move_items(){return[{name:"cut",icon:"scissors",handler:this.$_move_trigger,shortcut:this.getCutShortcutString,label:()=>this.$pgettext("Action in the files list row to initiate cutting resources","Cut"),isEnabled:({resources:e})=>{if(!(s.isLocationSpacesActive(this.$router,"files-spaces-personal")||s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationPublicActive(this.$router,"files-public-files")||s.isLocationCommonActive(this.$router,"files-common-favorites")))return!1;if(0===e.length)return!1;if(!this.currentFolder)return!1;return!e.some((e=>!1===function(e,t){const s=e.isReceivedShare()||e.isMounted(),i=""===t&&s;return e.canBeDeleted()&&!i}(e,this.currentFolder.path)))},componentType:"button",class:"oc-files-actions-move-trigger"}]}},methods:{...e.mapActions("Files",["cutSelectedFiles"]),$_move_trigger(){this.cutSelectedFiles()}}},le={computed:{...e.mapGetters(["capabilities"]),...e.mapState("Files",["currentFolder"]),$_navigate_items(){return[{name:"navigate",icon:"folder-open",label:()=>this.$pgettext("Action in the files list row to open a folder","Open folder"),isEnabled:({resources:e})=>!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project")&&(1===e.length&&((null===this.currentFolder||!m(e[0],this.currentFolder))&&(!!e[0].isFolder&&(!s.isLocationSharesActive(this.$router,"files-shares-with-me")||e[0].status===i.ShareStatus.accepted)))),canBeDefault:!0,componentType:"router-link",route:({resources:t})=>{const s=this.getShareId(t[0]),i=this.getShareName(t[0]),{storageId:a}=t[0];return e.merge({},this.routeName,{params:{item:t[0].path,...i&&{shareName:i},...a&&{storageId:a}},query:{...s&&{shareId:s}}})},class:"oc-files-actions-navigate-trigger"}]},routeName(){return s.isLocationPublicActive(this.$router,"files-public-files")?s.createLocationPublic("files-public-files"):s.isLocationSpacesActive(this.$router,"files-spaces-project")?s.createLocationSpaces("files-spaces-project"):s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationSharesActive(this.$router,"files-shares-with-me")?s.createLocationSpaces("files-spaces-share"):s.createLocationSpaces("files-spaces-personal")}},methods:{getShareId(e){return this.$route.query?.shareId?this.$route.query.shareId:this.capabilities?.spaces?.share_jail&&s.isLocationSharesActive(this.$router,"files-shares-with-me")?e.id:void 0},getShareName(e){return this.$route.params?.shareName?this.$route.params.shareName:this.capabilities?.spaces?.share_jail&&s.isLocationSharesActive(this.$router,"files-shares-with-me")?e.name:void 0}}},ce={computed:{...e.mapState(["user"]),...e.mapState("runtime/spaces",["spaces"]),...e.mapGetters(["configuration","capabilities"]),$_restore_items(){return[{name:"restore",icon:"arrow-go-back",label:()=>this.$gettext("Restore"),handler:this.$_restore_trigger,isEnabled:({resources:e})=>!(!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project"))&&(!!e.every((e=>e.canBeRestored()))&&e.length>0),componentType:"button",class:"oc-files-actions-restore-trigger"}]}},methods:{...e.mapActions("Files",["removeFilesFromTrashbin"]),...e.mapActions(["showMessage"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),...e.mapMutations(["SET_QUOTA"]),async $_restore_trigger({resources:t}){const a=[],r=[],o=[],n=new e._default({concurrency:4});if(t.forEach((e=>{const t=s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?s.buildWebDavSpacesTrashPath(this.$route.params.storageId):s.buildWebDavFilesTrashPath(this.user.id),l=s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?i.buildWebDavSpacesPath(this.$route.params.storageId,e.path):s.buildWebDavFilesPath(this.user.id,e.path);o.push(n.add((async()=>{try{await this.$client.fileTrash.restore(t,e.id,l),a.push(e)}catch(t){console.error(t),r.push(e)}})))})),await Promise.all(o),a.length>0){let e;this.removeFilesFromTrashbin(a);const t={};1===a.length?(e=this.$gettext("%{resource} was restored successfully"),t.resource=a[0].name):(e=this.$gettext("%{resourceCount} files restored successfully"),t.resourceCount=a.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0)})}if(r.length>0){let e;const t={};1===r.length?(e=this.$gettext('Failed to restore "%{resource}"'),t.resource=r[0].name):(e=this.$gettext("Failed to restore %{resourceCount} files"),t.resourceCount=r.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0),status:"danger"})}if(this.capabilities?.spaces?.enabled){const e=this.$store.getters["runtime/auth/accessToken"],t=s.clientService.graphAuthenticated(this.configuration.server,e),i=s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?this.$route.params.storageId:this.spaces.find((e=>"personal"===e.driveType)).id,a=await t.drives.getDrive(i);this.UPDATE_SPACE_FIELD({id:a.data.id,field:"spaceQuota",value:a.data.quota})}else{const e=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(e.quota)}}}};const de=["navigate","downloadArchive","downloadFile","favorite","copy","move","rename","restore","delete","acceptShare","declineShare"];var he={mixins:[J,Y,K,Z,re,ae,oe,ne,le,N,ce],computed:{...e.mapState(["apps"]),...e.mapGetters("Files",["highlightedFile","currentFolder"]),...e.mapGetters(["capabilities","configuration"]),$_fileActions_systemActions(){return de.flatMap((e=>this[`$_${e}_items`]))},$_fileActions_editorActions(){return s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?[]:this.apps.fileEditors.map((t=>({label:()=>{if(t.label)return this.$gettext(t.label);const e=this.$gettext("Open in %{app}");return this.$gettextInterpolate(e,{app:this.apps.meta[t.app].name},!0)},icon:this.apps.meta[t.app].icon,...this.apps.meta[t.app].iconFillType&&{iconFillType:this.apps.meta[t.app].iconFillType},img:this.apps.meta[t.app].img,handler:({resources:e})=>this.$_fileActions_openEditor(t,e[0].webDavPath,e[0].id,"edit"),isEnabled:({resources:e})=>1===e.length&&((!s.isLocationSharesActive(this.$router,"files-shares-with-me")||e[0].status===i.ShareStatus.accepted)&&(e[0].extension&&t.extension?e[0].extension.toLowerCase()===t.extension.toLowerCase():!(!e[0].mimeType||!t.mimeType)&&(e[0].mimeType.toLowerCase()===t.mimeType.toLowerCase()||e[0].mimeType.split("/")[0].toLowerCase()===t.mimeType.toLowerCase()))),canBeDefault:t.canBeDefault,componentType:"button",class:`oc-files-actions-${e.kebabCase(this.apps.meta[t.app].name).toLowerCase()}-trigger`}))).sort(((e,t)=>t.canBeDefault!==e.canBeDefault&&t.canBeDefault?1:0))}},methods:{...e.mapActions(["openFile"]),$_fileActions__routeOpts(e,t,i,a){const r=this.$route;return{name:e.routeName||e.app,params:{filePath:t,fileId:i,mode:a},query:s.routeToContextQuery(r)}},$_fileActions_openEditor(e,t,s,i){if(e.handler)return e.handler({config:this.configuration,extensionConfig:e.config,filePath:t,fileId:s,mode:i});this.openFile({filePath:t});const a=this.$_fileActions__routeOpts(e,t,s,i);if(e.newTab){const s=this.$router.resolve(a).href,i=`${e.routeName}-${t}`,r=window.open(s,i);r&&r.focus()}else this.$router.push(a)},$_fileActions_triggerDefaultAction(e){const t=this.$_fileActions_getDefaultAction(e);t.handler({resources:[e],...t.handlerData})},$_fileActions_getDefaultAction(e){const t=[e],s=e=>e.canBeDefault&&e.isEnabled({resources:t,parent:this.currentFolder}),i=this.$_fileActions_editorActions.filter(s);if(i.length)return i[0];const a=this.$_fileActions_loadExternalAppActions(t).filter(s);return a.length?a[0]:this.$_fileActions_systemActions.filter(s)[0]},$_fileActions_getAllAvailableActions(e){return[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(e),...this.$_fileActions_systemActions].filter((t=>t.isEnabled({resources:e})))},$_fileActions_loadExternalAppActions(t){if(s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project"))return[];if(1!==t.length)return[];const{mimeType:i,webDavPath:a,fileId:r}=t[0],o=this.$store.getters["External/mimeTypes"]||[];if(void 0===i||!e.get(this,"capabilities.files.app_providers")||!o.length)return[];const n=o.find((e=>e.mime_type===i));if(void 0===n)return[];const{app_providers:l=[],default_application:c}=n;return l.map((e=>{const t=this.$gettext("Open in %{ appName }");return{name:e.name,icon:e.icon,img:e.img,componentType:"button",class:`oc-files-actions-${e.name}-trigger`,isEnabled:()=>!0,canBeDefault:c===e.name,handler:()=>this.$_fileActions_openLink(e.name,a,r),label:()=>this.$gettextInterpolate(t,{appName:e.name})}}))},$_fileActions_openLink(e,t,s){const i=this.$_fileActions__routeOpts({routeName:"external-apps"},t,void 0,void 0);i.query={app:e,fileId:s,...i.query},window.open(this.$router.resolve(i).href,"_blank")}}},ue={mounted(){const{filterSearch:e}=ie;if(!e||!e.available)return;const t=e.subscribe("reset",(()=>{this.CLEAR_FILES_SEARCHED()})),s=e.subscribe("updateTerm",(e=>{e||this.CLEAR_FILES_SEARCHED()})),i=e.subscribe("activate",(({resources:e})=>{this.LOAD_FILES_SEARCHED(e)}));this.$on("beforeDestroy",(()=>{e.unsubscribe("reset",t),e.unsubscribe("updateTerm",s),e.unsubscribe("activate",i)}))},watch:{$route:{handler:function(e,t){e.name===t?.name&&e.params?.item===t?.params?.item||this.CLEAR_FILES_SEARCHED()},immediate:!0}},methods:{...e.mapMutations("Files",["CLEAR_FILES_SEARCHED","LOAD_FILES_SEARCHED"])}};const pe={name:"ActionMenuItem",props:{action:{type:Object,required:!0},items:{type:Array,required:!0},appearance:{type:String,default:"raw"},shortcutHint:{type:Boolean,default:!0,required:!1},showTooltip:{type:Boolean,default:!1,required:!1}},computed:{filterParams(){return{resources:this.items}}},methods:{getComponentProps(e,t){const s={appearance:this.appearance,...e.isDisabled&&{disabled:e.isDisabled()},...e.variation&&{variation:e.variation}};return"router-link"===e.componentType&&e.route?{...s,to:e.route({resources:t})}:s},getComponentListeners(e,t){if("function"!=typeof e.handler||"button"!==e.componentType)return{};const s=()=>e.handler({resources:t,...e.handlerData});return e.keepOpen?{click:e=>{e.stopPropagation(),s()}}:{click:s}},hasExternalImageIcon:e=>e.icon&&/^https?:\/\//i.test(e.icon)}};var me=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",[s("oc-button",e._g(e._b({directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.showTooltip||e.action.hideLabel?e.action.label(e.filterParams):"",expression:"showTooltip || action.hideLabel ? action.label(filterParams) : ''"}],class:[e.action.class,"action-menu-item"],attrs:{type:e.action.componentType,"data-testid":"action-handler",size:"small"}},"oc-button",e.getComponentProps(e.action,e.items),!1),e.getComponentListeners(e.action,e.items)),[e.action.img?s("oc-img",{staticClass:"oc-icon oc-icon-m",attrs:{"data-testid":"action-img",src:e.action.img,alt:""}}):e.hasExternalImageIcon(e.action)?s("oc-img",{staticClass:"oc-icon oc-icon-m",attrs:{"data-testid":"action-img",src:e.action.icon,alt:""}}):e.action.icon?s("oc-icon",{attrs:{"data-testid":"action-icon",name:e.action.icon,"fill-type":e.action.iconFillType||"line",size:"medium"}}):e._e(),e._v(" "),e.action.hideLabel?e._e():s("span",{staticClass:"oc-files-context-action-label",attrs:{"data-testid":"action-label"}},[e._v(e._s(e.action.label(e.filterParams)))]),e._v(" "),e.action.shortcut&&e.shortcutHint?s("span",{staticClass:"oc-files-context-action-shortcut",domProps:{textContent:e._s(e.action.shortcut)}}):e._e(),e._v(" "),e.action.opensInNewWindow?s("span",{staticClass:"oc-invisible-sr",attrs:{"data-testid":"action-sr-hint"},domProps:{textContent:e._s(e.$gettext("(Opens in new window)"))}}):e._e()],1)],1)};me._withStripped=!0;const fe=e.normalizeComponent({render:me,staticRenderFns:[]},undefined,pe,undefined,false,undefined,!1,void 0,void 0,void 0);var ge={computed:{...e.mapGetters("Files",["activeFiles"]),...e.mapGetters(["capabilities"]),...e.mapState(["user"]),$_emptyTrashBin_items(){return[{name:"empty-trash-bin",icon:"delete-bin-5",label:()=>this.$gettext("Empty trash bin"),handler:this.$_emptyTrashBin_trigger,isEnabled:({resources:e})=>!(!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project"))&&(!1!==this.capabilities?.files?.permanent_deletion&&0===e.length),isDisabled:()=>0===this.activeFiles.length,componentType:"button",class:"oc-files-actions-empty-trash-bin-trigger",variation:"danger"}]}},methods:{...e.mapActions(["showMessage","createModal","hideModal","toggleModalConfirmButton"]),...e.mapActions("Files",["clearTrashBin"]),$_emptyTrashBin_trigger(){const e={variation:"danger",icon:"alarm-warning",title:this.$gettext("Empty trash bin"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),message:this.$gettext("Are you sure you want to permanently delete your items in the trash bin? You can’t undo this action."),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_emptyTrashBin_emptyTrashBin()};this.createModal(e)},$_emptyTrashBin_emptyTrashBin(){const e=s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?s.buildWebDavSpacesTrashPath(this.$route.params.storageId):s.buildWebDavFilesTrashPath(this.user.id);return this.$client.fileTrash.clearTrashBin(e).then((()=>{this.showMessage({title:this.$gettext("All deleted files were removed")}),this.clearTrashBin()})).catch((e=>{console.error(e),this.showMessage({title:this.$pgettext("Error message in case clearing the trash bin fails","Failed to delete all files permanently"),status:"danger"})})).finally((()=>{this.hideModal()}))}}};const be={name:"BatchActions",components:{ActionMenuItem:fe},mixins:[J,Y,K,Z,ae,re,ge,ne,ce,{computed:{$_clearSelection_items(){return[{name:"clear-selection",icon:"close",label:()=>this.$gettext("Clear selection"),hideLabel:!0,handler:this.$_clearSelection_trigger,isEnabled:({resources:e})=>e.length>0,componentType:"button",class:"oc-files-actions-clear-selection-trigger"}]}},methods:{...e.mapMutations("Files",["RESET_SELECTION"]),$_clearSelection_trigger(){this.RESET_SELECTION()}}}],props:{showTooltips:{type:Boolean,default:!1,required:!1}},computed:{...e.mapGetters("Files",["selectedFiles"]),filterParams(){return{resources:this.selectedFiles}},menuItemsBatchActions(){return[...this.$_clearSelection_items,...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_delete_items,...this.$_restore_items].filter((e=>e.isEnabled({resources:this.selectedFiles})))}}};var ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-files-appbar-batch-actions oc-width-1-1"},e._l(e.menuItemsBatchActions,(function(t,i){return s("action-menu-item",{key:"batch-action-"+i,staticClass:"oc-mr-s",attrs:{action:t,items:e.selectedFiles,appearance:"outline","shortcut-hint":!1,"show-tooltip":e.showTooltips}})})),1)};ve._withStripped=!0;const _e=e.normalizeComponent({render:ve,staticRenderFns:[]},undefined,be,undefined,false,undefined,!1,void 0,void 0,void 0);const Se={name:"ContextActionMenu",components:{ActionMenuItem:fe},props:{menuSections:{type:Array,required:!0},items:{type:Array,required:!0}},methods:{getSectionClasses(e){const t=[];return this.menuSections.length?(e<this.menuSections.length-1&&t.push("oc-pb-s"),e>0&&t.push("oc-pt-s"),e<this.menuSections.length-1&&t.push("oc-files-context-actions-border"),t):t}}};var xe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-files-context-menu"}},e._l(e.menuSections,(function(t,i){return s("oc-list",{key:"section-"+t.name+"-list",staticClass:"oc-files-context-actions",class:e.getSectionClasses(i),attrs:{id:"oc-files-context-actions-"+t.name}},e._l(t.items,(function(i,a){return s("action-menu-item",{key:"section-"+t.name+"-action-"+a,staticClass:"oc-files-context-action oc-px-s oc-rounded oc-menu-item-hover",attrs:{action:i,items:e.items}})})),1)})),1)};xe._withStripped=!0;const we=e.normalizeComponent({render:xe,staticRenderFns:[]},undefined,Se,undefined,false,undefined,!1,void 0,void 0,void 0),ye=async t=>{const i={name:"Quicklink",permissions:1,quicklink:!0};t.password&&(i.password=t.password);const{resource:a,store:r}=t,o=r.state.user.capabilities.files_sharing.public.expire_date;o.enforced&&(i.expireDate=e.DateTime_1.now().plus({days:parseInt(o.days,10)}).endOf("day").toISO()),i.spaceRef=a.fileId||a.id;const n=await r.dispatch("Files/addLink",{path:a.path,client:s.clientService.owncloudSdk,params:i,storageId:a.fileId||a.id});return e.copyToClipboard(n.url),await r.dispatch("showMessage",{title:"Quicklink copied into your clipboard"}),n};function Ce(e,t){const{capabilities:s}=t.state.user;return!(!s.files_sharing||!s.files_sharing.api_enabled)&&(!(e.isReceivedShare()&&!s.files_sharing.resharing)&&e.canShare())}function $e(e,t){const i={variation:"passive",title:s.$gettext("Set password"),cancelText:s.$gettext("Cancel"),confirmText:s.$gettext("Set"),hasInput:!0,inputDescription:s.$gettext("Passwords for links are required."),inputLabel:s.$gettext("Password"),inputType:"password",onCancel:()=>e.store.dispatch("hideModal"),onConfirm:async i=>{i&&""!==i.trim()?(await e.store.dispatch("hideModal"),t(i)):e.store.dispatch("showMessage",{title:s.$gettext("Password cannot be empty"),status:"danger"})},onInput:t=>""===t.trim()?e.store.dispatch("setModalInputErrorMessage",s.$gettext("Password cannot be empty")):e.store.dispatch("setModalInputErrorMessage",null)};return e.store.dispatch("createModal",i)}var Ee={collaborators:{id:"collaborators",label:e=>e("Add people"),icon:"user-add",handler:()=>e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#peopleShares"),displayed:Ce},quicklink:{id:"quicklink",label:e=>e("Copy quicklink"),icon:"link",handler:async t=>{if(!0===t.store.getters.capabilities?.files_sharing?.public?.password?.enforced_for?.read_only)return $e(t,(async i=>{await ye({...t,resource:t.item,password:i}),e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#linkShares")}));await ye({...t,resource:t.item}),e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#linkShares")},displayed:Ce}};const Re={name:"ContextActions",components:{ContextActionMenu:we},mixins:[he,J,Y,{computed:{$_createQuicklink_items(){return[{name:"create-quicklink",icon:Ee.quicklink.icon,iconFillType:Ee.quicklink.iconFillType,label:()=>this.$gettext("Copy quicklink"),handler:this.$_createQuicklink_trigger,isEnabled:({resources:e})=>1===e.length&&((!s.isLocationSharesActive(this.$router,"files-shares-with-me")||e[0].status===i.ShareStatus.accepted)&&Ce(e[0],this.$store)),componentType:"button",class:"oc-files-actions-create-quicklink-trigger"}]}},methods:{async $_createQuicklink_trigger({resources:t}){const i=this.$store,[a]=t;await ye({resource:a,storageId:this.$route.params.storageId||a?.fileId||a?.id,store:i}),e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#linkShares")}}},K,Z,ae,re,ge,oe,ne,{computed:{...e.mapGetters("Files",["clipboardResources"]),isMacOs:()=>window.navigator.platform.match("Mac"),getPasteShortcutString(){return this.isMacOs?this.$pgettext("Keyboard shortcut for macOS for pasting files","⌘ + V"):this.$pgettext("Keyboard shortcut for non-macOS systems for pasting files","Ctrl + V")},$_paste_items(){return[{name:"paste",icon:"clipboard",handler:this.$_paste_trigger,label:()=>this.$pgettext("Action in the files list row to initiate pasting resources","Paste"),shortcut:this.getPasteShortcutString,isEnabled:({resources:e})=>0!==this.clipboardResources.length&&(!!(s.isLocationSpacesActive(this.$router,"files-spaces-personal")||s.isLocationSpacesActive(this.$router,"files-spaces-project")||s.isLocationSpacesActive(this.$router,"files-spaces-share")||s.isLocationPublicActive(this.$router,"files-public-files")||s.isLocationCommonActive(this.$router,"files-common-favorites"))&&(0!==e.length&&(!s.isLocationPublicActive(this.$router,"files-public-files")||this.currentFolder.canCreate()))),componentType:"button",class:"oc-files-actions-copy-trigger"}]}},methods:{...e.mapActions(["showMessage","createModal","hideModal"]),...e.mapActions("Files",["pasteSelectedFiles"]),...e.mapMutations("Files",{upsertResource:"UPSERT_RESOURCE"}),$_paste_trigger(){const e=this.$store.getters["runtime/auth/isPublicLinkContextReady"],t=this.$store.getters["runtime/auth/publicLinkPassword"];this.pasteSelectedFiles({client:this.$client,createModal:this.createModal,hideModal:this.hideModal,showMessage:this.showMessage,$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate,$ngettext:this.$ngettext,isPublicLinkContext:e,publicLinkPassword:t,upsertResource:this.upsertResource})}}},le,N,ce,{mixins:[ee],computed:{$_showActions_items(){return[{name:"show-actions",icon:"slideshow-3",label:()=>this.$gettext("All Actions"),handler:this.$_showActions_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&1===e.length,componentType:"button",class:"oc-files-actions-show-actions-trigger"}]}},methods:{$_showActions_trigger(){const t=s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?null:"actions-item";e.bus.publish(s.SideBarEventTopics.openWithPanel,t)}}},{mixins:[ee],computed:{$_showDetails_items(){return[{name:"show-details",icon:"information",label:()=>this.$gettext("Details"),handler:this.$_showDetails_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&(!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project")&&e.length>0),componentType:"button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showDetails_trigger({resources:t}){this.SET_FILE_SELECTION(t),e.bus.publish(s.SideBarEventTopics.open)}}},{mixins:[ee],computed:{$_showShares_items(){return[{name:"show-shares",icon:Ee.collaborators.icon,iconFillType:Ee.collaborators.iconFillType,label:()=>this.$gettext("Share"),handler:this.$_showShares_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&(!s.isLocationTrashActive(this.$router,"files-trash-personal")&&!s.isLocationTrashActive(this.$router,"files-trash-spaces-project")&&(1===e.length&&((!s.isLocationSharesActive(this.$router,"files-shares-with-me")||e[0].status===i.ShareStatus.accepted)&&Ce(e[0],this.$store)))),componentType:"button",class:"oc-files-actions-show-shares-trigger"}]}},methods:{...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showShares_trigger({resources:t}){this.SET_FILE_SELECTION(t),e.bus.publish(s.SideBarEventTopics.openWithPanel,"sharing-item#peopleShares")}}},{inject:{currentSpace:{default:null}},computed:{...e.mapGetters(["configuration"]),...e.mapState(["user"]),$_setSpaceImage_items(){return[{name:"set-space-image",icon:"image-edit",handler:this.$_setSpaceImage_trigger,label:()=>this.$gettext("Set as space image"),isEnabled:({resources:e})=>1===e.length&&(!!e[0].mimeType&&(!!se.isMimetypeSupported(e[0].mimeType,!0)&&(!!s.isLocationSpacesActive(this.$router,"files-spaces-project")&&(!!this.space&&this.space.canEditImage({user:this.user}))))),canBeDefault:!1,componentType:"button",class:"oc-files-actions-set-space-image-trigger"}]},space(){return this.currentSpace?.value}},methods:{...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),...e.mapActions(["showMessage"]),async $_setSpaceImage_trigger({resources:e}){const t=this.$store.getters["runtime/auth/accessToken"],i=s.clientService.graphAuthenticated(this.configuration.server,t),a=this.$route.params.storageId,r=e[0].webDavPath,o=`/spaces/${a}/.space/${e[0].name}`;try{r!==o&&await this.$client.files.copy(r,o);const e=await this.$client.files.fileInfo(o),t=s.buildResource(e),{data:n}=await i.drives.updateDrive(a,{special:[{specialFolder:{name:"image"},id:t.id}]},{});this.UPDATE_SPACE_FIELD({id:a,field:"spaceImageData",value:n.special.find((e=>"image"===e.specialFolder.name))}),this.showMessage({title:this.$gettext("Space image was set successfully")})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to set space image"),status:"danger"})}}}},{inject:{currentSpace:{default:null}},computed:{...e.mapState("Files",["currentFolder"]),...e.mapState("runtime/spaces",["spaces"]),...e.mapState(["user"]),$_setSpaceReadme_items(){return[{name:"set-space-readme",icon:"markdown",handler:this.$_setSpaceReadme_trigger,label:()=>this.$gettext("Set as space description"),isEnabled:({resources:e})=>1===e.length&&(!!e[0].mimeType?.startsWith("text/")&&(!!s.isLocationSpacesActive(this.$router,"files-spaces-project")&&(!!this.space&&this.space.canEditReadme({user:this.user})))),canBeDefault:!1,componentType:"button",class:"oc-files-actions-set-space-readme-trigger"}]},space(){return this.currentSpace?.value}},methods:{...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),...e.mapActions(["showMessage"]),async $_setSpaceReadme_trigger({resources:e}){try{const t=await this.$client.files.getFileContents(e[0].webDavPath),s=await this.$client.files.putFileContents(`/spaces/${this.space.id}/.space/readme.md`,t);this.UPDATE_SPACE_FIELD({id:this.space.id,field:"spaceReadmeData",value:{...this.space.spaceReadmeData,etag:s?.ETag}}),this.showMessage({title:this.$gettext("Space description was set successfully")})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to set space description"),status:"danger"})}}}},{computed:{$_navigate_space_items(){return[{name:"navigate",icon:"layout-grid",label:()=>this.$gettext("Navigate to space"),handler:this.$_navigate_space_trigger,isEnabled:({resources:e})=>!e.length&&s.isLocationTrashActive(this.$router,"files-trash-spaces-project"),componentType:"button",class:"oc-files-actions-navigate-trigger"}]}},methods:{$_navigate_space_trigger(){this.$router.push(s.createLocationSpaces("files-spaces-project",{params:{storageId:this.$router.currentRoute.params.storageId}}))}}}],props:{items:{type:Array,required:!0}},computed:{menuSections(){const e=[];return this.items.length>1?(this.menuItemsBatchActions.length&&e.push({name:"batch-actions",items:[...this.menuItemsBatchActions]}),e.push({name:"batch-details",items:[...this.$_showDetails_items]}),e):(this.menuItemsContext.length&&e.push({name:"context",items:this.menuItemsContext}),this.menuItemsShare.length&&e.push({name:"share",items:this.menuItemsShare}),this.menuItemsActions.length&&e.push({name:"actions",items:this.menuItemsActions}),this.menuItemsSidebar.length&&e.push({name:"sidebar",items:this.menuItemsSidebar}),e)},filterParams(){return{resources:this.items}},menuItemsBatchActions(){return[...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_delete_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_restore_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsContext(){return[...[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(this.filterParams.resources)]].filter((e=>e.isEnabled(this.filterParams))).sort(((e,t)=>Number(t.canBeDefault)-Number(e.canBeDefault)))},menuItemsShare(){return[...this.$_showShares_items,...this.$_createQuicklink_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsActions(){return[...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_delete_items,...this.$_move_items,...this.$_copy_items,...this.$_paste_items,...this.$_rename_items,...this.$_restore_items,...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_setSpaceImage_items,...this.$_setSpaceReadme_items,...this.$_navigate_space_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSidebar(){const e=[...this.$_navigate_items];return[...this.$_favorite_items.map((e=>(e.keepOpen=!0,e))),...e,...this.$_showDetails_items].filter((e=>e.isEnabled(this.filterParams)))}}};var ke=function(){var e=this,t=e.$createElement;return(e._self._c||t)("context-action-menu",{attrs:{"menu-sections":e.menuSections,items:e.items}})};ke._withStripped=!0;const Ie=e.normalizeComponent({render:ke,staticRenderFns:[]},undefined,Re,undefined,false,undefined,!1,void 0,void 0,void 0);const Fe={setup(){const t=e.getCurrentInstance().proxy.$gettext,i=s.useRouter(),a=[s.locationSharesWithMe,s.locationSharesWithOthers,s.locationSharesViaLink].reduce(((e,t)=>(e[t.name]=i.getRoutes().find((e=>e.name===t.name)),e)),{}),r=O(s.isLocationSharesActive,s.locationSharesWithMe.name),o=O(s.isLocationSharesActive,s.locationSharesWithOthers.name),n=O(s.isLocationSharesActive,s.locationSharesViaLink.name),l=e.computed((()=>[{icon:"share-forward",to:a[s.locationSharesWithMe.name].path,text:t("Shared with me"),active:e.unref(r)},{icon:"reply",to:a[s.locationSharesWithOthers.name].path,text:t("Shared with others"),active:e.unref(o)},{icon:"link",to:a[s.locationSharesViaLink.name].path,text:t("Shared via link"),active:e.unref(n)}]));return{currentNavItem:e.computed((()=>e.unref(l).find((e=>e.active)))),navItems:l}}};var Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("nav",{staticClass:"oc-py-s",attrs:{id:"shares-navigation","aria-label":e.$gettext("Shares pages navigation")}},[s("oc-list",{staticClass:"oc-flex oc-visible@s"},e._l(e.navItems,(function(t){return s("li",{key:"shares-navigation-desktop-"+t.to},[s("oc-button",{staticClass:"oc-mr-m oc-py-s shares-nav-desktop",attrs:{type:"router-link",appearance:"raw",to:t.to}},[s("oc-icon",{attrs:{size:"small",name:t.icon}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.text)}})],1)],1)})),0),e._v(" "),s("div",{staticClass:"oc-hidden@s"},[s("oc-button",{attrs:{id:"shares_navigation_mobile",appearance:"raw"}},[s("span",{domProps:{textContent:e._s(e.currentNavItem.text)}}),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s","fill-type":"line",size:"small"}})],1),e._v(" "),s("oc-drop",{attrs:{toggle:"#shares_navigation_mobile",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",e._l(e.navItems,(function(t){return s("li",{key:"shares-navigation-mobile-"+t.to},[s("oc-button",{staticClass:"oc-my-xs shares-nav-mobile",class:{"oc-background-primary-gradient":t.active},attrs:{type:"router-link",appearance:"raw",to:t.to,variation:t.active?"inverse":"passive"}},[s("span",{staticClass:"icon-box",class:{"icon-box-active":t.active}},[s("oc-icon",{attrs:{name:t.icon}})],1),e._v(" "),s("span",{domProps:{textContent:e._s(t.text)}})])],1)})),0)],1)],1)],1)};Te._withStripped=!0;const Le=e.normalizeComponent({render:Te,staticRenderFns:[]},undefined,Fe,"data-v-18dfdb62",false,undefined,!1,void 0,void 0,void 0);const De={props:{sideBarOpen:{type:Boolean,default:!1}},computed:{toggleSidebarButtonLabel(){return this.sideBarOpen?this.$gettext("Close sidebar to hide details"):this.$gettext("Open sidebar to view details")},toggleSidebarButtonIconFillType(){return this.sideBarOpen?"fill":"line"}},methods:{toggleSideBar(){e.bus.publish(s.SideBarEventTopics.toggle)}}};var Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.toggleSidebarButtonLabel,expression:"toggleSidebarButtonLabel"}],staticClass:"oc-my-s oc-p-xs",attrs:{id:"files-toggle-sidebar","aria-label":e.toggleSidebarButtonLabel,appearance:"raw"},on:{click:function(t){return t.stopPropagation(),e.toggleSideBar.apply(null,arguments)}}},[s("oc-icon",{attrs:{name:"side-bar-right","fill-type":e.toggleSidebarButtonIconFillType}})],1)};Ae._withStripped=!0;const Pe=e.normalizeComponent({render:Ae,staticRenderFns:[]},undefined,De,"data-v-3cdab9c6",false,undefined,!1,void 0,void 0,void 0);const Me={setup:()=>({itemsPerPage:d({name:w.perPageQueryName,defaultValue:w.perPageDefault})}),computed:{...e.mapState("Files",["areHiddenFilesShown","areFileExtensionsShown"]),viewOptionsButtonLabel(){return this.$gettext("Display customization options of the files list")},hiddenFilesShownModel:{get(){return this.areHiddenFilesShown},set(e){this.SET_HIDDEN_FILES_VISIBILITY(e)}},fileExtensionsShownModel:{get(){return this.areFileExtensionsShown},set(e){this.SET_FILE_EXTENSIONS_VISIBILITY(e)}}},methods:{...e.mapMutations("Files",["SET_HIDDEN_FILES_VISIBILITY","SET_FILE_EXTENSIONS_VISIBILITY"])}};var Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viewOptionsButtonLabel,expression:"viewOptionsButtonLabel"}],key:"files-view-options-btn",staticClass:"oc-my-s oc-p-xs",attrs:{id:"files-view-options-btn","data-testid":"files-view-options-btn","aria-label":e.viewOptionsButtonLabel,appearance:"raw"}},[s("oc-icon",{attrs:{name:"settings-3","fill-type":"line"}})],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"files-view-options-drop",toggle:"#files-view-options-btn",mode:"click","padding-size":"medium"}},[s("oc-list",[s("li",{staticClass:"files-view-options-list-item oc-mb-m"},[s("oc-switch",{attrs:{"data-testid":"files-switch-hidden-files",label:e.$gettext("Show hidden files")},model:{value:e.hiddenFilesShownModel,callback:function(t){e.hiddenFilesShownModel=t},expression:"hiddenFilesShownModel"}})],1),e._v(" "),s("li",{staticClass:"files-view-options-list-item oc-my-m"},[s("oc-switch",{attrs:{"data-testid":"files-switch-files-extensions-files",label:e.$gettext("Show file extensions")},model:{value:e.fileExtensionsShownModel,callback:function(t){e.fileExtensionsShownModel=t},expression:"fileExtensionsShownModel"}})],1),e._v(" "),s("li",{staticClass:"files-view-options-list-item oc-mt-m"},[s("oc-page-size",{staticClass:"files-pagination-size",attrs:{"data-testid":"files-pagination-size",label:e.$gettext("Items per page"),options:[100,500]},model:{value:e.itemsPerPage,callback:function(t){e.itemsPerPage=t},expression:"itemsPerPage"}})],1)])],1)],1)};Oe._withStripped=!0;const Ne={components:{BatchActions:_e,ContextActions:Ie,SharesNavigation:Le,SidebarToggle:Pe,ViewOptions:e.normalizeComponent({render:Oe,staticRenderFns:[]},undefined,Me,"data-v-4224e29b",false,undefined,!1,void 0,void 0,void 0)},mixins:[he],props:{breadcrumbs:{type:Array,default:()=>[]},breadcrumbsContextActionsItems:{type:Array,default:()=>[]},hasBulkActions:{type:Boolean,default:!1},hasSharesNavigation:{type:Boolean,default:!1},hasSidebarToggle:{type:Boolean,default:!0},hasViewOptions:{type:Boolean,default:!0},showActionsOnSelection:{type:Boolean,default:!1},sideBarOpen:{type:Boolean,default:!1}},data:function(){return{resizeObserver:new ResizeObserver(this.onResize),limitedScreenSpace:!1}},computed:{...e.mapGetters("Files",["files","selectedFiles"]),...e.mapState("Files",["areHiddenFilesShown","areFileExtensionsShown"]),pageTitle(){const e=this.$route.meta.title;return this.$gettext(e)},showContextActions(){return e.last(this.breadcrumbs).allowContextActions},showBatchActions(){return this.hasBulkActions},selectedResourcesAnnouncement(){if(0===this.selectedFiles.length)return this.$gettext("No items selected.");const e=this.$ngettext("%{ amount } item selected. Actions are available above the table.","%{ amount } items selected. Actions are available above the table.",this.selectedFiles.length);return this.$gettextInterpolate(e,{amount:this.selectedFiles.length})}},mounted(){this.resizeObserver.observe(this.$refs.filesAppBar)},beforeDestroy(){this.resizeObserver.unobserve(this.$refs.filesAppBar)},created(){const e="true"===(window.localStorage.getItem("oc_hiddenFilesShown")||"false");e!==this.areHiddenFilesShown&&this.SET_HIDDEN_FILES_VISIBILITY(e);const t="true"===(window.localStorage.getItem("oc_fileExtensionsShown")||"true");t!==this.areFileExtensionsShown&&this.SET_FILE_EXTENSIONS_VISIBILITY(t)},methods:{...e.mapMutations("Files",["SET_HIDDEN_FILES_VISIBILITY","SET_FILE_EXTENSIONS_VISIBILITY"]),onResize(){this.limitedScreenSpace=this.sideBarOpen?window.innerWidth<=1280:window.innerWidth<=1e3}}};var Be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"filesAppBar",class:{"files-app-bar-squashed":e.sideBarOpen},attrs:{id:"files-app-bar"}},[s("oc-hidden-announcer",{attrs:{announcement:e.selectedResourcesAnnouncement,level:"polite"}}),e._v(" "),s("div",{staticClass:"files-topbar oc-py-s"},[s("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),s("div",{staticClass:"oc-flex",class:{"oc-flex-between":e.breadcrumbs.length||e.hasSharesNavigation,"oc-flex-right":!e.breadcrumbs.length&&!e.hasSharesNavigation}},[e.breadcrumbs.length?s("oc-breadcrumb",{staticClass:"oc-flex oc-flex-middle",attrs:{id:"files-breadcrumb","data-testid":"files-breadcrumbs","context-menu-padding":"small",items:e.breadcrumbs},scopedSlots:e._u([{key:"contextMenu",fn:function(){return[e.showContextActions?s("context-actions",{attrs:{items:e.breadcrumbsContextActionsItems.filter(Boolean)}}):e._e()]},proxy:!0}],null,!1,4003141064)}):e._e(),e._v(" "),e.hasSharesNavigation?s("shares-navigation"):e._e(),e._v(" "),e.hasViewOptions||e.hasSidebarToggle?s("div",{staticClass:"oc-flex"},[e.hasViewOptions?s("view-options"):e._e(),e._v(" "),e.hasSidebarToggle?s("sidebar-toggle"):e._e()],1):e._e()],1),e._v(" "),s("div",{staticClass:"files-app-bar-actions"},[s("div",{staticClass:"oc-flex-1 oc-flex oc-flex-start"},[e.showActionsOnSelection||0===e.selectedFiles.length?e._t("actions",null,{limitedScreenSpace:e.limitedScreenSpace}):e._e(),e._v(" "),e.showBatchActions?s("batch-actions",{attrs:{"show-tooltips":e.limitedScreenSpace}}):e._e()],2)]),e._v(" "),e._t("content")],2)],1)};Be._withStripped=!0;const Ue=e.normalizeComponent({render:Be,staticRenderFns:[]},undefined,Ne,"data-v-72fc5a05",false,undefined,!1,void 0,void 0,void 0);const ze={name:"QuickActions",props:{actions:{type:Object,required:!0},item:{type:Object,required:!0}},computed:{filteredActions(){return e.pickBy(this.actions,(e=>!0===e.displayed(this.item,this.$store)))}}};var qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},e._l(e.filteredActions,(function(t){return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:t.label(e.$gettext),expression:"action.label($gettext)"}],key:t.label(e.$gettext),staticClass:"oc-mr-xs quick-action-button oc-p-xs",class:"files-quick-action-"+t.id,attrs:{"aria-label":t.label(e.$gettext),appearance:"raw"},on:{click:function(s){return t.handler({item:e.item,client:e.$client,store:e.$store,$gettext:e.$gettext})}}},[s("oc-icon",{attrs:{name:t.icon,"fill-type":"line"}})],1)})),1)};qe._withStripped=!0;const He=e.normalizeComponent({render:qe,staticRenderFns:[]},undefined,ze,undefined,false,undefined,!1,void 0,void 0,void 0);const Ge={props:{files:{type:Number,required:!0},folders:{type:Number,required:!0},size:{type:[String,Number],required:!1,default:null}},computed:{items(){return this.files+this.folders},text(){const e=this.$gettextInterpolate(this.$ngettext("%{ filesCount } file","%{ filesCount } files",this.files),{filesCount:this.files}),t=this.$gettextInterpolate(this.$ngettext("%{ foldersCount } folder","%{ foldersCount } folders",this.folders),{foldersCount:this.folders}),s=H(this.size,this.$language.current),i=this.size>0?this.$ngettext("%{ itemsCount } item with %{ itemSize } in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items with %{ itemSize } in total (%{ filesStr}, %{foldersStr})",this.items):this.$ngettext("%{ itemsCount } item in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items in total (%{ filesStr}, %{foldersStr})",this.items);return this.$gettextInterpolate(i,{itemsCount:this.items,itemSize:s,filesStr:e,foldersStr:t})}}};var je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-nowrap oc-text-center"},[s("p",{staticClass:"oc-text-muted",attrs:{"data-testid":"files-list-footer-info","data-test-items":e.items,"data-test-files":e.files,"data-test-folders":e.folders,"data-test-size":e.size}},[e._v("\n    "+e._s(e.text)+"\n  ")])])};je._withStripped=!0;const Ve=e.normalizeComponent({render:je,staticRenderFns:[]},undefined,Ge,undefined,false,undefined,!1,void 0,void 0,void 0);const We={props:{pages:{type:Number,required:!0},currentPage:{type:Number,required:!0}},watch:{currentPage:{handler:function(){document.getElementsByClassName("files-view-wrapper")[0]?.scrollTo(0,0)}}}};var Qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.pages>1?s("oc-pagination",{staticClass:"files-pagination oc-flex oc-flex-center oc-my-s",attrs:{pages:e.pages,"current-page":e.currentPage,"max-displayed":3,"current-route":e.$route}}):e._e()};Qe._withStripped=!0;const Je=e.normalizeComponent({render:Qe,staticRenderFns:[]},undefined,We,undefined,false,undefined,!1,void 0,void 0,void 0);const Ye={name:"PrivateLinkItem",inject:["displayedItem"],data:()=>({copied:!1,timeout:null}),computed:{buttonText(){return this.$gettext("Private link")},buttonLabel(){return this.$gettext("Copy private link to clipboard")}},methods:{...e.mapActions(["showMessage"]),copyPrivateLinkToClipboard(){e.copyToClipboard(this.displayedItem.value.privateLink),this.clipboardSuccessHandler(),this.showMessage({title:this.$gettext("Private link copied"),desc:this.$gettext("The private link has been copied to your clipboard.")})},clipboardSuccessHandler(){this.copied=!0,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.copied=!1}),550)}}};var Ke=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.buttonLabel,expression:"buttonLabel"}],staticClass:"oc-files-private-link-copy-url",attrs:{appearance:"raw","aria-label":e.buttonLabel,variation:e.copied?"success":"passive"},on:{click:e.copyPrivateLinkToClipboard}},[s("span",{domProps:{textContent:e._s(e.buttonText)}}),e._v(" "),e.copied?s("oc-icon",{key:"oc-copy-to-clipboard-copied",staticClass:"_clipboard-success-animation",attrs:{name:"checkbox-circle"}}):s("oc-icon",{key:"oc-copy-to-clipboard-copy",attrs:{name:"clipboard"}})],1)};Ke._withStripped=!0;const Xe={name:"FileInfo",components:{PrivateLinkItem:e.normalizeComponent({render:Ke,staticRenderFns:[]},undefined,Ye,undefined,false,undefined,!1,void 0,void 0,void 0)},inject:["displayedItem"],props:{isSubPanelActive:{type:Boolean,default:!0}},setup:()=>({isPersonalLocation:O(s.isLocationSpacesActive,"files-spaces-personal")}),computed:{...e.mapGetters(["capabilities"]),...e.mapState("Files",["areFileExtensionsShown"]),timeData(){const t=t=>{var s,i;return t.time=((t,s,i=e.DateTime_1.DATETIME_MED)=>z(e.DateTime_1.fromRFC2822(t),s,i))(t.sourceTime,this.$language.current),t.timeRelative=(s=t.sourceTime,i=this.$language.current,q(e.DateTime_1.fromRFC2822(s),i)),t.infoString=this.$gettextInterpolate(t.infoString,t),t.ariaLabel=this.$gettextInterpolate(t.ariaLabel,t),t};return s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project")?t({sourceTime:this.file.ddate,infoString:this.$pgettext("inline info about deletion date","deleted %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about deletion date","deleted %{timeRelative} (%{time})")}):t({sourceTime:this.file.mdate,infoString:this.$pgettext("inline info about last modification date","modified %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about last modification date","modified %{timeRelative} (%{time})")})},privateLinkEnabled(){return this.isPersonalLocation&&this.capabilities.files.privateLinks},file(){return this.displayedItem.value}}};var Ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"file_info"},[e.isSubPanelActive?s("oc-resource-icon",{staticClass:"file_info__icon",attrs:{resource:e.file,size:"large"}}):e._e(),e._v(" "),s("div",{staticClass:"file_info__body oc-text-overflow"},[s("h3",{attrs:{"data-testid":"files-info-name"}},[s("oc-resource-name",{attrs:{name:e.file.name,extension:e.file.extension,type:e.file.type,"full-path":e.file.webDavPath,"is-extension-displayed":e.areFileExtensionsShown,"is-path-displayed":!1,"truncate-name":!1}})],1)]),e._v(" "),e.privateLinkEnabled?s("private-link-item",{staticClass:"oc-ml-s"}):e._e()],1)};Ze._withStripped=!0;const et=e.normalizeComponent({render:Ze,staticRenderFns:[]},undefined,Xe,undefined,false,undefined,!1,void 0,void 0,void 0);const tt={name:"SpaceInfo",inject:["displayedItem"],computed:{space(){return this.displayedItem.value}}};var st=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space_info"},[s("div",{staticClass:"space_info__body oc-text-overflow oc-flex oc-flex-middle"},[s("div",{staticClass:"oc-mr-s"},[s("oc-icon",{staticClass:"oc-display-block",attrs:{name:"layout-grid",size:e.space.description?"large":"medium"}})],1),e._v(" "),s("div",[s("h3",{attrs:{"data-testid":"space-info-name"},domProps:{textContent:e._s(e.space.name)}}),e._v(" "),s("span",{attrs:{"data-testid":"space-info-subtitle"},domProps:{textContent:e._s(e.space.description)}})])])])};st._withStripped=!0;const it=e.normalizeComponent({render:st,staticRenderFns:[]},undefined,tt,undefined,false,undefined,!1,void 0,void 0,void 0);const at=e.defineComponent$1({components:{FileInfo:et,SpaceInfo:it,SideBar:e.__vue_component__},provide(){return{displayedItem:e.computed((()=>this.selectedFile)),activePanel:e.computed((()=>this.activePanel))}},props:{open:{type:Boolean,required:!0},activePanel:{type:String,default:null}},setup(){const t=s.useStore(),i=(e,t)=>{e.focus({from:document.activeElement,to:e.sidebar?.$el,revert:"beforeDestroy"===t})};return{hasShareJail:s.useCapabilityShareJailEnabled(),publicLinkPassword:r.usePublicLinkPassword({store:t}),setActiveSideBarPanel:t=>{e.bus.publish(s.SideBarEventTopics.setActivePanel,t)},closeSideBar:()=>{e.bus.publish(s.SideBarEventTopics.close)},destroySideBar:(t,a)=>{i(t,a),e.bus.publish(s.SideBarEventTopics.close)},focusSideBar:i}},data:()=>({focused:void 0,oldPanelName:null,selectedFile:{},loading:!1}),computed:{...e.mapGetters("Files",["highlightedFile","selectedFiles"]),...e.mapGetters(["fileSideBars","capabilities"]),...e.mapState(["user"]),availablePanels(){const{panels:e}=this.fileSideBars.reduce(((e,t)=>{const s=t({capabilities:this.capabilities,highlightedFile:this.highlightedFile,route:this.$route,router:this.$router,multipleSelection:this.areMultipleSelected,rootFolder:this.isRootFolder,user:this.user});return s.enabled&&e.panels.push(s),e}),{panels:[]});return e},isShareAccepted(){return 0===this.highlightedFile?.status},isContentDisplayed(){return!s.isLocationSharesActive(this.$router,"files-shares-with-me")||this.isShareAccepted},warningMessage(){return this.isShareAccepted?null:this.$gettext("Please, accept this share first to display available actions")},isSingleResource(){return!this.areMultipleSelected&&(!this.isRootFolder||this.highlightedFileIsSpace)},areMultipleSelected(){return this.selectedFiles&&this.selectedFiles.length>1},isRootFolder(){const e=this.highlightedFile?.path?.split("/").filter(Boolean)||[];return s.isLocationPublicActive(this.$router,"files-public-files")?1===e.length:s.isLocationSharesActive(this.$router,"files-shares-with-me")?!this.highlightedFile:(!this.hasShareJail||!s.isLocationSpacesActive(this.$router,"files-spaces-share"))&&!e.length},highlightedFileThumbnail(){return this.highlightedFile?.thumbnail},highlightedFileFavorite(){return this.highlightedFile?.starred},highlightedFileIsSpace(){return"space"===this.highlightedFile?.type}},watch:{highlightedFile(e,t){this.isSingleResource&&this.fetchFileInfo()},highlightedFileThumbnail(e){this.$set(this.selectedFile,"thumbnail",e)},highlightedFileFavorite(e){this.$set(this.selectedFile,"starred",e)}},async created(){this.areMultipleSelected||await this.fetchFileInfo()},methods:{async fetchFileInfo(){if(this.highlightedFile)if(s.isLocationTrashActive(this.$router,"files-trash-personal")||s.isLocationTrashActive(this.$router,"files-trash-spaces-project")||this.highlightedFileIsSpace)this.selectedFile={...this.highlightedFile};else{this.loading=!0;try{let e;e=s.isLocationPublicActive(this.$router,"files-public-files")?await this.$client.publicFiles.getFileInfo(this.highlightedFile.webDavPath,this.publicLinkPassword,s.DavProperties.PublicLink):await this.$client.files.fileInfo(this.highlightedFile.webDavPath,s.DavProperties.Default),this.selectedFile=s.buildResource(e),this.$set(this.selectedFile,"thumbnail",this.highlightedFile.thumbnail||null)}catch(e){this.selectedFile={...this.highlightedFile},console.error(e)}this.loading=!1}else this.selectedFile={}}}});var rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.open?s("SideBar",e._g(e._b({ref:"sidebar",staticClass:"files-side-bar",attrs:{tabindex:"-1",open:e.open,"active-panel":e.activePanel,"available-panels":e.availablePanels,"warning-message":e.warningMessage,"is-content-displayed":e.isContentDisplayed,loading:e.loading,"is-header-compact":e.isSingleResource},on:{beforeDestroy:e.destroySideBar,mounted:e.focusSideBar,fileChanged:e.focusSideBar,selectPanel:e.setActiveSideBarPanel,close:e.closeSideBar},scopedSlots:e._u([{key:"header",fn:function(){return[e.isSingleResource&&!e.highlightedFileIsSpace?s("file-info",{staticClass:"sidebar-panel__file_info",attrs:{"is-sub-panel-active":!!e.activePanel}}):e._e(),e._v(" "),e.highlightedFileIsSpace?s("space-info",{staticClass:"sidebar-panel__space_info"}):e._e()]},proxy:!0}],null,!1,2171621488)},"SideBar",e.$attrs,!1),e.$listeners)):e._e()};rt._withStripped=!0;const ot=e.normalizeComponent({render:rt,staticRenderFns:[]},undefined,at,undefined,false,undefined,!1,void 0,void 0,void 0);const nt=e.defineComponent$1({inheritAttrs:!1});var lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-view-wrapper oc-width-expand"},[s("div",e._b({attrs:{id:"files-view"}},"div",e.$attrs,!1),[e._t("default")],2)])};lt._withStripped=!0;const ct=e.normalizeComponent({render:lt,staticRenderFns:[]},undefined,nt,"data-v-3d80ab9a",false,undefined,!1,void 0,void 0,void 0),dt=new e.VisibilityObserver;const ht=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,ResourceTable:W,QuickActions:He,AppLoadingSpinner:e.__vue_component__$1,Pagination:Je,NoContentMessage:e.__vue_component__$2,ListInfo:Ve,ContextActions:Ie,SideBar:ot},mixins:[he,ue],setup(){const e=s.useStore();return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.getters.user.id}})}},computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","configuration"]),isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){dt.disconnect()},methods:{...e.mapActions("Files",["loadPreview"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);dt.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",[s("app-bar",{attrs:{"side-bar-open":e.sideBarOpen}}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-favorites-empty",icon:"star"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources marked as favorite")])]},proxy:!0}],null,!1,2464274424)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-favorites-table","are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){return[s("quick-actions",{staticClass:"oc-visible@s",attrs:{item:t.resource,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};ut._withStripped=!0;const pt=e.normalizeComponent({render:ut,staticRenderFns:[]},undefined,ht,undefined,false,undefined,!1,void 0,void 0,void 0);const mt={props:{btnLabel:{type:String,required:!1,default:""},btnClass:{type:String,required:!1,default:""},isFolder:{type:Boolean,required:!1,default:!1}},computed:{inputId(){return this.isFolder?"files-folder-upload-input":"files-file-upload-input"},uploadLabelId(){return this.isFolder?"files-folder-upload-button":"files-file-upload-button"},buttonLabel(){return this.btnLabel?this.btnLabel:this.isFolder?this.$gettext("Folder"):this.$gettext("Files")},inputAttrs(){return this.isFolder?{webkitdirectory:!0,mozdirectory:!0,allowdirs:!0}:{multiple:!0}}},mounted(){this.$uppyService.registerUploadInput(this.$refs.input)},beforeDestroy(){this.$uppyService.removeUploadInput(this.$refs.input)},methods:{triggerUpload(){this.$refs.input.click()}}};var ft=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{class:e.btnClass,attrs:{"justify-content":"left",appearance:"raw"},on:{click:e.triggerUpload}},[s("oc-resource-icon",{attrs:{resource:{extension:"",isFolder:e.isFolder},size:"medium"}}),e._v(" "),s("span",{attrs:{id:e.uploadLabelId}},[e._v(e._s(e.buttonLabel))])],1),e._v(" "),s("input",e._b({ref:"input",staticClass:"upload-input-target",attrs:{id:e.inputId,type:"file","aria-labelledby":e.uploadLabelId,name:e.isFolder?"file":"folder",tabindex:"-1"}},"input",e.inputAttrs,!1))],1)};ft._withStripped=!0;const gt=e.normalizeComponent({render:ft,staticRenderFns:[]},undefined,mt,"data-v-f9430d86",false,undefined,!1,void 0,void 0,void 0);function bt(t){const i=s.useStore(),a=s.useClientService(),o=r.usePublicLinkPassword({store:i}),n=r.usePublicLinkContext({store:i}),l=s.useAccessToken({store:i}),c=s.useCapabilityFilesTusSupportHttpMethodOverride(),d=s.useCapabilityFilesTusSupportMaxChunkSize(),h=s.useCapabilityFilesTusExtension(),u=e.computed((()=>{if(e.unref(n)){const t=e.unref(o);return t?{Authorization:"Basic "+e.Buffer.from("public:"+t).toString("base64")}:{}}return{Authorization:"Bearer "+e.unref(l)}})),p=e.computed((()=>{const t=e.unref(d)>0;return{isTusSupported:t,onBeforeRequest:t=>{t.setHeader("Authorization",e.unref(u).Authorization)},headers:()=>e.unref(u),...t&&{tusMaxChunkSize:e.unref(d),tusHttpMethodOverride:e.unref(c),tusExtension:e.unref(h)}}}));return e.watch(p,(()=>{e.unref(p).isTusSupported?t.uppyService.useTus(e.unref(p)):t.uppyService.useXhr(e.unref(p))}),{immediate:!0}),{createDirectoryTree:vt({clientService:a,isPublicLinkContext:n,publicLinkPassword:o,uppyService:t.uppyService})}}const vt=({clientService:t,isPublicLinkContext:s,publicLinkPassword:i,uppyService:a})=>async r=>{const{owncloudSdk:o}=t,n=[];for(const t of r){const r=t.meta.currentFolder,l=t.meta.relativeFolder;if(!l||n.includes(l))continue;const c=l.split("/");let d="";for(const l of c){if(!l)continue;const c=`${d}/${l}`;if(n.includes(c)){d+=`/${l}`,n.push(d);continue}let h;h=d?e.v4():t.meta.topLevelFolderId;const u={id:e.v4(),name:l,isFolder:!0,type:"folder",meta:{relativeFolder:d,currentFolder:t.meta.currentFolder,uploadId:h,routeName:t.meta.routeName,routeItem:t.meta.routeItem,routeShareName:t.meta.routeShareName,routeShareId:t.meta.routeShareId,routeStorage:t.meta.routeStorage,routeStorageId:t.meta.routeStorageId,routeParamName:t.meta.routeParamName}};a.publish("addedForUpload",[u]),e.unref(s)?await o.publicFiles.createFolder(r,c,e.unref(i)):await o.files.createFolder(`${t.meta.webDavBasePath}/${c}`),a.publish("uploadSuccess",u),d+=`/${l}`,n.push(d)}}};const _t=e.defineComponent({components:{ResourceUpload:gt},setup(){const t=e.getCurrentInstance().proxy,i=t.$uppyService,a=s.useStore();return e.onMounted((()=>{const e=i.subscribe("filesSelected",t.onFilesSelected);i.useDropTarget({targetSelector:"#files-drop-container",uppyService:i}),t.$on("beforeDestroy",(()=>{i.unsubscribe("filesSelected",e),i.removeDropTarget()}))})),{...bt({uppyService:i}),publicLinkPassword:r.usePublicLinkPassword({store:a})}},data:()=>({loading:!0,errorMessage:null,dragareaEnabled:!1}),computed:{...e.mapGetters(["configuration"]),pageTitle(){return this.$gettext(this.$route.meta.title)},publicLinkToken(){return this.$route.params.token},title(){if(this.share){const e=this.$gettext("%{owner} shared this folder with you for uploading");return this.$gettextInterpolate(e,{owner:this.share.getProperty(this.$client.publicFiles.PUBLIC_LINK_SHARE_OWNER)},!0)}return""},url(){return this.$client.publicFiles.getFileUrl(this.publicLinkToken)+"/"}},mounted(){const t=e.bus.subscribe("drag-over",this.onDragOver),s=e.bus.subscribe("drag-out",this.hideDropzone),i=e.bus.subscribe("drop",this.hideDropzone);this.$on("beforeDestroy",(()=>{e.bus.unsubscribe("drag-over",t),e.bus.unsubscribe("drag-out",s),e.bus.unsubscribe("drop",i)})),this.resolvePublicLink()},methods:{...e.mapActions(["showMessage"]),hideDropzone(){this.dragareaEnabled=!1},onDragOver(e){this.dragareaEnabled=(e.dataTransfer.types||[]).some((e=>"Files"===e))},resolvePublicLink(){this.loading=!0,this.$client.publicFiles.list(this.publicLinkToken,this.publicLinkPassword,s.DavProperties.PublicLink,"0").then((e=>{const t=parseInt(e[0].getProperty(s.DavProperty.PublicLinkPermission));i.linkRoleUploaderFolder.bitmask(!1)===t?this.share=e[0]:this.$router.replace(s.createLocationPublic("files-public-files",{params:{item:this.publicLinkToken}}))})).catch((e=>{if(401===e.statusCode)return this.$authService.handleAuthError(this.$router.currentRoute);console.error(e),this.errorMessage=e})).finally((()=>{this.loading=!1}))},onFilesSelected(t){this.$uppyService.publish("uploadStarted");const s=t.map((t=>({source:"FileDrop",name:t.name,type:t.type,data:t,meta:{tusEndpoint:this.url,relativePath:t.webkitRelativePath||t.relativePath||"",uploadId:e.v4()}})));this.$uppyService.publish("addedForUpload",s),this.$uppyService.uploadFiles(s)}}});var St=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-height-1-1 oc-flex oc-flex-column oc-flex-between",attrs:{id:"files-drop-container"}},[e.dragareaEnabled?s("div",{staticClass:"dragarea"}):e._e(),e._v(" "),s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-p oc-height-1-1"},[e.loading?s("div",{key:"loading-drop",staticClass:"oc-flex oc-flex-column oc-flex-middle"},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("Loading public link…")])],1),e._v(" "),s("oc-spinner",{attrs:{"aria-hidden":!0}})],1):s("div",{key:"loaded-drop",staticClass:"oc-flex oc-flex-column oc-flex-middle oc-height-1-1"},[s("div",{staticClass:"oc-text-center oc-width-1-1 oc-width-xxlarge@m"},[s("h2",{domProps:{textContent:e._s(e.title)}}),e._v(" "),s("resource-upload",{ref:"fileUpload",staticClass:"oc-flex oc-flex-middle oc-flex-center oc-placeholder",attrs:{id:"files-drop-zone","btn-label":e.$gettext("Drop files here to upload or click to select file")}}),e._v(" "),s("div",{attrs:{id:"previews",hidden:""}})],1),e._v(" "),e.errorMessage?s("div",{staticClass:"oc-text-center"},[s("h2",[s("translate",[e._v("An error occurred while loading the public link")])],1),e._v(" "),s("p",{staticClass:"oc-m-rm",domProps:{textContent:e._s(e.errorMessage)}})]):e._e()])]),e._v(" "),s("div",{staticClass:"oc-text-center"},[s("p",{domProps:{textContent:e._s(e.configuration.currentTheme.general.slogan)}})])])};St._withStripped=!0;const xt=e.normalizeComponent({render:St,staticRenderFns:[]},undefined,_t,undefined,false,undefined,!1,void 0,void 0,void 0);const wt={data:()=>({loading:!0,errorMessage:null}),computed:{...e.mapGetters(["configuration","user"]),pageTitle(){return this.$gettext(this.$route.meta.title)}},async mounted(){this.loading=!0;try{let t=await this.$client.files.getPathForFileId(this.$route.params.fileId);t=s.buildWebDavFilesPath(this.user.id,t);let i=await this.$client.files.fileInfo(t,s.DavProperties.Default);i=s.buildResource(i);const a={storageId:this.$store.getters.user.id},r={};i.isFolder?a.item=i.path||"":(a.item=e.path.dirname(i.path),r.scrollTo=i.name),this.$router.push(s.createLocationSpaces("files-spaces-personal",{params:a,query:r}))}catch(e){console.error(e),this.errorMessage=e}finally{this.loading=!1}}};var yt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-height-1-1 oc-link-resolve"},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-card oc-border oc-rounded oc-position-center oc-text-center oc-width-large"},[e.loading?[s("div",{staticClass:"oc-card-header"},[s("h2",{key:"private-link-loading"},[s("translate",[e._v("Resolving private link…")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body"},[s("oc-spinner",{attrs:{"aria-hidden":!0}})],1)]:e.errorMessage?[s("div",{staticClass:"oc-card-header oc-link-resolve-error-title"},[s("h2",{key:"private-link-error"},[s("translate",[e._v("An error occurred while resolving the private link")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body oc-link-resolve-error-message"},[s("p",{staticClass:"oc-text-xlarge"},[e._v(e._s(e.errorMessage))])])]:e._e(),e._v(" "),s("div",{staticClass:"oc-card-footer"},[s("p",[e._v("\n        "+e._s(e.configuration.currentTheme.general.slogan)+"\n      ")])])],2)])};yt._withStripped=!0;const Ct=e.normalizeComponent({render:yt,staticRenderFns:[]},undefined,wt,undefined,false,undefined,!1,void 0,void 0,void 0);var $t={computed:{...e.mapGetters("Files",["totalFilesCount"])},methods:{accessibleBreadcrumb_focusAndAnnounceBreadcrumb(t){const s=e.last(document.getElementById("files-breadcrumb").children[0].children),i=s.getElementsByTagName("button")[0];if(!i)return;const a=this.totalFilesCount.files+this.totalFilesCount.folders,r=this.$gettextInterpolate(this.$ngettext("This folder contains %{ amount } item.","This folder contains %{ amount } items.",a),{amount:a}),o=a>0?r:this.$gettext("This folder has no content.");document.querySelectorAll(".oc-breadcrumb-sr").forEach((e=>e.remove()));const n=document.createElement("p");n.className="oc-invisible-sr oc-breadcrumb-sr",n.innerHTML=o,s.append(n),t&&i.focus()}}};function Et(){const a=s.useStore(),r=t.useRoute(),o=s.useCapabilityShareJailEnabled(),n=O(s.isLocationPublicActive,"files-public-files"),l=O(s.isLocationSpacesActive,"files-spaces-project"),c=O(s.isLocationSpacesActive,"files-spaces-share"),d=s.useClientService(),h=e.computed((()=>a.getters.user)),u=e.ref(""),{graphClient:p}=s.useGraphClient();e.onMounted((async()=>{e.unref(o)&&!e.unref(n)&&(u.value=await Rt(e.unref(p)))}));const m=e.computed((()=>{const{params:t}=e.unref(r),s=t.item||"";return s.endsWith("/")?s:s+"/"})),f=e.computed((()=>{const{params:t,query:a}=e.unref(r);return e.unref(n)?e.unref(m):e.unref(c)?i.buildWebDavSpacesPath([s.SHARE_JAIL_ID,a?.shareId].join("!"),e.unref(m)):e.unref(l)?i.buildWebDavSpacesPath(t.storageId,e.unref(m)):e.unref(o)?i.buildWebDavSpacesPath(e.unref(u),e.unref(m)):s.buildWebDavFilesPath(e.unref(h)?.id,e.unref(m))})),g=e.computed((()=>{const{owncloudSdk:t}=d;return e.unref(n)?t.publicFiles.getFileUrl(e.unref(f)):t.files.getFileUrl(e.unref(f))}));return{inputFilesToUppyFiles:kt({route:r,uploadPath:g,currentPath:m,webDavBasePath:f}),currentPath:m,uploadPath:g,personalDriveId:u}}const Rt=async t=>{const s=await e.unref(t).drives.listMyDrives("","driveType eq personal");if(!s.data)throw new Error("No personal space found");return s.data.value[0].id},kt=({route:t,uploadPath:s,currentPath:i,webDavBasePath:a})=>r=>{const o=[],{name:n,params:l,query:c}=e.unref(t),d=e.unref(i),h=e.unref(s).replace(/\/+$/,""),u={};for(const t of r){const i=t.webkitRelativePath||t.relativePath||null,r=i&&"."!==e.path.dirname(i)?e.path.dirname(i):"",p=r?`${h}/${r.replace(/^\/+/,"")}`:e.unref(s);let m;if(i){const t=i.replace(/^\/+/,"").split("/")[0];u[t]||(u[t]=e.v4()),m=u[t]}o.push({source:"file input",name:t.name,type:t.type,data:t,meta:{currentFolder:d,relativeFolder:r,relativePath:i,tusEndpoint:p,webDavBasePath:e.unref(a),uploadId:e.v4(),topLevelFolderId:m,routeName:n,routeItem:l.item?`${l.item}/${r}`:r,routeShareName:l?.shareName||"",routeShareId:c?.shareId||"",routeStorage:l?.storage||"",routeStorageId:l?.storageId||"",routeParamName:l?.name||""}})}return o};const It=e.defineComponent$1({components:{ResourceUpload:gt},mixins:[he],props:{limitedScreenSpace:{type:Boolean,default:!1,required:!1}},setup(){const t=e.getCurrentInstance().proxy,i=t.$uppyService,o=s.useStore();return e.onMounted((()=>{const e=i.subscribe("filesSelected",t.onFilesSelected),s=i.subscribe("uploadCompleted",t.onUploadComplete);i.useDropTarget({targetSelector:"#files-view",uppyService:i}),t.$on("beforeDestroy",(()=>{i.unsubscribe("filesSelected",e),i.unsubscribe("uploadCompleted",s),i.removeDropTarget()}))})),{...bt({uppyService:i}),...Et(),...r.useRequest(),...s.useGraphClient(),isPersonalLocation:O(s.isLocationSpacesActive,"files-spaces-personal"),isPublicLocation:O(s.isLocationPublicActive,"files-public-files"),isSpacesProjectsLocation:O(s.isLocationSpacesActive,"files-spaces-projects"),isSpacesProjectLocation:O(s.isLocationSpacesActive,"files-spaces-project"),isSpacesShareLocation:O(s.isLocationSpacesActive,"files-spaces-share"),hasShareJail:s.useCapabilityShareJailEnabled(),hasSpaces:s.useCapabilitySpacesEnabled(),publicLinkPassword:r.usePublicLinkPassword({store:o}),isUserContext:a.useUserContext({store:o}),isPublicLinkContext:r.usePublicLinkContext({store:o})}},data:()=>({newFileAction:null,path:"",fileFolderCreationLoading:!1}),computed:{...e.mapGetters(["capabilities","configuration","newFileHandlers","user"]),...e.mapGetters("Files",["files","currentFolder","selectedFiles","clipboardResources"]),...e.mapGetters("runtime/spaces",["spaces"]),...e.mapState("Files",["areFileExtensionsShown"]),showPasteHereButton(){return this.clipboardResources&&0!==this.clipboardResources.length},hideButtonLabels(){return this.limitedScreenSpace&&this.showPasteHereButton},mimetypesAllowedForCreation(){const e=this.$store.getters["External/mimeTypes"];return e&&e.filter((e=>e.allow_creation))||[]},showActions(){return!(this.selectedFiles.length||this.uploadOrFileCreationBlocked&&this.isPublicLocation)},createFileActionsAvailable(){return this.newFileHandlers.length>0||this.mimetypesAllowedForCreation.length>0},newButtonTooltip(){return this.canUpload?null:this.$gettext("You have no permission to create new files!")},newButtonAriaLabel(){const e=this.newButtonTooltip;return e||(this.createFileActionsAvailable?this.$gettext("Create new files or folders"):this.$gettext("Create a new folder"))},uploadButtonTooltip(){return this.canUpload?null:this.$gettext("You have no permission to upload!")},uploadButtonAriaLabel(){const e=this.uploadButtonTooltip;return e||this.$gettext("Upload files or folders")},uploadOrFileCreationBlocked(){return!this.canUpload},canUpload(){return!!this.currentFolder&&this.currentFolder.canUpload({user:this.user})}},methods:{...e.mapActions("Files",["loadPreview","loadIndicators","clearClipboardFiles","pasteSelectedFiles"]),...e.mapActions(["openFile","showMessage","createModal","setModalInputErrorMessage","hideModal"]),...e.mapMutations("Files",["UPSERT_RESOURCE"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),...e.mapMutations(["SET_QUOTA"]),pasteFilesHere(){this.pasteSelectedFiles({client:this.$client,createModal:this.createModal,hideModal:this.hideModal,showMessage:this.showMessage,$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate,$ngettext:this.$ngettext,isPublicLinkContext:this.isPublicLinkContext,publicLinkPassword:this.publicLinkPassword,upsertResource:this.UPSERT_RESOURCE}).then((()=>{document.activeElement.blur()}))},async onUploadComplete(t){if(t.successful){const s=t.successful[0];if(!s)return;if(this.isSpacesProjectLocation||this.isPersonalLocation)if(this.hasSpaces){const e=await this.graphClient.drives.getDrive(s.meta.routeStorageId);this.UPDATE_SPACE_FIELD({id:e.data.id,field:"spaceQuota",value:e.data.quota})}else{const e=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(e.quota)}s.meta.currentFolder===this.currentPath&&e.bus.publish("app.files.list.load")}},showCreateResourceModal(e=!0,t="txt",i=null,a=!1){let r=e?this.$gettext("New folder"):this.$gettext("New file")+`.${t}`;this.files.some((e=>e.name===r))&&(r=s.resolveFileNameDuplicate(r,e?"":t,this.files)),this.areFileExtensionsShown||(r=s.extractNameWithoutExtension({name:r,extension:t})),e||(this.newFileAction=i);const o=e||!this.areFileExtensionsShown?null:[0,r.length-(t.length+1)],n={variation:"passive",title:e?this.$gettext("Create a new folder"):this.$gettext("Create a new file"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Create"),hasInput:!0,inputValue:r,inputLabel:e?this.$gettext("Folder name"):this.$gettext("File name"),inputError:e?this.checkNewFolderName(r):this.checkNewFileName(this.areFileExtensionsShown?r:`${r}.${t}`),inputSelectionRange:o,onCancel:this.hideModal,onConfirm:e?this.addNewFolder:a?this.addAppProviderFile:e=>{this.areFileExtensionsShown||(e=`${e}.${t}`),this.addNewFile(e)},onInput:s=>{this.setModalInputErrorMessage(e?this.checkNewFolderName(s):this.checkNewFileName(this.areFileExtensionsShown?s:`${s}.${t}`))}};this.createModal(n)},async addNewFolder(t){if(""!==t){this.fileFolderCreationLoading=!0;try{let a,r=e.path.join(this.currentPath,t);this.isPersonalLocation?(r=this.hasShareJail?i.buildWebDavSpacesPath(this.personalDriveId,r||""):s.buildWebDavFilesPath(this.user.id,r),await this.$client.files.createFolder(r),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesProjectLocation?(r=i.buildWebDavSpacesPath(this.$route.params.storageId,r),await this.$client.files.createFolder(r),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesShareLocation?(r=i.buildWebDavSpacesPath([s.SHARE_JAIL_ID,this.$route.query.shareId].join("!"),r),await this.$client.files.createFolder(r),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):(await this.$client.publicFiles.createFolder(r,null,this.publicLinkPassword),a=await this.$client.publicFiles.getFileInfo(r,this.publicLinkPassword,s.DavProperties.PublicLink)),a=s.buildResource(a),this.UPSERT_RESOURCE(a),this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{folderName}" was created successfully'),{folderName:t})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create folder"),status:"danger"})}this.fileFolderCreationLoading=!1}},checkNewFolderName(e){if(""===e)return this.$gettext("Folder name cannot be empty");if(/[/]/.test(e))return this.$gettext('Folder name cannot contain "/"');if("."===e)return this.$gettext('Folder name cannot be equal to "."');if(".."===e)return this.$gettext('Folder name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("Folder name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null},async addNewFile(t){if(""!==t){this.fileFolderCreationLoading=!0;try{let a,r=e.path.join(this.currentPath,t);if(this.isPersonalLocation?(r=this.hasShareJail?i.buildWebDavSpacesPath(this.personalDriveId,r||""):s.buildWebDavFilesPath(this.user.id,r),await this.$client.files.putFileContents(r,""),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesProjectLocation?(r=i.buildWebDavSpacesPath(this.$route.params.storageId,r),await this.$client.files.putFileContents(r,""),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesShareLocation?(r=i.buildWebDavSpacesPath([s.SHARE_JAIL_ID,this.$route.query.shareId].join("!"),r),await this.$client.files.putFileContents(r,""),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):(await this.$client.publicFiles.putFileContents("",r,this.publicLinkPassword,""),a=await this.$client.publicFiles.getFileInfo(r,this.publicLinkPassword,s.DavProperties.PublicLink)),this.UPSERT_RESOURCE(s.buildResource(a)),this.newFileAction){const e=a.fileInfo[s.DavProperty.FileId];return this.$_fileActions_openEditor(this.newFileAction,r,e,"create"),void this.hideModal()}this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{fileName}" was created successfully'),{fileName:t})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create file"),status:"danger"})}this.fileFolderCreationLoading=!1}},async addAppProviderFile(t){if(""!==t)try{const a=this.currentFolder.fileId,r=this.configuration.server,o=r+this.capabilities.files.app_providers[0].new_url.replace(/^\/+/,"")+`?parent_container_id=${a}&filename=${encodeURIComponent(t)}`,n=await this.makeRequest("POST",o);if(200!==n.status)throw new Error(`An error has occurred: ${n.status}`);let l,c=e.path.join(this.currentPath,t);this.isPersonalLocation?(c=this.hasShareJail?i.buildWebDavSpacesPath(this.personalDriveId,c||""):s.buildWebDavFilesPath(this.user.id,c),l=await this.$client.files.fileInfo(c,s.DavProperties.Default)):this.isSpacesProjectLocation?(c=i.buildWebDavSpacesPath(this.$route.params.storageId,c),l=await this.$client.files.fileInfo(c,s.DavProperties.Default)):this.isSpacesShareLocation?(c=i.buildWebDavSpacesPath([s.SHARE_JAIL_ID,this.$route.query.shareId].join("!"),c),l=await this.$client.files.fileInfo(c,s.DavProperties.Default)):l=await this.$client.publicFiles.getFileInfo(c,this.publicLinkPassword,s.DavProperties.PublicLink),l=s.buildResource(l),this.$_fileActions_triggerDefaultAction(l),this.UPSERT_RESOURCE(l),this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{fileName}" was created successfully'),{fileName:t})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create file"),status:"danger"})}},checkNewFileName(e){if(""===e)return this.$gettext("File name cannot be empty");if(/[/]/.test(e))return this.$gettext('File name cannot contain "/"');if("."===e)return this.$gettext('File name cannot be equal to "."');if(".."===e)return this.$gettext('File name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("File name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null},onFilesSelected(e){const t=[],s=this.inputFilesToUppyFiles(e);if(this.checkQuotaExceeded(s))return this.$uppyService.clearInputs();for(const e of s){const s=e.meta.relativePath;if(s){const e=s.replace(/^\/+/,"").split("/")[0];if(this.files.find((t=>t.name===e)))return void this.showMessage({title:this.$gettextInterpolate(this.$gettext('Folder "%{folder}" already exists.'),{folder:e},!0),status:"danger"});continue}this.files.find((t=>t.name===e.name))&&t.push(e)}t.length?this.displayOverwriteDialog(s,t):this.handleUppyFileUpload(s)},checkQuotaExceeded(t){let s=!1;return t.reduce(((e,t)=>{let s;if("files-spaces-share"===t.meta.routeName||"files-public-files"===t.meta.routeName)return e;if(s="files-spaces-personal"===t.meta.routeName?this.spaces.find((e=>"personal"===e.driveType)):this.spaces.find((e=>e.id===t.meta.routeStorageId)),!s)return e;const i=e.find((e=>e.space.id===s.id));return i?(i.uploadSize+=t.data.size,e):(e.push({space:s,uploadSize:t.data.size}),e)}),[]).forEach((({space:t,uploadSize:i})=>{if(t.spaceQuota.remaining&&t.spaceQuota.remaining<i){let a=t.name;"personal"===t.driveType&&(a=this.$gettext("Personal"));const r=this.$gettext("There is not enough quota on %{spaceName}, you need additional %{missingSpace} to upload these files");this.showMessage({title:this.$gettext("Not enough quota"),desc:this.$gettextInterpolate(r,{spaceName:a,missingSpace:e.filesize_min(-1*(t.spaceQuota.remaining-i))}),status:"danger"}),s=!0}})),s},async handleUppyFileUpload(e){this.$uppyService.publish("uploadStarted"),await this.createDirectoryTree(e),this.$uppyService.publish("addedForUpload",e),this.$uppyService.uploadFiles(e)},displayOverwriteDialog(e,t){const s=this.$ngettext("File already exists","Some files already exist",t.length),i=this.isUserContext&&this.capabilities?.files?.versioning;let a;a=i?this.$ngettext("The following resource already exists: %{resources}. Do you want to create a new version for it?","The following resources already exist: %{resources}. Do you want to create a new version for them?",t.length):this.$ngettext("The following resource already exists: %{resources}. Do you want to overwrite it?","The following resources already exist: %{resources}. Do you want to overwrite them?",t.length);const r={variation:i?"passive":"danger",icon:"upload-cloud",title:s,message:this.$gettextInterpolate(a,{resources:t.map((e=>`${e.name}`)).join(", ")}),cancelText:this.$gettext("Cancel"),confirmText:i?this.$gettext("Create"):this.$gettext("Overwrite"),onCancel:()=>{this.$uppyService.clearInputs(),this.hideModal()},onConfirm:()=>{this.hideModal(),this.handleUppyFileUpload(e)}};this.createModal(r)}}});var Ft=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showActions?s("div",{staticClass:"create-and-upload-actions oc-flex-inline oc-width-1-1"},[e.createFileActionsAvailable?[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.newButtonTooltip,expression:"newButtonTooltip"}]},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.hideButtonLabels?e.$gettext("New"):"",expression:"hideButtonLabels ? $gettext('New') : ''"}],key:"new-file-menu-btn-enabled",attrs:{id:"new-file-menu-btn","aria-label":e.newButtonAriaLabel,appearance:"filled",variation:"primary",disabled:e.uploadOrFileCreationBlocked}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),e.hideButtonLabels?e._e():s("span",{domProps:{textContent:e._s(e.$gettext("New"))}})],1)],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"new-file-menu-drop",toggle:"#new-file-menu-btn",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",{attrs:{id:"create-list"}},[s("li",{staticClass:"create-list-folder oc-menu-item-hover"},[s("oc-button",{attrs:{id:"new-folder-btn",appearance:"raw"},on:{click:e.showCreateResourceModal}},[s("oc-resource-icon",{attrs:{resource:{isFolder:!0,extension:""},size:"medium"}}),e._v(" "),s("translate",[e._v("Folder")])],1)],1),e._v(" "),e._l(e.newFileHandlers,(function(t,i){return s("li",{key:"file-creation-item-"+i,staticClass:"create-list-file oc-menu-item-hover"},[s("oc-button",{class:["new-file-btn-"+t.ext],attrs:{appearance:"raw"},on:{click:function(s){return e.showCreateResourceModal(!1,t.ext,t.action)}}},[s("oc-resource-icon",{attrs:{resource:{type:"file",extension:t.ext},size:"medium"}}),e._v(" "),s("span",[e._v(e._s(t.menuTitle(e.$gettext)))])],1)],1)})),e._v(" "),e.mimetypesAllowedForCreation?e._l(e.mimetypesAllowedForCreation,(function(t,i){return s("li",{key:"file-creation-item-external-"+i,staticClass:"create-list-file oc-menu-item-hover"},[s("oc-button",{attrs:{appearance:"raw"},on:{click:function(s){return e.showCreateResourceModal(!1,t.ext,!1,!0)}}},[s("oc-resource-icon",{attrs:{resource:{type:"file",extension:t.ext},size:"medium"}}),e._v(" "),s("translate",{attrs:{"translate-params":{name:t.name}}},[e._v("%{name}")])],1)],1)})):e._e()],2)],1)]:[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.newButtonTooltip,expression:"newButtonTooltip"}]},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.hideButtonLabels?e.$gettext("New Folder"):"",expression:"hideButtonLabels ? $gettext('New Folder') : ''"}],attrs:{id:"new-folder-btn",appearance:"filled",variation:"primary","aria-label":e.newButtonAriaLabel,disabled:e.uploadOrFileCreationBlocked},on:{click:e.showCreateResourceModal}},[s("oc-icon",{attrs:{name:"resource-type-folder"}}),e._v(" "),e.hideButtonLabels?e._e():s("span",{domProps:{textContent:e._s(e.$gettext("New Folder"))}})],1)],1)],e._v(" "),s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.uploadButtonTooltip,expression:"uploadButtonTooltip"}]},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.hideButtonLabels?e.$gettext("Upload"):"",expression:"hideButtonLabels ? $gettext('Upload') : ''"}],key:"upload-menu-btn-enabled",attrs:{id:"upload-menu-btn","aria-label":e.uploadButtonAriaLabel,disabled:e.uploadOrFileCreationBlocked}},[s("oc-icon",{attrs:{name:"upload","fill-type":"line"}}),e._v(" "),e.hideButtonLabels?e._e():s("span",{domProps:{textContent:e._s(e.$gettext("Upload"))}})],1)],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"upload-menu-drop",toggle:"#upload-menu-btn",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",{attrs:{id:"upload-list"}},[s("li",{staticClass:"oc-menu-item-hover"},[s("resource-upload",{ref:"folder-upload",attrs:{"btn-class":"oc-width-1-1"}})],1),e._v(" "),s("li",{staticClass:"oc-menu-item-hover"},[s("resource-upload",{ref:"file-upload",attrs:{"btn-class":"oc-width-1-1","is-folder":!0}})],1)])],1),e._v(" "),s("div",{staticClass:"oc-button-group",attrs:{id:"clipboard-btns"}},[e.showPasteHereButton?s("oc-button",{on:{click:e.pasteFilesHere}},[s("oc-icon",{attrs:{"fill-type":"line",name:"clipboard"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("Paste here")])],1):e._e(),e._v(" "),e.showPasteHereButton?s("oc-button",{on:{click:e.clearClipboardFiles}},[s("oc-icon",{attrs:{"fill-type":"line",name:"close"}})],1):e._e()],1)],2):e._e()};Ft._withStripped=!0;const Tt=e.normalizeComponent({render:Ft,staticRenderFns:[]},undefined,It,undefined,false,undefined,!1,void 0,void 0,void 0);const Lt={name:"NotFoundMessage",setup(){const e=s.useRouter(),t=s.useStore();return{showPublicLinkButton:s.isLocationPublicActive(e,"files-public-files"),showHomeButton:s.isLocationSpacesActive(e,"files-spaces-personal"),showSpacesButton:s.isLocationSpacesActive(e,"files-spaces-project"),homeRoute:s.createLocationSpaces("files-spaces-personal",{params:{item:t.getters.homeFolder}}),publicLinkRoute:s.createLocationPublic("files-public-files",{params:{item:e.currentRoute.params?.item?.split("/")[0]}}),spacesRoute:s.createLocationSpaces("files-spaces-projects")}}};var Dt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-center oc-flex-middle oc-flex oc-flex-center oc-flex-column",attrs:{id:"files-list-not-found-message"}},[s("oc-icon",{attrs:{name:"cloud",type:"div",size:"xxlarge"}}),e._v(" "),s("div",{staticClass:"oc-text-muted oc-text-xlarge"},[s("translate",[e._v("Resource not found")])],1),e._v(" "),s("div",{staticClass:"oc-text-muted"},[s("translate",[e._v("\n      We went looking everywhere, but were unable to find the selected resource.\n    ")])],1),e._v(" "),s("div",{staticClass:"oc-mt-s"},[e.showSpacesButton?s("oc-button",{attrs:{id:"space-not-found-button-go-spaces",type:"router-link",appearance:"raw",to:e.spacesRoute}},[s("translate",[e._v("Go to »Spaces Overview«")])],1):e._e(),e._v(" "),e.showHomeButton?s("oc-button",{attrs:{id:"files-list-not-found-button-go-home",type:"router-link",appearance:"raw",to:e.homeRoute}},[s("translate",[e._v("Go to »Personal« page")])],1):e._e(),e._v(" "),e.showPublicLinkButton?s("oc-button",{attrs:{id:"files-list-not-found-button-reload-link",type:"router-link",appearance:"raw",to:e.publicLinkRoute}},[s("translate",[e._v("Reload public link")])],1):e._e()],1)],1)};Dt._withStripped=!0;const At=e.normalizeComponent({render:Dt,staticRenderFns:[]},undefined,Lt,undefined,false,undefined,!1,void 0,void 0,void 0),Pt=(e,t)=>{const s=(e="")=>e.split("/").filter(Boolean),i=s(e.path),a=s(t);return a.map(((t,s)=>({allowContextActions:!0,text:t,to:{path:"/"+[...i].splice(0,i.length-a.length+s+1).join("/"),query:e.query}})))},Mt=(...t)=>{const s=t.pop();return[...t,{allowContextActions:s.allowContextActions,text:s.text,onClick:()=>e.bus.publish("app.files.list.load")}]};var Ot={methods:{scrollToResource(e){const t=document.querySelectorAll(`[data-item-id='${e.id}']`)[0];if(t.getBoundingClientRect().bottom>window.innerHeight)return void t.scrollIntoView(!1);const s=document.getElementsByClassName("files-topbar")[0].offsetHeight+2*t.offsetHeight;if(t.getBoundingClientRect().top<s){document.getElementsByClassName("files-view-wrapper")[0].scrollBy(0,-t.offsetHeight)}}}};const Nt=e.defineComponent$1({mixins:[Ot],props:{paginatedResources:{type:Array,required:!0},keybindOnElementIds:{type:Array,required:!1,default:()=>["files-view","web-nav-sidebar"]}},setup(){const e=s.useStore();return{publicLinkPassword:r.usePublicLinkPassword({store:e}),isPublicLinkContext:r.usePublicLinkContext({store:e})}},data:()=>({selectionCursor:0}),computed:{...e.mapState("Files",["latestSelectedId"])},mounted(){for(const e of this.keybindOnElementIds){const t=document.getElementById(e);t&&t.addEventListener("keydown",this.handleSelectionShortcuts,!1)}document.addEventListener("keydown",this.handleClipboardShortcuts);const t=e.bus.subscribe("app.files.list.clicked",this.resetSelectionCursor),s=e.bus.subscribe("app.files.list.clicked.meta",this.handleCtrlClickAction),i=e.bus.subscribe("app.files.list.clicked.shift",this.handleShiftClickAction);this.$on("beforeDestroy",(()=>{e.bus.unsubscribe("app.files.list.clicked",t),e.bus.unsubscribe("app.files.list.clicked.meta",s),e.bus.unsubscribe("app.files.list.clicked.shift",i);for(const e of this.keybindOnElementIds){const t=document.getElementById(e);t&&t.removeEventListener("keydown",this.handleSelectionShortcuts)}document.removeEventListener("keydown",this.handleClipboardShortcuts)}))},methods:{...e.mapActions(["showMessage","createModal","hideModal"]),...e.mapActions("Files",["copySelectedFiles","cutSelectedFiles","pasteSelectedFiles","resetFileSelection","toggleFileSelection"]),...e.mapMutations("Files",{upsertResource:"UPSERT_RESOURCE",setLatestSelectedFile:"SET_LATEST_SELECTED_FILE_ID",setFileSelection:"SET_FILE_SELECTION",addFileSelection:"ADD_FILE_SELECTION"}),handleSelectionShortcuts(e){const t=e.keyCode||e.which,s=window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey,i=e.shiftKey;this.handleFileSelectionShortcuts(t,i,s,e)},handleClipboardShortcuts(e){const t=e.keyCode||e.which,s=window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey,i=67===t,a=86===t,r=88===t;if(!("Range"===window.getSelection().type))return i&&s?this.copySelectedFiles():a&&s?this.handlePasteAction():r&&s?this.cutSelectedFiles():void 0},handleFileSelectionShortcuts(e,t,s,i){const a=38===e,r=40===e,o=27===e,n=32===e,l=65===e;return r&&!t?this.handleNavigateAction(i):a&&!t?this.handleNavigateAction(i,!0):n?this.handleSpaceAction(i):o?this.handleEscapeAction():r&&t?this.handleShiftDownAction(i):a&&t?this.handleShiftUpAction(i):l&&s?this.handleSelectAllAction(i):void 0},handleNavigateAction(e,t=!1){let s;e.preventDefault(),s=this.latestSelectedId?this.getNextResourceId(t):this.getFirstResourceId(),-1!==s&&(this.resetSelectionCursor(),this.resetFileSelection(),this.addFileSelection({id:s}),this.scrollToResource({id:s}),document.getElementById(this.keybindOnElementId).focus())},handleShiftClickAction(e){const t=document.querySelectorAll(`[data-item-id='${e.id}']`)[0],s=Object.values(t.parentNode.childNodes),i=s.find((e=>e.getAttribute("data-item-id")===this.latestSelectedId)),a=s.find((t=>t.getAttribute("data-item-id")===e.id));let r=s.indexOf(i);r=-1===r?0:r;const o=s.indexOf(a),n=Math.min(r,o),l=Math.max(r,o);for(let e=n;e<=l;e++){const t=s[e].getAttribute("data-item-id");this.addFileSelection({id:t})}this.setLatestSelectedFile(e.id)},handleCtrlClickAction(e){this.toggleFileSelection({id:e.id})},handleEscapeAction(){this.resetSelectionCursor(),this.resetFileSelection()},handleSelectAllAction(e){e.preventDefault(),this.resetSelectionCursor(),this.setFileSelection(this.paginatedResources)},handleSpaceAction(e){e.preventDefault(),this.toggleFileSelection({id:this.latestSelectedId})},handleShiftUpAction(){const e=this.getNextResourceId(!0);-1!==e&&(this.selectionCursor>0?(this.toggleFileSelection({id:this.latestSelectedId}),this.setLatestSelectedFile(e)):this.addFileSelection({id:e}),this.scrollToResource({id:e}),this.selectionCursor=this.selectionCursor-1)},handleShiftDownAction(){const e=this.getNextResourceId();-1!==e&&(this.selectionCursor<0?(this.toggleFileSelection({id:this.latestSelectedId}),this.setLatestSelectedFile(e)):this.addFileSelection({id:e}),this.scrollToResource({id:e}),this.selectionCursor=this.selectionCursor+1)},handlePasteAction(){this.pasteSelectedFiles({client:this.$client,createModal:this.createModal,hideModal:this.hideModal,showMessage:this.showMessage,$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate,$ngettext:this.$ngettext,isPublicLinkContext:this.isPublicLinkContext,publicLinkPassword:this.publicLinkPassword,upsertResource:this.upsertResource})},resetSelectionCursor(){this.selectionCursor=0},getNextResourceId(e=!1){const t=document.querySelectorAll(`[data-item-id='${this.latestSelectedId}']`)[0],s=e?t.previousSibling:t.nextSibling;return null===s?-1:s.getAttribute("data-item-id")},getFirstResourceId:()=>document.getElementsByClassName("oc-tbody-tr")[0].getAttribute("data-item-id")}});var Bt=function(){var e=this.$createElement;return(this._self._c||e)("div")};Bt._withStripped=!0;const Ut=e.normalizeComponent({render:Bt,staticRenderFns:[]},undefined,Nt,undefined,false,undefined,!1,void 0,void 0,void 0),zt=new e.VisibilityObserver;const qt=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,CreateAndUpload:Tt,ResourceTable:W,ListInfo:Ve,Pagination:Je,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,NotFoundMessage:At,ContextActions:Ie,KeyboardActions:Ut,SideBar:ot},mixins:[$t,he],setup(){const e=s.useStore();return{...M(),publicLinkPassword:r.usePublicLinkPassword({store:e})}},computed:{...e.mapGetters("Files",["currentFolder","highlightedFile","totalFilesCount","totalFilesSize"]),...e.mapGetters(["configuration"]),breadcrumbs(){const e=Pt(this.$route,this.$route.params.item),t=e.shift();return Mt({text:this.$gettext("Public link"),to:t.to},...e)},isEmpty(){return this.paginatedResources.length<1},folderNotFound(){return null===this.currentFolder},targetRoute(){return{name:this.$route.name}},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},watch:{$route:{handler:function(e,t){const s=e.name===t?.name,i=e.params?.item===t?.params?.item;s&&i||this.loadResourcesTask.perform(this,s)},immediate:!0}},beforeDestroy(){zt.disconnect()},created(){const t=e.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>e.bus.unsubscribe("app.files.list.load",t)))},methods:{...e.mapActions("Files",["loadPreview"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","REMOVE_FILES","REMOVE_FILES_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),async fileDropped(e){const t=[...this.selectedResources],i=this.paginatedResources.find((t=>t.id===e));if(t.some((t=>t.id===e)))return;if("folder"!==i.type)return;const a=await s.move(t,i,this.$client,this.createModal,this.hideModal,this.showMessage,this.$gettext,this.$gettextInterpolate,this.$ngettext,!1,this.publicLinkPassword);for(const e of a)this.REMOVE_FILES([e]),this.REMOVE_FILES_FROM_SEARCHED([e]),this.REMOVE_FILE_SELECTION(e)},rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!0,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);zt.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var Ht=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("keyboard-actions",{attrs:{"paginated-resources":e.paginatedResources}}),e._v(" "),s("files-view-wrapper",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder],"show-actions-on-selection":!0,"side-bar-open":e.sideBarOpen},scopedSlots:e._u([{key:"actions",fn:function(e){var t=e.limitedScreenSpace;return[s("create-and-upload",{attrs:{"limited-screen-space":t}})]}}])}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.folderNotFound?s("not-found-message",{staticClass:"files-not-found oc-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-public-list-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},e.currentFolder.canCreate()?{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"public-files-call-to-action"}},[e._v('\n            Drag files and folders here or use the "New" or "Upload" buttons to add files\n          ')])]},proxy:!0}:null],null,!0)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-public-files-table","fields-displayed":["name","size","mdate"],"are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir,"drag-drop":!0},on:{fileDropped:e.fileDropped,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Ht._withStripped=!0;const Gt=e.normalizeComponent({render:Ht,staticRenderFns:[]},undefined,qt,undefined,false,undefined,!1,void 0,void 0,void 0),jt=new e.VisibilityObserver;const Vt=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,CreateAndUpload:Tt,ResourceTable:W,QuickActions:He,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,NotFoundMessage:At,ListInfo:Ve,Pagination:Je,ContextActions:Ie,KeyboardActions:Ut,SideBar:ot},mixins:[$t,he,Ot,ue],setup(){const t=s.useRouteParam("storageId"),i=e.computed((()=>s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.unref(t)}})));return{...s.useGraphClient(),...M(),resourceTargetLocation:i,hasShareJail:s.useCapabilityShareJailEnabled()}},computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","currentFolder","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","homeFolder","configuration"]),isEmpty(){return this.paginatedResources.length<1},breadcrumbs(){const e=this.hasShareJail?this.$gettext("Personal"):this.$gettext("All files");return Mt({text:e,to:{path:"/"}},...Pt(this.$route,this.$route.params.item))},folderNotFound(){return null===this.currentFolder},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},watch:{$route:{handler:async function(t,s){if("home"===t.params.storageId||e.isNil(t.params.storageId)){let e=this.user.id;if(this.hasShareJail){e=(await this.graphClient.drives.listMyDrives("","driveType eq personal")).data.value[0].id}return this.$router.replace({to:t,params:{...t.params,storageId:e,item:t.params.item||this.homeFolder},query:t.query}).catch((()=>{}))}if("/"!==this.homeFolder&&e.isNil(t.params.item)&&!t.path.endsWith("/"))return this.$router.replace({name:t.name,params:{...t.params,item:this.homeFolder},query:t.query},(()=>{}),(e=>{console.error(e)}));const i=t.name===s?.name&&t.params?.storageId===s?.params?.storageId,a=t.params?.item===s?.params?.item;i&&a||(await this.loadResourcesTask.perform(this,i),this.scrollToResourceFromRoute())},immediate:!0}},mounted(){const t=e.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>e.bus.unsubscribe("app.files.list.load",t)))},beforeDestroy(){jt.disconnect()},methods:{...e.mapActions("Files",["loadPreview"]),...e.mapActions(["showMessage","createModal","hideModal"]),...e.mapMutations("Files",["REMOVE_FILES","REMOVE_FILES_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),async fileDropped(e){const t=[...this.selectedResources],i=this.paginatedResources.find((t=>t.id===e));if(t.some((t=>t.id===e)))return;if("folder"!==i.type)return;const a=await s.move(t,i,this.$client,this.createModal,this.hideModal,this.showMessage,this.$gettext,this.$gettextInterpolate,this.$ngettext,!1);for(const e of a)this.REMOVE_FILES([e]),this.REMOVE_FILES_FROM_SEARCHED([e]),this.REMOVE_FILE_SELECTION(e)},rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);jt.observe(s.$el,{onEnter:i,onExit:i.cancel})},scrollToResourceFromRoute(){const e=this.$route.query.scrollTo;if(e&&this.paginatedResources.length>0){const t=this.paginatedResources.find((t=>t.name===e));t&&(this.selectedResources=[t],this.scrollToResource(t))}}}});var Wt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("keyboard-actions",{attrs:{"paginated-resources":e.paginatedResources}}),e._v(" "),s("files-view-wrapper",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder],"show-actions-on-selection":!0,"side-bar-open":e.sideBarOpen},scopedSlots:e._u([{key:"actions",fn:function(e){var t=e.limitedScreenSpace;return[s("create-and-upload",{attrs:{"limited-screen-space":t}})]}}])}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.folderNotFound?s("not-found-message",{staticClass:"files-not-found oc-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-personal-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v('\n            Drag files and folders here or use the "New" or "Upload" buttons to add files\n          ')])]},proxy:!0}])}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-personal-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"drag-drop":!0,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileDropped:e.fileDropped,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){var i=t.resource;return[s("quick-actions",{staticClass:"oc-visible@s",class:i.preview,attrs:{item:i,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Wt._withStripped=!0;const Qt=e.normalizeComponent({render:Wt,staticRenderFns:[]},undefined,Vt,undefined,false,undefined,!1,void 0,void 0,void 0),Jt=new e.VisibilityObserver;const Yt=e.defineComponent$1({components:{AppBar:Ue,CreateAndUpload:Tt,ResourceTable:W,QuickActions:He,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,NotFoundMessage:At,ListInfo:Ve,Pagination:Je,ContextActions:Ie,KeyboardActions:Ut,SideBar:ot,FilesViewWrapper:ct},mixins:[$t,he,Ot,ue],setup(){const t=s.useRouteQuery("shareId"),i=s.useRouteParam("shareName"),a=s.useRouteParam("item","");return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-share",{params:{shareName:e.unref(i)},query:{shareId:e.unref(t)}}),shareId:t,shareName:i,relativePath:a}},computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","currentFolder","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","homeFolder","configuration"]),isEmpty(){return this.paginatedResources.length<1},breadcrumbs(){return Mt({text:this.$gettext("Shares"),to:{path:"/files/shares"}},{text:this.$gettext("Shared with me"),to:{path:"/files/shares/with-me"}},...Pt(this.$route,[this.shareName,this.relativePath].join("/")))},folderNotFound(){return null===this.currentFolder},displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{$route:{handler:async function(){await this.loadResourcesTask.perform(this,this.shareId,this.relativePath),this.scrollToResourceFromRoute()},immediate:!0}},mounted(){const t=e.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.shareId,e)}));this.$on("beforeDestroy",(()=>e.bus.unsubscribe("app.files.list.load",t)))},beforeDestroy(){Jt.disconnect()},methods:{...e.mapActions("Files",["loadPreview"]),...e.mapActions(["showMessage"]),...e.mapMutations("Files",["REMOVE_FILES","REMOVE_FILES_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),fetchResources:s.fetchResources,async fileDropped(e){const t=[...this.selectedResources],i=this.paginatedResources.find((t=>t.id===e));if(t.some((t=>t.id===e)))return;if("folder"!==i.type)return;const a=await s.move(t,i,this.$client,this.createModal,this.hideModal,this.showMessage,this.$gettext,this.$gettextInterpolate,this.$ngettext,!1);for(const e of a)this.REMOVE_FILES([e]),this.REMOVE_FILES_FROM_SEARCHED([e]),this.REMOVE_FILE_SELECTION(e)},rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);Jt.observe(s.$el,{onEnter:i,onExit:i.cancel})},scrollToResourceFromRoute(){const e=this.$route.query.scrollTo;if(e&&this.paginatedResources.length>0){const t=this.paginatedResources.find((t=>t.name===e));t&&(this.selectedResources=[t],this.scrollToResource(t))}}}});var Kt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("keyboard-actions",{attrs:{"paginated-resources":e.paginatedResources}}),e._v(" "),s("files-view-wrapper",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder],"show-actions-on-selection":!0,"side-bar-open":e.sideBarOpen},scopedSlots:e._u([{key:"actions",fn:function(e){var t=e.limitedScreenSpace;return[s("create-and-upload",{attrs:{"limited-screen-space":t}})]}}])}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.folderNotFound?s("not-found-message",{staticClass:"files-not-found oc-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-resource-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v('\n            Drag files and folders here or use the "New" or "Upload" buttons to add files\n          ')])]},proxy:!0}])}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-shared-resource-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"drag-drop":!0,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileDropped:e.fileDropped,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){var i=t.resource;return[s("quick-actions",{staticClass:"oc-visible@s",class:i.preview,attrs:{item:i,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Kt._withStripped=!0;const Xt=e.normalizeComponent({render:Kt,staticRenderFns:[]},undefined,Yt,undefined,false,undefined,!1,void 0,void 0,void 0),Zt=new e.VisibilityObserver;const es=e.defineComponent$1({components:{ResourceTable:W,ContextActions:Ie,ListInfo:Ve,NoContentMessage:e.__vue_component__$2},mixins:[he,J,K,ue],props:{title:{type:String,required:!0},emptyMessage:{type:String,required:!1,default:""},items:{type:Array,required:!0},shareStatus:{type:Number,required:!0},sortBy:{type:String,required:!1,default:void 0},sortDir:{type:String,required:!1,default:void 0,validator:e=>void 0===e||[$.Asc.toString(),$.Desc.toString()].includes(e)},sortHandler:{type:Function,required:!0},showMoreToggle:{type:Boolean,default:!1},showMoreToggleCount:{type:Number,default:3},resourceClickable:{type:Boolean,default:!0},displayThumbnails:{type:Boolean,default:!0},sideBarOpen:{type:Boolean,default:!1},fileListHeaderY:{type:Number,default:0}},setup(){const t=s.useStore(),i=s.useCapabilityShareJailEnabled();return{resourceTargetLocation:e.computed((()=>e.unref(i)?s.createLocationSpaces("files-spaces-share"):s.createLocationSpaces("files-spaces-personal",{params:{storageId:t.getters.user.id}}))),resourceTargetParamMapping:e.computed((()=>e.unref(i)?{name:"shareName",path:"item"}:void 0)),resourceTargetQueryMapping:e.computed((()=>e.unref(i)?{id:"shareId"}:void 0)),...P({store:t})}},data:()=>({ShareStatus:i.ShareStatus,showMore:!1}),computed:{...e.mapGetters(["configuration"]),displayedFields:()=>["name","status","owner","sdate","sharedWith"],countFiles(){return this.items.filter((e=>"folder"!==e.type)).length},countFolders(){return this.items.filter((e=>"folder"===e.type)).length},toggleMoreLabel(){return this.showMore?this.$gettext("Show less"):this.$gettext("Show more")},hasMore(){return this.items.length>this.showMoreToggleCount},resourceItems(){return!this.showMoreToggle||this.showMore?this.items:this.items.slice(0,this.showMoreToggleCount)}},beforeDestroy(){Zt.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){const i=e.debounce((({unobserve:e})=>{e(),this.loadAvatars({resource:t}),this.displayThumbnails&&this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);Zt.observe(s.$el,{onEnter:i,onExit:i.cancel})},getShowAcceptButton:e=>e.status===i.ShareStatus.declined||e.status===i.ShareStatus.pending,getShowDeclineButton:e=>e.status===i.ShareStatus.accepted||e.status===i.ShareStatus.pending,toggleShowMore(){this.showMore=!this.showMore}}});var ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h2",{staticClass:"oc-px-m oc-py-s"},[e._v("\n    "+e._s(e.title)+"\n    "),s("span",{staticClass:"oc-text-medium"},[e._v("("+e._s(e.items.length)+")")])]),e._v(" "),e.items.length?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{"data-test-share-status":e.shareStatus,"fields-displayed":e.displayedFields,"sidebar-closed":"","are-thumbnails-displayed":e.displayThumbnails,resources:e.resourceItems,"are-resources-clickable":e.resourceClickable,"target-route":e.resourceTargetLocation,"target-route-param-mapping":e.resourceTargetParamMapping,"target-route-query-mapping":e.resourceTargetQueryMapping,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.sortHandler},scopedSlots:e._u([{key:"status",fn:function(t){var i=t.resource;return[s("div",{key:i.getDomSelector()+i.status,staticClass:"oc-text-nowrap oc-flex oc-flex-middle oc-flex-right"},[e.getShowAcceptButton(i)?s("oc-button",{staticClass:"file-row-share-status-accept",attrs:{size:"small",variation:"success"},on:{click:function(t){return t.stopPropagation(),e.$_acceptShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"check"}}),e._v(" "),s("translate",[e._v("Accept")])],1):e._e(),e._v(" "),e.getShowDeclineButton(i)?s("oc-button",{staticClass:"file-row-share-decline oc-ml-s",attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.$_declineShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"close"}}),e._v(" "),s("translate",[e._v("Decline")])],1):e._e()],1)]}},{key:"contextMenu",fn:function(){return[s("context-actions",{attrs:{items:e.selectedResources}})]},proxy:!0},{key:"footer",fn:function(){return[e.showMoreToggle&&e.hasMore?s("div",{staticClass:"oc-width-1-1 oc-text-center oc-mt"},[s("oc-button",{attrs:{id:"files-shared-with-me-show-all",appearance:"raw","gap-size":"xsmall",size:"small","data-test-expand":(!e.showMore).toString()},on:{click:e.toggleShowMore}},[e._v("\n          "+e._s(e.toggleMoreLabel)+"\n          "),s("oc-icon",{attrs:{name:"arrow-"+(e.showMore?"up":"down")+"-s","fill-type":"line"}})],1)],1):s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.countFiles,folders:e.countFolders}})]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}}):s("no-content-message",{staticClass:"files-empty oc-flex-stretch",attrs:{icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",[e._v(e._s(e.emptyMessage))])]},proxy:!0}],null,!1,1699937534)})],1)};ts._withStripped=!0;const ss=e.normalizeComponent({render:ts,staticRenderFns:[]},undefined,es,"data-v-1ff6a1b8",false,undefined,!1,void 0,void 0,void 0);const is=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,AppLoadingSpinner:e.__vue_component__$1,SharedWithMeSection:ss,SideBar:ot},setup(){const{areResourcesLoading:t,fields:s,fileListHeaderY:a,loadResourcesTask:r,selectedResources:o,selectedResourcesIds:n,sideBarActivePanel:l,sideBarOpen:c,storeItems:d}=M(),h=e.computed((()=>e.unref(d).filter((e=>e.status===i.ShareStatus.pending)))),{sortBy:u,sortDir:p,items:m,handleSort:f}=E({items:h,fields:s,sortByQueryName:"pending-sort-by",sortDirQueryName:"pending-sort-dir"}),g=e.computed((()=>e.unref(d).filter((e=>e.status===i.ShareStatus.accepted)))),{sortBy:b,sortDir:v,items:_,handleSort:S}=E({items:g,fields:s,sortByQueryName:"accepted-sort-by",sortDirQueryName:"accepted-sort-dir"}),x=e.computed((()=>e.unref(d).filter((e=>e.status===i.ShareStatus.declined)))),{sortBy:w,sortDir:y,items:C,handleSort:$}=E({items:x,fields:s,sortByQueryName:"declined-sort-by",sortDirQueryName:"declined-sort-dir"});return{loadResourcesTask:r,areResourcesLoading:t,selectedResources:o,selectedResourcesIds:n,fileListHeaderY:a,sideBarOpen:c,sideBarActivePanel:l,pendingHandleSort:f,pendingSortBy:u,pendingSortDir:p,pendingItems:m,acceptedHandleSort:S,acceptedSortBy:b,acceptedSortDir:v,acceptedItems:_,declinedHandleSort:$,declinedSortBy:w,declinedSortDir:y,declinedItems:C}},data:()=>({ShareStatus:i.ShareStatus}),computed:{...e.mapGetters(["configuration"]),pendingTitle(){return this.$gettext("Pending shares")},acceptedTitle(){return this.$gettext("Accepted shares")},acceptedEmptyMessage(){return this.$gettext("You are not collaborating on other people's resources.")},declinedTitle(){return this.$gettext("Declined shares")},declinedEmptyMessage(){return this.$gettext("You don't have any previously declined shares.")},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},created(){this.loadResourcesTask.perform()}});var as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",{staticClass:"oc-flex-column"},[s("app-bar",{attrs:{"has-shares-navigation":!0,"has-bulk-actions":!0,"side-bar-open":e.sideBarOpen}}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.pendingItems.length>0?s("shared-with-me-section",{attrs:{id:"files-shared-with-me-pending-section","display-thumbnails":!1,"file-list-header-y":e.fileListHeaderY,items:e.pendingItems,"resource-clickable":!1,"share-status":e.ShareStatus.pending,"show-more-toggle":!0,"side-bar-open":e.sideBarOpen,"sort-by":e.pendingSortBy,"sort-dir":e.pendingSortDir,"sort-handler":e.pendingHandleSort,title:e.pendingTitle}}):e._e(),e._v(" "),s("shared-with-me-section",{attrs:{id:"files-shared-with-me-accepted-section","display-thumbnails":e.displayThumbnails,"empty-message":e.acceptedEmptyMessage,"file-list-header-y":e.fileListHeaderY,items:e.acceptedItems,"resource-clickable":!0,"share-status":e.ShareStatus.accepted,"side-bar-open":e.sideBarOpen,"sort-by":e.acceptedSortBy,"sort-dir":e.acceptedSortDir,"sort-handler":e.acceptedHandleSort,title:e.acceptedTitle}}),e._v(" "),s("shared-with-me-section",{attrs:{id:"files-shared-with-me-declined-section","display-thumbnails":!1,"empty-message":e.declinedEmptyMessage,"file-list-header-y":e.fileListHeaderY,items:e.declinedItems,"resource-clickable":!1,"share-status":e.ShareStatus.declined,"show-more-toggle":!0,"side-bar-open":e.sideBarOpen,"sort-by":e.declinedSortBy,"sort-dir":e.declinedSortDir,"sort-handler":e.declinedHandleSort,title:e.declinedTitle}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};as._withStripped=!0;const rs=e.normalizeComponent({render:as,staticRenderFns:[]},undefined,is,undefined,false,undefined,!1,void 0,void 0,void 0),os=new e.VisibilityObserver;const ns=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,ResourceTable:W,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:Ve,Pagination:Je,ContextActions:Ie,SideBar:ot},mixins:[he,ue],setup(){const e=s.useStore();return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.getters.user.id}})}},computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount"]),...e.mapGetters(["configuration","user"]),isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){os.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){const i=e.debounce((({unobserve:e})=>{e(),this.loadAvatars({resource:t}),this.displayThumbnails&&this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);os.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var ls=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",[s("app-bar",{attrs:{"has-shares-navigation":!0,"side-bar-open":e.sideBarOpen}}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-with-others-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("\n            You are currently not collaborating on any of your resources with other people\n          ")])]},proxy:!0}],null,!1,2890156898)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-shared-with-others-table","fields-displayed":["name","sharedWith","sdate"],"are-thumbnails-displayed":e.displayThumbnails,"are-paths-displayed":!0,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};ls._withStripped=!0;const cs=e.normalizeComponent({render:ls,staticRenderFns:[]},undefined,ns,undefined,false,undefined,!1,void 0,void 0,void 0),ds=new e.VisibilityObserver;const hs=e.defineComponent$1({components:{FilesViewWrapper:ct,AppBar:Ue,ResourceTable:W,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:Ve,Pagination:Je,ContextActions:Ie,SideBar:ot},mixins:[he,ue],setup(){const e=s.useStore();return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.getters.user.id}})}},computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount"]),...e.mapGetters(["configuration"]),helpersEnabled(){return this.configuration?.options?.contextHelpers},isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){ds.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview"]),...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);ds.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var us=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",[s("app-bar",{attrs:{"has-shares-navigation":!0,"side-bar-open":e.sideBarOpen}}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-via-link-empty",icon:"link"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources with a public link at the moment")])]},proxy:!0}],null,!1,2205227924)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-shared-via-link-table","fields-displayed":["name","sharedWith","sdate"],"are-thumbnails-displayed":e.displayThumbnails,"are-paths-displayed":!0,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};us._withStripped=!0;const ps=e.normalizeComponent({render:us,staticRenderFns:[]},undefined,hs,undefined,false,undefined,!1,void 0,void 0,void 0);const ms=e.defineComponent({name:"SpaceQuotaModal",components:{QuotaSelect:e.__vue_component__$3},props:{space:{type:Object,required:!0},cancel:{type:Function,required:!0}},setup:()=>({...s.useGraphClient()}),data:function(){return{selectedOption:0}},computed:{confirmButtonDisabled(){return this.space.spaceQuota.total===this.selectedOption},modalTitle(){return this.$gettextInterpolate(this.$gettext("Change quota for space %{name}"),{name:this.space.name})}},mounted(){this.selectedOption=this.space.spaceQuota.total||0},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),changeSelectedQuotaOption(e){this.selectedOption=e.value},editQuota(){return this.graphClient.drives.updateDrive(this.space.id,{quota:{total:this.selectedOption}},{}).then((({data:e})=>{this.cancel(),this.UPDATE_SPACE_FIELD({id:this.space.id,field:"spaceQuota",value:e.quota}),this.showMessage({title:this.$gettext("Space quota was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to change space quota"),status:"danger"})}))}}});var fs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("portal",{attrs:{to:"app.runtime.modal"}},[s("oc-modal",{attrs:{title:e.modalTitle,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Confirm"),"button-confirm-disabled":e.confirmButtonDisabled},on:{confirm:e.editQuota,cancel:e.cancel},scopedSlots:e._u([{key:"content",fn:function(){return[s("quota-select",{attrs:{title:e.$gettext("Space quota"),"total-quota":e.selectedOption},on:{selectedOptionChange:e.changeSelectedQuotaOption}})]},proxy:!0}])})],1)};fs._withStripped=!0;const gs=e.normalizeComponent({render:fs,staticRenderFns:[]},undefined,ms,undefined,false,undefined,!1,void 0,void 0,void 0);const bs={name:"SpaceReadmeContentModal",props:{space:{type:Object,required:!0},cancel:{type:Function,required:!0}},data:function(){return{readmeContent:""}},computed:{modalTitle(){return this.$gettextInterpolate(this.$gettext("Edit description for space %{name}"),{name:this.space.name})}},watch:{"space.spaceQuota":{handler:function(e){e&&this.setOptions()},deep:!0}},async mounted(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");this.readmeContent=await this.$client.files.getFileContents(t)},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),setReadmeContent(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");this.$client.files.getFileContents(t).then((e=>{this.readmeContent=e}))},editReadme(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");return this.$client.files.putFileContents(t,this.readmeContent).then((e=>{this.cancel(),this.UPDATE_RESOURCE_FIELD({id:this.space.id,field:"spaceReadmeData",value:{...this.space.spaceReadmeData,etag:e.ETag}}),this.showMessage({title:this.$gettext("Space description was edited successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to edit space description"),status:"danger"})}))}}};var vs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("portal",{attrs:{to:"app.runtime.modal"}},[s("oc-modal",{attrs:{"focus-trap-initial":"#description-input-area",title:e.modalTitle,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Confirm")},on:{confirm:e.editReadme,cancel:e.cancel},scopedSlots:e._u([{key:"content",fn:function(){return[s("label",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-label",attrs:{for:"description-input-area"}},[e._v("Space description")]),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.readmeContent,expression:"readmeContent"}],staticClass:"oc-width-1-1 oc-height-1-1 oc-text-input",attrs:{id:"description-input-area",rows:"30"},domProps:{value:e.readmeContent},on:{input:function(t){t.target.composing||(e.readmeContent=t.target.value)}}})]},proxy:!0}])})],1)};vs._withStripped=!0;const _s=e.normalizeComponent({render:vs,staticRenderFns:[]},undefined,bs,undefined,false,undefined,!1,void 0,void 0,void 0);var Ss={computed:{...e.mapGetters(["configuration"]),...e.mapState(["user"]),$_delete_items(){return[{name:"delete",icon:"close-circle",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canBeDeleted({user:this.user}),componentType:"button",class:"oc-files-actions-delete-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["REMOVE_FILES"]),...e.mapMutations("runtime/spaces",["REMOVE_SPACE"]),$_delete_trigger({resources:e}){if(1!==e.length)return;const t={variation:"danger",icon:"alarm-warning",title:this.$gettext("Delete space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),message:this.$gettext("Are you sure you want to delete this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_delete_deleteSpace(e[0].id)};this.createModal(t)},$_delete_deleteSpace(e){const t=this.$store.getters["runtime/auth/accessToken"];return s.clientService.graphAuthenticated(this.configuration.server,t).drives.deleteDrive(e,"",{headers:{Purge:"T"}}).then((()=>{this.hideModal(),this.REMOVE_FILES([{id:e}]),this.REMOVE_SPACE({id:e}),this.showMessage({title:this.$gettext("Space was deleted successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to delete space"),status:"danger"})}))}}},xs={computed:{...e.mapGetters(["configuration","user"]),$_rename_items(){return[{name:"rename",icon:"pencil",label:()=>this.$gettext("Rename"),handler:this.$_rename_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canRename({user:this.user}),componentType:"button",class:"oc-files-actions-rename-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),$_rename_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Rename space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Rename"),hasInput:!0,inputLabel:this.$gettext("Space name"),inputValue:e[0].name,onCancel:this.hideModal,onConfirm:t=>this.$_rename_renameSpace(e[0].id,t),onInput:this.$_rename_checkName};this.createModal(t)},$_rename_checkName(e){return""===e.trim()?this.setModalInputErrorMessage(this.$gettext("Space name cannot be empty")):this.setModalInputErrorMessage(null)},$_rename_renameSpace(e,t){const i=this.$store.getters["runtime/auth/accessToken"];return s.clientService.graphAuthenticated(this.configuration.server,i).drives.updateDrive(e,{name:t},{}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"name",value:t}),this.UPDATE_SPACE_FIELD({id:e,field:"name",value:t}),this.showMessage({title:this.$gettext("Space name was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to rename space"),status:"danger"})}))}}},ws={computed:{...e.mapGetters(["configuration"]),...e.mapState(["user"]),$_restore_items(){return[{name:"restore",icon:"play-circle",label:()=>this.$gettext("Enable"),handler:this.$_restore_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canRestore({user:this.user}),componentType:"button",class:"oc-files-actions-restore-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_restore_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Restore space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Restore"),icon:"alarm-warning",message:this.$gettext("Are you sure you want to restore this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_restore_restoreSpace(e[0].id)};this.createModal(t)},$_restore_restoreSpace(e){const t=this.$store.getters["runtime/auth/accessToken"];return s.clientService.graphAuthenticated(this.configuration.server,t).drives.updateDrive(e,{},{headers:{Restore:!0}}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"disabled",value:!1}),this.showMessage({title:this.$gettext("Space was restored successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to restore space"),status:"danger"})}))}}},ys={computed:{$_showDetails_items(){return[{name:"show-details",icon:"information",label:()=>this.$gettext("Details"),handler:this.$_showDetails_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showDetails_trigger({resources:e}){1===e.length&&(this.SET_FILE_SELECTION([e[0]]),this.$_showDetails_openSideBar())},$_showDetails_openSideBar(){e.bus.publish(s.SideBarEventTopics.open)}}},Cs={computed:{...e.mapGetters(["configuration"]),$_editDescription_items(){return[{name:"editDescription",icon:"h-2",iconFillType:"none",label:()=>this.$gettext("Edit subtitle"),handler:this.$_editDescription_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canEditDescription({user:this.user}),componentType:"button",class:"oc-files-actions-edit-description-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_editDescription_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Change subtitle for space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Confirm"),hasInput:!0,inputLabel:this.$gettext("Space subtitle"),inputValue:e[0].description,onCancel:this.hideModal,onConfirm:t=>this.$_editDescription_editDescriptionSpace(e[0].id,t)};this.createModal(t)},$_editDescription_editDescriptionSpace(e,t){const i=this.$store.getters["runtime/auth/accessToken"];return s.clientService.graphAuthenticated(this.configuration.server,i).drives.updateDrive(e,{description:t},{}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"description",value:t}),this.showMessage({title:this.$gettext("Space subtitle was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to change space subtitle"),status:"danger"})}))}}},$s={data:()=>({$_editQuota_modalOpen:!1,$_editQuota_selectedSpace:null}),computed:{...e.mapState("Files",["currentFolder"]),...e.mapState(["user"]),$_editQuota_items(){return[{name:"editQuota",icon:"cloud",label:()=>this.$gettext("Edit quota"),handler:this.$_editQuota_trigger,isEnabled:({resources:e})=>1===e.length&&(!!e[0].spaceQuota&&this.$permissionManager.canEditSpaceQuota()),componentType:"button",class:"oc-files-actions-edit-quota-trigger"}]}},methods:{$_editQuota_trigger({resources:e}){this.$data.$_editQuota_selectedSpace=e[0],this.$data.$_editQuota_modalOpen=!0},$_editQuota_closeModal(){this.$data.$_editQuota_modalOpen=!1}}},Es={computed:{$_deletedFiles_items(){return[{name:"deletedFiles",icon:"delete-bin-5",label:()=>this.$gettext("Deleted files"),handler:this.$_deletedFiles_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"button",class:"oc-files-actions-delete-trigger"}]}},methods:{$_deletedFiles_trigger({resources:e}){this.$router.push(s.createLocationTrash("files-trash-spaces-project",{params:{storageId:e[0].id}}))}}},Rs={computed:{...e.mapGetters(["configuration"]),...e.mapState(["user"]),$_disable_items(){return[{name:"disable",icon:"stop-circle",label:()=>this.$gettext("Disable"),handler:this.$_disable_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canDisable({user:this.user}),componentType:"button",class:"oc-files-actions-disable-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_disable_trigger({resources:e}){if(1!==e.length)return;const t={variation:"danger",icon:"alarm-warning",title:this.$gettext("Disable space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Disable"),message:this.$gettext("Are you sure you want to disable this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_disable_disableSpace(e[0].id)};this.createModal(t)},$_disable_disableSpace(e){const t=this.$store.getters["runtime/auth/accessToken"];return s.clientService.graphAuthenticated(this.configuration.server,t).drives.deleteDrive(e).then((()=>{if(this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"disabled",value:!0}),this.showMessage({title:this.$gettext("Space was disabled successfully")}),!s.isLocationSpacesActive(this.$router,"files-spaces-projects"))return s.isLocationSpacesActive(this.$router,"files-spaces-project")?this.$router.push(s.createLocationSpaces("files-spaces-projects")):void 0})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to disable space"),status:"danger"})}))},isDisabled:e=>!1}},ks={computed:{$_showMembers_items(){return[{name:"show-members",icon:"group",label:()=>this.$gettext("Members"),handler:this.$_showMembers_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showMembers_trigger({resources:t}){this.SET_FILE_SELECTION(t),e.bus.publish(s.SideBarEventTopics.openWithPanel,"space-share-item")}}},Is={data:function(){return{$_uploadImage_selectedSpace:null}},computed:{...e.mapState("Files",["currentFolder"]),...e.mapGetters(["configuration"]),$_uploadImage_items(){return[{name:"upload-space-image",icon:"image-add",handler:this.$_uploadImage_trigger,label:()=>this.$gettext("Edit image"),isEnabled:({resources:e})=>1===e.length&&e[0].canEditImage({user:this.user}),componentType:"button",class:"oc-files-actions-upload-space-image-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),...e.mapActions(["showMessage"]),$_uploadImage_trigger({resources:e}){1===e.length&&(this.$data.$_uploadImage_selectedSpace=e[0],this.$refs.spaceImageInput.click())},$_uploadImage_uploadImageSpace(t){const i=this.$store.getters["runtime/auth/accessToken"],a=s.clientService.graphAuthenticated(this.configuration.server,i),r=t.currentTarget.files[0];if(!r)return;if(!se.isMimetypeSupported(r.type,!0))return this.showMessage({title:this.$gettext("The file type is unsupported"),status:"danger"});const o={};return r.lastModifiedDate?o["X-OC-Mtime"]=""+r.lastModifiedDate.getTime()/1e3:r.lastModified&&(o["X-OC-Mtime"]=""+r.lastModified/1e3),this.$client.files.putFileContents(`/spaces/${this.$data.$_uploadImage_selectedSpace.id}/.space/${r.name}`,r,{headers:o,overwrite:!0}).then((t=>a.drives.updateDrive(this.$data.$_uploadImage_selectedSpace.id,{special:[{specialFolder:{name:"image"},id:t["OC-FileId"]}]},{}).then((({data:t})=>{this.UPDATE_RESOURCE_FIELD({id:this.$data.$_uploadImage_selectedSpace.id,field:"spaceImageData",value:t.special.find((e=>"image"===e.specialFolder.name))}),this.showMessage({title:this.$gettext("Space image was uploaded successfully")}),e.bus.publish("app.files.list.load")})))).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to upload space image"),status:"danger"})}))}}},Fs={data:function(){return{$_editReadmeContent_modalOpen:!1}},computed:{...e.mapState(["user"]),$_editReadmeContent_items(){return[{name:"editReadmeContent",icon:"article",label:()=>this.$gettext("Edit description"),handler:this.$_editReadmeContent_trigger,isEnabled:({resources:e})=>1===e.length&&(!!e[0].canEditReadme({user:this.user})&&!!e[0].spaceReadmeData),componentType:"button",class:"oc-files-actions-edit-readme-content-trigger"}]}},methods:{$_editReadmeContent_trigger(){this.$data.$_editReadmeContent_modalOpen=!0},$_editReadmeContent_closeModal(){this.$data.$_editReadmeContent_modalOpen=!1}}};const Ts={name:"SpaceContextActions",components:{ContextActionMenu:we,QuotaModal:gs,ReadmeContentModal:_s},mixins:[xs,Ss,Cs,$s,Es,Rs,ys,ks,ws,Is,Fs],props:{items:{type:Array,required:!0}},computed:{quotaModalSelectedSpace(){return this.$data.$_editQuota_selectedSpace},quotaModalIsOpen(){return this.$data.$_editQuota_modalOpen},readmeContentModalIsOpen(){return this.$data.$_editReadmeContent_modalOpen},menuSections(){const e=[];return this.menuItemsMembers.length&&e.push({name:"members",items:this.menuItemsMembers}),this.menuItemsPrimaryActions.length&&e.push({name:"primaryActions",items:this.menuItemsPrimaryActions}),this.menuItemsSecondaryActions.length&&e.push({name:"secondaryActions",items:this.menuItemsSecondaryActions}),this.menuItemsTrashBin.length&&e.push({name:"trashBin",items:this.menuItemsTrashBin}),this.menuItemsSidebar.length&&e.push({name:"sidebar",items:this.menuItemsSidebar}),e},filterParams(){return{resources:this.items}},menuItemsMembers(){return[...[...this.$_showMembers_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsPrimaryActions(){const e=[...this.$_rename_items,...this.$_editDescription_items,...this.$_uploadImage_items];return s.isLocationSpacesActive(this.$router,"files-spaces-project")&&this.$route.params.storageId&&e.splice(2,0,...this.$_editReadmeContent_items),[...e].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSecondaryActions(){return[...[...this.$_editQuota_items,...this.$_disable_items,...this.$_restore_items,...this.$_delete_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsTrashBin(){return[...[...this.$_deletedFiles_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSidebar(){return[...[...this.$_showDetails_items]].filter((e=>e.isEnabled(this.filterParams)))}},methods:{closeQuotaModal(){this.$_editQuota_closeModal()},closeReadmeContentModal(){this.$_editReadmeContent_closeModal()}}};var Ls=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("context-action-menu",{attrs:{"menu-sections":e.menuSections,items:e.items}}),e._v(" "),e.quotaModalIsOpen?s("quota-modal",{attrs:{cancel:e.closeQuotaModal,space:e.quotaModalSelectedSpace}}):e._e(),e._v(" "),e.readmeContentModalIsOpen?s("readme-content-modal",{attrs:{cancel:e.closeReadmeContentModal,space:e.items[0]}}):e._e(),e._v(" "),s("input",{ref:"spaceImageInput",attrs:{id:"space-image-upload-input",type:"file",name:"file",multiple:"",tabindex:"-1",accept:"image/*"},on:{change:e.$_uploadImage_uploadImageSpace}})],1)};Ls._withStripped=!0;const Ds=e.normalizeComponent({render:Ls,staticRenderFns:[]},undefined,Ts,undefined,false,undefined,!1,void 0,void 0,void 0),As=new e.VisibilityObserver;const Ps=e.defineComponent$1({components:{FilesViewWrapper:ct,SideBar:ot,AppBar:Ue,CreateAndUpload:Tt,NoContentMessage:e.__vue_component__$2,AppLoadingSpinner:e.__vue_component__$1,NotFoundMessage:At,ResourceTable:W,ListInfo:Ve,Pagination:Je,ContextActions:Ie,SpaceContextActions:Ds,KeyboardActions:Ut,QuickActions:He},mixins:[$t,he],provide(){return{currentSpace:e.computed((()=>this.space))}},setup(){const t=s.useStore(),i=e.ref({});return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-project"),space:i,accessToken:s.useAccessToken({store:t})}},data:function(){return{markdownContent:"",markdownCollapsed:!0,markdownContainerCollapsedClass:"collapsed",showMarkdownCollapse:!1,markdownResizeObserver:new ResizeObserver(this.onMarkdownResize),imageExpanded:!1,imageContent:null}},computed:{...e.mapGetters("Files",["highlightedFile","currentFolder","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","configuration"]),...e.mapState(["app"]),breadcrumbs(){return Mt({text:this.$gettext("Spaces"),to:{path:"/files/spaces/projects"}},{text:this.space?.name,to:{path:`/files/spaces/projects/${this.$route.params.storageId}`}},...Pt(this.$route,this.$route.params.item))},isSpaceRoot(){return!this.$route.params.item},isEmpty(){return this.paginatedResources.length<1},markdownCollapseIcon(){return!0===this.markdownCollapsed?"add":"subtract"},markdownCollapseText(){return!0===this.markdownCollapsed?this.$gettext("Show more"):this.$gettext("Show less")},displayThumbnails(){return!this.configuration?.options?.disablePreviews},memberCount(){return this.space.spaceMemberIds.length},memberCountString(){const e=this.$ngettext("%{count} member","%{count} members",this.memberCount);return this.$gettextInterpolate(e,{count:this.memberCount})}},watch:{$route:{handler:async function(e,t){const s=e.name===t?.name&&e.params?.storageId===t?.params?.storageId,i=e.params?.item===t?.params?.item;s&&i||!t||await this.loadResourcesTask.perform(this,s,e.params.item),this.$refs.markdownContainer&&(this.markdownResizeObserver&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer),this.markdownResizeObserver.observe(this.$refs.markdownContainer))},immediate:!0},"space.spaceImageData":{handler:function(e){if(!e)return;const t=decodeURI(this.space.spaceImageData.webDavUrl).split("/"),a=t.find((e=>e.startsWith(this.space.id)));if(!a)return;const r=t.slice(t.indexOf(a)+1).join("/");this.$client.files.fileInfo(i.buildWebDavSpacesPath(a,decodeURIComponent(r))).then((e=>{const t=s.buildResource(e);o.loadPreview({resource:t,isPublic:!1,dimensions:S.Preview,server:n.configurationManager.serverUrl,userId:this.user.id,token:this.accessToken}).then((e=>{this.imageContent=e}))}))},deep:!0},"space.spaceReadmeData":{handler:function(t){if(!t)return;const s=decodeURI(this.space.spaceReadmeData.webDavUrl).split("/"),a=s.find((e=>e.startsWith(this.space.id)));if(!a)return;const r=s.slice(s.indexOf(a)+1).join("/");this.$client.files.getFileContents(i.buildWebDavSpacesPath(a,decodeURIComponent(r))).then((t=>{this.markdownResizeObserver&&this.$refs.markdownContainer&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer);const s=e.marked_umd.marked.parse(t);this.markdownContent=e.sanitizeHtml_1(s),this.markdownContent&&this.markdownResizeObserver.observe(this.$refs.markdownContainer)}))},deep:!0}},async mounted(){await this.loadResourcesTask.perform(this,!1,this.$route.params.item||""),document.title=`${this.$route.meta.title} - ${this.space.name} - ${this.configuration.currentTheme.general.name}`,this.$route.params.name=this.space.name;const t=e.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>{e.bus.unsubscribe("app.files.list.load",t)}))},beforeDestroy(){As.disconnect(),this.$refs.markdownContainer&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer)},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadCurrentFileOutgoingShares"]),...e.mapMutations("runtime/spaces",["UPSERT_SPACE"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","REMOVE_FILES","REMOVE_FILES_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),async fileDropped(e){const t=[...this.selectedResources],i=this.paginatedResources.find((t=>t.id===e));if(t.some((t=>t.id===e)))return;if("folder"!==i.type)return;const a=await s.move(t,i,this.$client,this.createModal,this.hideModal,this.showMessage,this.$gettext,this.$gettextInterpolate,this.$ngettext,!1);for(const e of a)this.REMOVE_FILES([e]),this.REMOVE_FILES_FROM_SEARCHED([e]),this.REMOVE_FILE_SELECTION(e)},rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);As.observe(s.$el,{onEnter:i,onExit:i.cancel})},toggleCollapseMarkdown(){return this.markdownCollapsed=!this.markdownCollapsed,this.$refs.markdownContainer.classList.toggle(this.markdownContainerCollapsedClass)},toggleImageExpanded(){this.imageExpanded=!this.imageExpanded},onMarkdownResize(){if(!this.$refs.markdownContainer)return;this.$refs.markdownContainer.classList.remove(this.markdownContainerCollapsedClass);if(this.$refs.markdownContainer.offsetHeight<150)return this.showMarkdownCollapse=!1;this.showMarkdownCollapse=!0,this.markdownCollapsed&&this.$refs.markdownContainer.classList.add(this.markdownContainerCollapsedClass)},openSidebarSharePanel(){this.selectedResources=[this.space],e.bus.publish(s.SideBarEventTopics.openWithPanel,"space-share-item")}}});var Ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space-overview oc-flex"},[s("keyboard-actions",{attrs:{"paginated-resources":e.paginatedResources}}),e._v(" "),s("files-view-wrapper",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder],"show-actions-on-selection":!0,"side-bar-open":e.sideBarOpen},scopedSlots:e._u([{key:"actions",fn:function(e){var t=e.limitedScreenSpace;return[s("create-and-upload",{attrs:{"limited-screen-space":t}})]}}])}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.space.id?e.isSpaceRoot?s("div",[s("div",{staticClass:"oc-px-m oc-mt-m",class:{"oc-flex":e.imageContent&&!e.imageExpanded}},[e.imageContent?s("div",{class:{"oc-width-1-4 oc-mr-l":!e.imageExpanded}},[s("img",{staticClass:"space-overview-image oc-cursor-pointer",class:{expanded:e.imageExpanded},attrs:{alt:"",src:e.imageContent},on:{click:e.toggleImageExpanded}})]):e._e(),e._v(" "),s("div",{class:{"oc-width-3-4":e.imageContent&&!e.imageExpanded}},[s("div",{staticClass:"oc-flex oc-mb-s oc-flex-middle oc-flex-between"},[s("div",{staticClass:"oc-flex oc-flex-middle"},[s("h1",{staticClass:"space-overview-name oc-text-truncate"},[e._v(e._s(e.space.name))]),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show context menu"),expression:"$gettext('Show context menu')"}],staticClass:"oc-ml-s",attrs:{id:"space-context-btn","aria-label":e.$gettext("Show context menu"),appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{attrs:{"drop-id":"space-context-drop",toggle:"#space-context-btn",mode:"click","close-on-click":"",options:{delayHide:0},"padding-size":"small",position:"right-start"}},[s("space-context-actions",{attrs:{items:[e.space]}})],1)],1),e._v(" "),e.memberCount?s("oc-button",{attrs:{"aria-label":e.$gettext("Open context menu and show members"),appearance:"raw"},on:{click:e.openSidebarSharePanel}},[s("oc-icon",{attrs:{name:"group","fill-type":"line",size:"small"}}),e._v(" "),s("span",{staticClass:"space-overview-people-count oc-text-small",domProps:{textContent:e._s(e.memberCountString)}})],1):e._e()],1),e._v(" "),e.space.description?s("p",{staticClass:"oc-mt-rm"},[e._v(e._s(e.space.description))]):e._e(),e._v(" "),s("div",[s("div",{ref:"markdownContainer",staticClass:"markdown-container",domProps:{innerHTML:e._s(e.markdownContent)}}),e._v(" "),e.showMarkdownCollapse?s("div",{staticClass:"markdown-collapse oc-text-center oc-mt-s"},[s("oc-button",{attrs:{appearance:"raw"},on:{click:e.toggleCollapseMarkdown}},[s("oc-icon",{attrs:{name:e.markdownCollapseIcon}}),e._v(" "),s("span",[e._v(e._s(e.markdownCollapseText))])],1)],1):e._e()])])])]):e._e():s("not-found-message",{staticClass:"space-not-found oc-height-1-1"}),e._v(" "),e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-space-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-muted"},[e._v("No resources found")])]},proxy:!0}],null,!1,1941445188)}):s("resource-table",{staticClass:"files-table oc-mt-xl",attrs:{id:"files-spaces-table",resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"sort-by":e.sortBy,"sort-dir":e.sortDir,"drag-drop":!0},on:{fileDropped:e.fileDropped,sort:e.handleSort,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted},scopedSlots:e._u([{key:"quickActions",fn:function(t){var i=t.resource;return[s("quick-actions",{staticClass:"oc-visible@s",class:i.preview,attrs:{item:i,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Ms._withStripped=!0;const Os=e.normalizeComponent({render:Ms,staticRenderFns:[]},undefined,Ps,undefined,false,undefined,!1,void 0,void 0,void 0);const Ns=e.defineComponent$1({name:"TrashBin",components:{FilesViewWrapper:ct,AppBar:Ue,ResourceTable:W,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:Ve,Pagination:Je,ContextActions:Ie,SideBar:ot},mixins:[ue],props:{breadcrumbs:{type:Array,default:()=>[]},noContentMessage:{type:String,required:!1,default:""}},setup:()=>({...M()}),computed:{...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount"]),isEmpty(){return this.paginatedResources.length<1}},created(){this.loadResourcesTask.perform(this);const t=e.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>{e.bus.unsubscribe("app.files.list.load",t)}))},methods:{...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"])}});var Bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",[s("app-bar",{attrs:{breadcrumbs:e.breadcrumbs,"has-bulk-actions":!0,"side-bar-open":e.sideBarOpen}}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-trashbin-empty",icon:"delete-bin-5"},scopedSlots:e._u([{key:"message",fn:function(){return[e.noContentMessage?s("span",[e._v(e._s(e.noContentMessage))]):s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("You have no deleted files")])]},proxy:!0}],null,!1,1977983392)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":e.sideBarOpen},attrs:{id:"files-trashbin-table","fields-displayed":["name","ddate"],"are-paths-displayed":!0,"are-thumbnails-displayed":!1,resources:e.paginatedResources,"are-resources-clickable":!1,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Bs._withStripped=!0;const Us=e.normalizeComponent({render:Bs,staticRenderFns:[]},undefined,Ns,undefined,false,undefined,!1,void 0,void 0,void 0);const zs=e.defineComponent$1({components:{TrashBin:Us},setup(){const t=e.ref({}),a=s.useRouteParam("storageId"),{graphClient:r}=s.useGraphClient(),o=e.q((function*(s,o){const n=(yield e.unref(r).drives.getDrive(e.unref(a))).data||{};t.value=i.buildSpace(n)}));return{space:t,loadResourcesTask:o}},computed:{...e.mapGetters(["configuration"]),breadcrumbs(){return[{text:this.$gettext("Deleted files"),to:"/files/trash"},{allowContextActions:!0,text:this.space?.name,onClick:()=>e.bus.publish("app.files.list.load")}]}},async mounted(){await this.loadResourcesTask.perform(this),document.title=`${this.$router.currentRoute.meta.title} - ${this.space.name} - ${this.configuration.currentTheme.general.name}`}});var qs=function(){var e=this,t=e.$createElement;return(e._self._c||t)("trash-bin",{attrs:{breadcrumbs:e.breadcrumbs,"no-content-message":e.$gettext("Space has no deleted files")}})};qs._withStripped=!0;const Hs=e.normalizeComponent({render:qs,staticRenderFns:[]},undefined,zs,undefined,false,undefined,!1,void 0,void 0,void 0);const Gs=e.defineComponent$1({setup:()=>({...s.useGraphClient()}),methods:{...e.mapActions(["showMessage","createModal","hideModal","setModalInputErrorMessage"]),...e.mapMutations("runtime/spaces",["UPSERT_SPACE"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","SET_FILE_SELECTION","UPSERT_RESOURCE","UPDATE_RESOURCE_FIELD"]),showCreateSpaceModal(){const e={variation:"passive",title:this.$gettext("Create a new space"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Create"),hasInput:!0,inputLabel:this.$gettext("Space name"),inputValue:this.$gettext("New space"),onCancel:this.hideModal,onConfirm:this.addNewSpace,onInput:this.checkSpaceName};this.createModal(e)},checkSpaceName(e){if(""!==e.trim())return this.setModalInputErrorMessage(null);this.setModalInputErrorMessage(this.$gettext("Space name cannot be empty"))},addNewSpace(e){return this.graphClient.drives.createDrive({name:e},{}).then((({data:e})=>{this.hideModal();const t=i.buildSpace(e);this.UPSERT_RESOURCE(t),this.UPSERT_SPACE(t),this.$client.files.createFolder(`spaces/${e.id}/.space`).then((()=>{this.$client.files.putFileContents(`spaces/${e.id}/.space/readme.md`,`### 👋 ${this.$gettext("Hello!")}\r\n${this.$gettext("Add a description to welcome the members of the Space.")}\r\n${this.$gettext("Use markdown to format your text. [More info]")}(https://www.markdownguide.org/basic-syntax/)`).then((t=>{this.graphClient.drives.updateDrive(e.id,{special:[{specialFolder:{name:"readme"},id:t["OC-FileId"]}]},{}).then((({data:t})=>{this.UPDATE_RESOURCE_FIELD({id:e.id,field:"spaceReadmeData",value:t.special.find((e=>"readme"===e.specialFolder.name))})}))}))}))})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Creating space failed…"),status:"danger"})}))}}});var js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Create a new space"),expression:"$gettext('Create a new space')"}],key:"new-space-menu-btn-enabled",staticClass:"oc-background-primary-gradient oc-px-s oc-text-nowrap oc-py-s",attrs:{id:"new-space-menu-btn","aria-label":e.$gettext("Create a new space"),appearance:"raw",variation:"inverse"},on:{click:e.showCreateSpaceModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New Space")])],1)};js._withStripped=!0;const Vs=e.normalizeComponent({render:js,staticRenderFns:[]},undefined,Gs,undefined,false,undefined,!1,void 0,void 0,void 0);const Ws=e.defineComponent$1({components:{FilesViewWrapper:ct,SideBar:ot,AppBar:Ue,AppLoadingSpinner:e.__vue_component__$1,CreateSpace:Vs,NoContentMessage:e.__vue_component__$2,SpaceContextActions:Ds},setup(){const t=s.useStore(),a=e.computed((()=>t.getters["Files/activeFiles"]||[])),r=s.useAccessToken({store:t}),{graphClient:o}=s.useGraphClient(),n=e.q((function*(t,s){s.CLEAR_FILES_SEARCHED(),s.CLEAR_CURRENT_FILES_LIST();let a=(yield e.unref(o).drives.listMyDrives("name asc","driveType eq project")).data?.value||[];a=a.map(i.buildSpace),s.LOAD_FILES({currentFolder:null,files:a})})),l=e.computed((()=>n.isRunning||!n.last));return{spaces:a,graphClient:o,loadResourcesTask:n,areResourcesLoading:l,accessToken:r,...u()}},data:function(){return{imageContentObject:{}}},computed:{...e.mapGetters(["user"]),breadcrumbs(){return[{text:this.$gettext("Spaces")}]},spacesHint(){return this.$gettext("Store your project related files in Spaces for seamless collaboration.")},hasCreatePermission(){return this.$permissionManager.hasSpaceManagement()}},watch:{spaces:{handler:function(e){if(e)for(const e of this.spaces){if(!e.spaceImageData)continue;if(this.imageContentObject[e.id]?.fileId===e.spaceImageData?.id)continue;const t=decodeURI(e.spaceImageData.webDavUrl).split("/"),a=t.find((t=>t.startsWith(e.id)));if(!a)return;const r=t.slice(t.indexOf(a)+1).join("/");this.$client.files.fileInfo(i.buildWebDavSpacesPath(a,decodeURIComponent(r))).then((t=>{const i=s.buildResource(t);o.loadPreview({resource:i,isPublic:!1,dimensions:S.Preview,server:n.configurationManager.serverUrl,userId:this.user.id,token:this.accessToken}).then((t=>{this.$set(this.imageContentObject,e.id,{fileId:e.spaceImageData.id,data:t})}))}))}},deep:!0}},created(){this.loadResourcesTask.perform(this)},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","CLEAR_FILES_SEARCHED","SET_FILE_SELECTION"]),getSpaceProjectRoute:({id:e,name:t,disabled:i})=>i?"#":s.createLocationSpaces("files-spaces-project",{params:{storageId:e,name:t}}),getSpaceCardAdditionalClass:e=>e.disabled?"state-trashed":"",openSidebarSharePanel(t){this.SET_FILE_SELECTION([t]),e.bus.publish(s.SideBarEventTopics.openWithPanel,"space-share-item")},getSpaceLinkProps(e){return e.disabled?{appearance:"raw"}:{to:this.getSpaceProjectRoute(e)}},getSpaceLinkListeners(e){return e.disabled?{click:()=>{this.showMessage({title:this.$gettext("Disabled spaces cannot be entered"),status:"warning"})}}:{}}}});var Qs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},[s("files-view-wrapper",[s("app-bar",{staticClass:"oc-border-b",attrs:{breadcrumbs:e.breadcrumbs,"has-view-options":!1,"has-sidebar-toggle":!1,"show-actions-on-selection":!0,"side-bar-open":e.sideBarOpen},scopedSlots:e._u([{key:"actions",fn:function(){return[e.hasCreatePermission?s("create-space"):e._e()]},proxy:!0},{key:"content",fn:function(){return[s("p",{domProps:{textContent:e._s(e.spacesHint)}})]},proxy:!0}])}),e._v(" "),e.areResourcesLoading?s("app-loading-spinner"):[e.spaces.length?s("div",{staticClass:"spaces-list oc-px-m oc-mt-l"},[s("ul",{staticClass:"\n            oc-grid\n            oc-grid-match\n            oc-grid-column-small\n            oc-grid-row-large\n            oc-text-center\n            oc-child-width-1-3@m\n            oc-child-width-1-4@l\n            oc-child-width-1-5@xl\n          "},e._l(e.spaces,(function(t){return s("li",{key:t.getDomSelector(),staticClass:"oc-mb-m"},[s("div",{staticClass:"spaces-list-card oc-card oc-card-default oc-rounded",class:e.getSpaceCardAdditionalClass(t),attrs:{"data-space-id":t.id}},[s("div",{staticClass:"oc-card-media-top oc-border-b"},[s(t.disabled?"oc-button":"router-link",e._g(e._b({tag:"component"},"component",e.getSpaceLinkProps(t),!1),e.getSpaceLinkListeners(t)),[t.disabled?s("oc-tag",{staticClass:"oc-position-absolute space-disabled-indicator",attrs:{type:"span"}},[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("Disabled")])]):e._e(),e._v(" "),e.imageContentObject[t.id]?s("img",{staticClass:"space-image oc-rounded-top",attrs:{src:e.imageContentObject[t.id].data,alt:""}}):s("oc-icon",{staticClass:"space-default-image oc-px-m oc-py-m",attrs:{name:"layout-grid",size:"xxlarge"}})],1)],1),e._v(" "),s("div",{staticClass:"oc-card-body oc-p-s"},[s("div",{staticClass:"oc-flex oc-flex-between oc-flex-middle"},[s("div",{staticClass:"oc-flex oc-flex-middle"},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"layout-grid"}}),e._v(" "),s(t.disabled?"oc-button":"router-link",e._g(e._b({tag:"component",staticClass:"space-name oc-text-left"},"component",e.getSpaceLinkProps(t),!1),e.getSpaceLinkListeners(t)),[s("span",{domProps:{textContent:e._s(t.name)}})])],1),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle"},[s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show members"),expression:"$gettext('Show members')"}],attrs:{"aria-label":e.$gettext("Show members"),appearance:"raw"},on:{click:function(s){return e.openSidebarSharePanel(t)}}},[s("oc-icon",{attrs:{name:"group"}})],1)],1),e._v(" "),s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show context menu"),expression:"$gettext('Show context menu')"}],attrs:{id:"space-context-btn-"+t.getDomSelector(),"aria-label":e.$gettext("Show context menu"),appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{attrs:{"drop-id":"space-context-drop-"+t.getDomSelector(),toggle:"#space-context-btn-"+t.getDomSelector(),mode:"click","close-on-click":"",options:{delayHide:0},"padding-size":"small",position:"bottom-end"}},[s("space-context-actions",{attrs:{items:[t]}})],1)],1)])]),e._v(" "),t.description?s("p",{staticClass:"oc-text-left oc-ml-xs oc-mt-xs oc-mb-rm oc-text-truncate"},[s("small",{domProps:{textContent:e._s(t.description)}})]):e._e()])])])})),0)]):s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-spaces-empty",icon:"layout-grid"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("You don't have access to any spaces")])]},proxy:!0}],null,!1,960882363)})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};Qs._withStripped=!0;const Js=e.normalizeComponent({render:Qs,staticRenderFns:[]},undefined,Ws,undefined,false,undefined,!1,void 0,void 0,void 0);const Ys={components:{TrashBin:Us},setup:()=>({hasShareJail:s.useCapabilityShareJailEnabled()}),computed:{breadcrumbs(){const t=this.hasShareJail?this.$gettext("Personal"):this.$gettext("All files");return[{text:this.$gettext("Deleted files"),to:"/files/trash"},{text:t,onClick:()=>e.bus.publish("app.files.list.load")}]}}};var Ks=function(){var e=this,t=e.$createElement;return(e._self._c||t)("trash-bin",{attrs:{breadcrumbs:e.breadcrumbs}})};Ks._withStripped=!0;const Xs=e.normalizeComponent({render:Ks,staticRenderFns:[]},undefined,Ys,undefined,false,undefined,!1,void 0,void 0,void 0);const Zs=async(e,t=!1)=>{const s=e.size||S.Avatar;if(t)return ei({...e,size:s});const i=[e.server,"remote.php/dav/avatars/",e.username,`/${s}.png`].join(""),{status:a,statusText:r}=await e.clientService.httpAuthenticated(e.token).head(i);if(200!==a)throw new Error(r);const{owncloudSdk:o}=e.clientService;return o&&"function"==typeof o.signUrl?o.signUrl(i):i},ei=async e=>{const t=s.cacheService.avatarUrl.get(e.username);if(t&&t.size===e.size)return t.src;try{const t=await Zs(e);return s.cacheService.avatarUrl.set(e.username,{src:t,size:e.size},0).src}catch(e){}},ti=e=>[...e.filter((e=>e.role.name===i.spaceRoleManager.name)).sort(((e,t)=>e.collaborator.displayName.localeCompare(t.collaborator.displayName))),...e.filter((e=>e.role.name!==i.spaceRoleManager.name)).sort(((e,t)=>e.collaborator.displayName.localeCompare(t.collaborator.displayName)))],si=t=>e.get(t,"capabilities.files_sharing.resharing",!0);function ii(e){const t=new Set;return e.forEach((e=>{t.add(e.shareType)})),Array.from(t)}function ai(e,t,s){const i=[...e.files];let a=i.findIndex((e=>e.id===t.id));t.webDavPath&&t.webDavPath.length&&-1===a&&(a=i.findIndex((e=>e.webDavPath===t.webDavPath)));const r=a>-1;e.filesSearched=null,(r||s)&&(r?i.splice(a,1,t):i.push(t),e.files=i)}var ri={namespaced:!0,state:{currentFolder:null,files:[],filesSearched:null,selectedIds:[],latestSelectedId:null,clipboardResources:[],clipboardAction:null,versions:[],currentFileOutgoingShares:[],currentFileOutgoingSharesError:null,currentFileOutgoingSharesLoading:!1,incomingShares:[],incomingSharesError:null,incomingSharesLoading:!1,sharesTree:{},sharesTreeError:null,sharesTreeLoading:!1,areHiddenFilesShown:!0,areFileExtensionsShown:!0},getters:{selectedFiles:(e,t)=>t.filesAll.filter((t=>e.selectedIds.includes(t.id))),files:e=>e.files,filesAll:e=>e.filesSearched||e.files,currentFolder:e=>e.currentFolder,clipboardResources:e=>e.clipboardResources,clipboardAction:e=>e.clipboardAction,flatFileList:e=>!1==!!e.currentFolder,activeFiles:(e,t)=>{let s=[].concat(t.filesAll);return e.areHiddenFilesShown||(s=s.filter((e=>!e.name.startsWith(".")))),s},totalFilesSize:(e,t)=>t.filesAll.map((e=>parseInt(e.size))).reduce(((e,t)=>e+t),0),totalFilesCount:(e,t)=>({files:t.filesAll.filter((e=>"file"===e.type)).length,folders:t.filesAll.filter((e=>"folder"===e.type)).length}),currentFileOutgoingCollaborators:e=>e.currentFileOutgoingShares.filter((e=>i.ShareTypes.containsAnyValue(i.ShareTypes.authenticated,[e.shareType]))),currentFileOutgoingLinks:e=>e.currentFileOutgoingShares.filter((e=>i.ShareTypes.containsAnyValue(i.ShareTypes.unauthenticated,[e.shareType]))),currentFileOutgoingSharesLoading:e=>e.currentFileOutgoingSharesLoading,sharesTree:e=>e.sharesTree,sharesTreeLoading:e=>e.sharesTreeLoading,quota:e=>e.quota,highlightedFile:(e,t)=>t.selectedFiles.length>0?t.selectedFiles[0]:e.currentFolder,versions:e=>e.versions},actions:{loadFiles(e,{currentFolder:t,files:i}){t&&(t=s.buildResource(t)),i=i.map(s.buildResource),e.commit("LOAD_FILES",{currentFolder:t,files:i})},toggleFileSelection(e,t){e.state.selectedIds.includes(t.id)?e.commit("REMOVE_FILE_SELECTION",t):e.commit("ADD_FILE_SELECTION",t)},copySelectedFiles(e){e.commit("CLIPBOARD_SELECTED"),e.commit("SET_CLIPBOARD_ACTION",B.Copy),e.dispatch("showMessage",{title:s.$gettext("Copied to clipboard!"),status:"success"},{root:!0})},cutSelectedFiles(e){e.commit("CLIPBOARD_SELECTED"),e.commit("SET_CLIPBOARD_ACTION",B.Cut),e.dispatch("showMessage",{title:s.$gettext("Cut to clipboard!"),status:"success"},{root:!0})},clearClipboardFiles(e){e.commit("CLEAR_CLIPBOARD")},async pasteSelectedFiles(e,{client:t,createModal:i,hideModal:a,showMessage:r,$gettext:o,$gettextInterpolate:n,$ngettext:l,isPublicLinkContext:c,publicLinkPassword:d,upsertResource:h}){let u=[];e.state.clipboardAction===B.Cut&&(u=await s.move(e.state.clipboardResources,e.state.currentFolder,t,i,a,r,o,n,l,c,d)),e.state.clipboardAction===B.Copy&&(u=await s.copy(e.state.clipboardResources,e.state.currentFolder,t,i,a,r,o,n,l,c,d)),e.commit("CLEAR_CLIPBOARD");const p=async e=>{let i;i=c?await t.publicFiles.getFileInfo(e.webDavPath,d,s.DavProperties.PublicLink):await t.files.fileInfo(e.webDavPath,s.DavProperties.Default),h(s.buildResource(i))},m=[];for(const e of u)m.push(p(e));await Promise.all(m)},resetFileSelection(e){e.commit("RESET_SELECTION")},markFavorite(e,t){const s=t.file,i=t.client,a=!s.starred;return i.files.favorite(s.webDavPath,a).then((()=>{e.commit("UPDATE_RESOURCE_FIELD",{id:s.id,field:"starred",value:a})})).catch((e=>{throw new Error(e)}))},deleteFiles(e,{files:t,client:i,isPublicLinkContext:a,firstRun:r=!0}){const o=[],n=[];for(const l of t){let t=null;t=a?i.publicFiles.delete(l.path,null,e.rootGetters["runtime/auth/publicLinkPassword"]):i.files.delete(l.webDavPath);const c=t.then((()=>{n.push(l)})).catch((t=>{let o=s.$gettext('Failed to delete "%{file}"');if(423===t.statusCode){if(r)return e.dispatch("deleteFiles",{files:[l],client:i,isPublicLinkContext:a,firstRun:!1});o=s.$gettext('Failed to delete "%{file}" - the file is locked')}const n=s.$gettextInterpolate(o,{file:l.name},!0);e.dispatch("showMessage",{title:n,status:"danger"},{root:!0})}));o.push(c)}return Promise.all(o).then((()=>{e.dispatch("sidebar/close"),e.commit("REMOVE_FILES",n),e.commit("REMOVE_FILES_FROM_SEARCHED",n),e.commit("RESET_SELECTION")}))},async clearTrashBin(e){await e.dispatch("sidebar/close"),e.commit("CLEAR_FILES"),e.commit("RESET_SELECTION"),e.commit("CLEAR_FILES_SEARCHED")},async removeFilesFromTrashbin(e,t){await e.dispatch("sidebar/close"),e.commit("REMOVE_FILES",t),e.commit("REMOVE_FILES_FROM_SEARCHED",t),e.commit("RESET_SELECTION")},renameFile(e,{file:t,newValue:s,client:i,isPublicLinkContext:a,isSameResource:r}){if(void 0!==t&&void 0!==s&&s!==t.name){const o=t.webDavPath.slice(1,t.webDavPath.lastIndexOf("/")+1);return a?i.publicFiles.move(t.webDavPath,o+s,e.rootGetters["runtime/auth/publicLinkPassword"]).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})})):i.files.move(t.webDavPath,o+s).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})}))}},updateCurrentFileShareTypes({state:e,getters:t,commit:s}){const i=t.highlightedFile;i&&s("UPDATE_RESOURCE_FIELD",{id:i.id,field:"shareTypes",value:ii(e.currentFileOutgoingShares)})},loadCurrentFileOutgoingShares(e,{client:t,graphClient:i,path:a,resource:r,storageId:o}){if(e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",[]),e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",null),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),"space"===r?.type){const n=[],l=[],c=[];for(const e of Object.keys(r.spaceRoles))for(const t of r.spaceRoles[e])n.push(i.users.getUser(t).then((t=>{l.push(s.buildSpaceShare({...t.data,role:e},r.id))})));return n.push(t.shares.getShares(a,{reshares:!0,spaceRef:o}).then((t=>{for(const i of t)c.push(s.buildShare(i.shareInfo,e.getters.highlightedFile,!e.rootGetters.isOcis))}))),Promise.all(n).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",[...ti(l),...c]),e.dispatch("updateCurrentFileShareTypes"),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)})).catch((t=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))}t.shares.getShares(a,{reshares:!0,spaceRef:o}).then((t=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",t.map((t=>s.buildShare(t.shareInfo,e.getters.highlightedFile,si(e.rootGetters))))),e.dispatch("updateCurrentFileShareTypes"),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)})).catch((t=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))},loadIncomingShares(e,t){e.commit("INCOMING_SHARES_LOAD",[]),e.commit("INCOMING_SHARES_ERROR",null),e.commit("INCOMING_SHARES_LOADING",!0);const i=t.client,a=t.path;i.shares.getShares(a,{shared_with_me:!0}).then((t=>{e.commit("INCOMING_SHARES_LOAD",t.map((t=>s.buildCollaboratorShare(t.shareInfo,e.getters.highlightedFile,si(e.rootGetters))))),e.commit("INCOMING_SHARES_LOADING",!1)})).catch((t=>{e.commit("INCOMING_SHARES_ERROR",t.message),e.commit("INCOMING_SHARES_LOADING",!1)}))},async changeShare({commit:e,dispatch:t,getters:a,rootGetters:r},{client:o,graphClient:n,share:l,permissions:c,expirationDate:d,role:h}){if(!c&&!h)throw new Error("Nothing changed");if(l.shareType!==i.ShareTypes.space.value)try{const t=await o.shares.updateShare(l.id,{role:h.name,permissions:c,expireDate:d});e("CURRENT_FILE_OUTGOING_SHARES_UPSERT",s.buildCollaboratorShare(t.shareInfo,a.highlightedFile,si(r)))}catch(e){t("showMessage",{title:s.$gettext("Error while editing the share."),status:"danger"},{root:!0})}else{try{await o.shares.shareSpaceWithUser("",l.collaborator.name,l.id,{permissions:c,role:h.name})}catch(e){t("showMessage",{title:s.$gettext("Error while editing the share."),status:"danger"},{root:!0})}e("CURRENT_FILE_OUTGOING_SHARES_UPSERT",s.buildSpaceShare({role:h.name,onPremisesSamAccountName:l.collaborator.name,displayName:l.collaborator.displayName},l.id));const{data:a}=await n.drives.getDrive(l.id),r=i.buildSpace(a);e("UPDATE_RESOURCE_FIELD",{id:l.id,field:"spaceRoles",value:r.spaceRoles})}},addShare(e,{client:t,graphClient:a,path:r,shareWith:o,shareType:n,permissions:l,role:c,expirationDate:d,storageId:h,displayName:u}){if(n===i.ShareTypes.group.value)return void t.shares.shareFileWithGroup(r,o,{permissions:l,role:c.name,expirationDate:d,spaceRef:h}).then((i=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_UPSERT",s.buildCollaboratorShare(i.shareInfo,e.getters.highlightedFile,si(e.rootGetters))),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:t,currentFolder:r})})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}));if(n===i.ShareTypes.space.value)return void t.shares.shareSpaceWithUser(r,o,h,{permissions:l,role:c.name}).then((()=>{const t={role:c.name,onPremisesSamAccountName:o,displayName:u};return e.commit("CURRENT_FILE_OUTGOING_SHARES_UPSERT",s.buildSpaceShare(t,h)),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),a.drives.getDrive(h).then((t=>{const s=i.buildSpace(t.data);e.commit("UPDATE_RESOURCE_FIELD",{id:h,field:"spaceRoles",value:s.spaceRoles}),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}));const p=n===i.ShareTypes.remote.value;t.shares.shareFileWithUser(r,o,{remoteUser:p,permissions:l,role:c.name,expirationDate:d,spaceRef:h}).then((i=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_UPSERT",s.buildCollaboratorShare(i.shareInfo,e.getters.highlightedFile,si(e.rootGetters))),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:t,currentFolder:r,storageId:h})})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}))},deleteShare(e,{client:t,graphClient:s,share:a,path:r,storageId:o,reloadResource:n=!0}){const l={};return a.shareType===i.ShareTypes.space.value&&(l.shareWith=a.collaborator.name),t.shares.deleteShare(a.id,l).then((()=>{if(e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",a),a.shareType!==i.ShareTypes.space.value)e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:t,currentFolder:r,storageId:o});else if(n)return e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),s.drives.getDrive(a.id).then((t=>{const s=i.buildSpace(t.data);e.commit("UPDATE_RESOURCE_FIELD",{id:a.id,field:"spaceRoles",value:s.spaceRoles}),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))}))},pruneSharesTreeOutsidePath(e,t){e.commit("SHARESTREE_PRUNE_OUTSIDE_PATH",t)},loadSharesTree(t,{client:i,path:a,storageId:r}){t.commit("SHARESTREE_ERROR",null),t.dispatch("pruneSharesTreeOutsidePath",a);const o=s.getParentPaths(a,!0),n={};t.commit("SHARESTREE_LOADING",!0);const l=new e._default({concurrency:2}),c=[];return o.forEach((e=>{if(t.getters.sharesTree[e])return Promise.resolve();n[e]=[],c.push(l.add((()=>i.shares.getShares(e,{reshares:!0,spaceRef:r}).then((i=>{i.forEach((i=>{n[e].push({...s.buildShare(i.shareInfo,{type:"folder"},si(t.rootGetters)),outgoing:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),t.commit("SHARESTREE_ERROR",e.message),t.commit("SHARESTREE_LOADING",!1)}))))),c.push(l.add((()=>i.shares.getShares(e,{shared_with_me:!0,spaceRef:r}).then((i=>{i.forEach((i=>{n[e].push({...s.buildCollaboratorShare(i.shareInfo,{type:"folder"},si(t.rootGetters)),incoming:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),t.commit("SHARESTREE_ERROR",e.message),t.commit("SHARESTREE_LOADING",!1)})))))})),Promise.all(c).then((()=>{t.commit("SHARESTREE_ADD",n),t.commit("SHARESTREE_LOADING",!1)}))},async loadVersions(e,{client:t,fileId:s}){let i;try{i=await t.fileVersions.listVersions(s)}catch(e){console.error(e),i=[]}e.commit("SET_VERSIONS",i)},addLink:(e,{path:t,client:i,params:a,storageId:r})=>new Promise(((o,n)=>{i.shares.shareFileWithLink(t,{...a,spaceRef:r}).then((a=>{const n=s.buildShare(a.shareInfo,null,si(e.rootGetters));e.commit("CURRENT_FILE_OUTGOING_SHARES_UPSERT",n),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:i,currentFolder:t,storageId:r}),o(n)})).catch((e=>{n(e)}))})),updateLink:(e,{id:t,client:i,params:a})=>new Promise(((r,o)=>{i.shares.updateShare(t,a).then((t=>{const i=s.buildShare(t.shareInfo,null,si(e.rootGetters));e.commit("CURRENT_FILE_OUTGOING_SHARES_UPSERT",i),r(i)})).catch((e=>{o(e)}))})),removeLink(e,{share:t,client:s,path:i,storageId:a}){s.shares.deleteShare(t.id).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",t),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:s,currentFolder:i,storageId:a})})).catch((t=>e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message)))},pushResourcesToDeleteList({commit:e},t){e("PUSH_RESOURCES_TO_DELETE_LIST",t)},async loadIndicators({dispatch:t,commit:s},{client:i,currentFolder:a,storageId:r}){s("SHARESTREE_PRUNE_OUTSIDE_PATH",e.dirname(a)),await t("loadSharesTree",{client:i,path:a,storageId:r}),s("LOAD_INDICATORS",a)},loadAvatars({commit:t,rootGetters:s},{resource:i}){s.capabilities.files_sharing.user.profile_picture&&["sharedWith","owner"].forEach((a=>{(i[a]||[]).forEach(((r,o)=>{e.has(r,"avatar")&&Zs({clientService:this.$clientService,username:r.username,server:s.configuration.server,token:s["runtime/auth/accessToken"]},!0).then((e=>t("UPDATE_RESOURCE_FIELD",{id:i.id,field:`${a}.[${o}].avatar`,value:e})))}))}))},async loadPreview({commit:e,rootGetters:t},{resource:s,isPublic:i,dimensions:a,type:r}){if(!se.available||!se.isMimetypeSupported(s.mimeType))return;const n=await o.loadPreview({resource:s,isPublic:i,dimensions:a,server:t.configuration.server,userId:t.user.id,token:t["runtime/auth/accessToken"]},!0);n&&e("UPDATE_RESOURCE_FIELD",{id:s.id,field:r,value:n})}},mutations:{LOAD_FILES(e,{currentFolder:t,files:s}){e.currentFolder=t,e.files=s},SET_CURRENT_FOLDER(e,t){e.currentFolder=t},SET_CURRENT_SPACE(e,t){e.currentSpace=t},CLEAR_FILES(e){e.files=[]},LOAD_FILES_SEARCHED(e,t){e.filesSearched=t},REMOVE_FILES_FROM_SEARCHED(e,t){e.filesSearched&&(e.filesSearched=e.filesSearched.filter((e=>!t.find((t=>t.id===e.id)))))},CLEAR_FILES_SEARCHED(e){e.filesSearched=null},CLEAR_CLIPBOARD(e){e.clipboardResources=[],e.clipboardAction=null},CLIPBOARD_SELECTED(e){e.clipboardResources=e.files.filter((t=>e.selectedIds.some((e=>t.id===e))))},SET_CLIPBOARD_ACTION(e,t){e.clipboardAction=t},SET_LATEST_SELECTED_FILE_ID(e,t){e.latestSelectedId=t},SET_FILE_SELECTION(e,t){const s=t.find((t=>!e.selectedIds.includes(t.id)));s&&(e.latestSelectedId=s.id),e.selectedIds=t.map((e=>e.id))},SET_SELECTED_IDS(e,t){const s=t.find((t=>!e.selectedIds.includes(t)));s&&(e.latestSelectedId=s),e.selectedIds=t},ADD_FILE_SELECTION(e,t){const s=[...e.selectedIds],i=s.findIndex((e=>e===t.id));e.latestSelectedId=t.id,-1===i&&(s.push(t.id),e.selectedIds=s)},REMOVE_FILE_SELECTION(e,t){const s=[...e.selectedIds];e.latestSelectedId=t.id,s.length>1?e.selectedIds=s.filter((e=>t.id!==e)):e.selectedIds=[]},RESET_SELECTION(e){e.selectedIds=[]},REMOVE_FILES(e,t){e.files=[...e.files].filter((e=>!t.find((t=>t.id===e.id))))},RENAME_FILE(e,{file:t,newValue:i,newPath:a}){const r=[...e.files],o=r.findIndex((e=>e.id===t.id));s.renameResource(r[o],i,a),e.files=r},CURRENT_FILE_OUTGOING_SHARES_SET(e,t){e.currentFileOutgoingShares=t},CURRENT_FILE_OUTGOING_SHARES_REMOVE(e,t){t.shareType!==i.ShareTypes.space.value?e.currentFileOutgoingShares=e.currentFileOutgoingShares.filter((e=>t.id!==e.id)):e.currentFileOutgoingShares=e.currentFileOutgoingShares.filter((e=>t.id===e.id&&t.collaborator.name!==e.collaborator.name))},CURRENT_FILE_OUTGOING_SHARES_UPSERT(t,s){let a;a=s.shareType===i.ShareTypes.space.value?t.currentFileOutgoingShares.findIndex((e=>s.id===e.id&&s.collaborator.name===e.collaborator.name)):t.currentFileOutgoingShares.findIndex((e=>e.id===s.id)),a>=0?e.Vue.set(t.currentFileOutgoingShares,a,s):t.currentFileOutgoingShares.push(s)},CURRENT_FILE_OUTGOING_SHARES_ERROR(e,t){e.currentFileOutgoingShares=[],e.currentFileOutgoingSharesError=t},CURRENT_FILE_OUTGOING_SHARES_LOADING(e,t){e.currentFileOutgoingSharesLoading=t},INCOMING_SHARES_LOAD(e,t){e.incomingShares=t},INCOMING_SHARES_ERROR(e,t){e.incomingShares=[],e.incomingSharesError=t},INCOMING_SHARES_LOADING(e,t){e.incomingSharesLoading=t},SHARESTREE_PRUNE_OUTSIDE_PATH(t,s){""!==s&&"/"!==s?("/"!==(s+="/").charAt(0)&&(s="/"+s),t.sharesTree=e.pickBy(t.sharesTree,((e,t)=>s.startsWith(t+"/")))):t.sharesTree={}},SHARESTREE_ADD(e,t){e.sharesTree=Object.assign({},e.sharesTree,t)},SHARESTREE_ERROR(e,t){e.sharesTreeError=t},SHARESTREE_LOADING(e,t){e.sharesTreeLoading=t},CLEAR_CURRENT_FILES_LIST(e){e.currentFolder=null,e.selectedIds=[],e.files.forEach((e=>{e.previewUrl&&e.previewUrl.startsWith("blob:")&&window.URL.revokeObjectURL(e.previewUrl)})),e.files=[]},SET_VERSIONS(e,t){e.versions=t},LOAD_INDICATORS(e,t){const i=e.files.filter((e=>e.path.startsWith(t)));for(const t of i){const i=s.getIndicators(t,e.sharesTree);(i.length||t.indicators.length)&&this.commit("Files/UPDATE_RESOURCE_FIELD",{id:t.id,field:"indicators",value:i})}},UPSERT_RESOURCE(e,t){ai(e,t,!0)},UPDATE_RESOURCE(e,t){ai(e,t,!1)},UPDATE_RESOURCE_FIELD(t,s){let i=t.filesSearched||t.files,a=i.findIndex((e=>e.id===s.id));if(a<0){if(t.currentFolder?.id!==s.id)return;i=[t.currentFolder],a=0}const r=i[a],o=e.has(r,s.field),n=e.set(r,s.field,s.value);o||e.Vue.set(i,a,n)},SET_HIDDEN_FILES_VISIBILITY(e,t){e.areHiddenFilesShown=t,window.localStorage.setItem("oc_hiddenFilesShown",t)},SET_FILE_EXTENSIONS_VISIBILITY(e,t){e.areFileExtensionsShown=t,window.localStorage.setItem("oc_fileExtensionsShown",t)}}};const oi=new e.VisibilityObserver;const ni={mixins:[he],props:{searchResult:{type:Object,default:function(){return{}}},provider:{type:Object,default:function(){return{}}}},setup(){const e=s.useStore();return{hasShareJail:s.useCapabilityShareJailEnabled(),resourceTargetLocation:s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.getters.user.id}})}},data:()=>({resource:void 0}),computed:{...e.mapGetters(["configuration","user"]),...e.mapState("runtime/spaces",["spaces"]),matchingSpace(){return this.spaces.find((e=>e.id===this.resource.storageId))},defaultParentFolderName(){return this.resource.shareId?"/"===this.resource.path?this.$gettext("Shared with me"):e.path.basename(this.resource.shareRoot):this.hasShareJail?"project"===this.matchingSpace?.driveType?this.matchingSpace.name:this.$gettext("Personal"):this.$gettext("All files and folders")},folderLink(){return this.createFolderLink(this.resource.path,this.resource)},parentFolderLink(){return this.createFolderLink(e.path.dirname(this.resource.path),this.resource)},displayThumbnails(){return!this.configuration?.options?.disablePreviews}},beforeMount(){this.resource=this.searchResult.data},mounted(){if(!this.displayThumbnails)return;const t=e.debounce((async({unobserve:t})=>{t();const s=await o.loadPreview({resource:this.resource,isPublic:!1,dimensions:S.Thumbnail,server:this.configuration.server,userId:this.user.id,token:this.accessToken},!0);s&&e.Vue.set(this.resource,x.Thumbnail,s)}),250);oi.observe(this.$el,{onEnter:t,onExit:t.cancel})},beforeDestroy(){oi.disconnect()},methods:{createFolderLink(t,i){return null===this.resourceTargetLocation?{}:i.shareId?s.createLocationSpaces("files-spaces-share",{params:{shareName:e.path.basename(i.shareRoot)},query:{shareId:i.shareId}}):"project"===this.matchingSpace?.driveType?s.createLocationSpaces("files-spaces-project",{params:{storageId:i.storageId,item:t.replace(/^\//,"")||void 0}}):{name:this.resourceTargetLocation.name,params:{item:t.replace(/^\//,"")||void 0,...this.resourceTargetLocation.params,...i.storageId&&{storageId:i.storageId}}}}}};var li=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-preview"},[s("oc-resource",{attrs:{resource:e.resource,"is-path-displayed":!0,"folder-link":e.folderLink,"parent-folder-link":e.parentFolderLink,"parent-folder-name-default":e.defaultParentFolderName,"is-thumbnail-displayed":e.displayThumbnails},on:{click:function(t){return e.$_fileActions_triggerDefaultAction(e.resource)}}})],1)};li._withStripped=!0;const ci=e.normalizeComponent({render:li,staticRenderFns:[]},undefined,ni,undefined,false,undefined,!1,void 0,void 0,void 0);class di{component;available;store;constructor(e){this.component=ci,this.store=e,this.available=!0}search(e){const t=p(this.store.getters["Files/files"],e,5),s=this.store.state.Files?.areHiddenFilesShown,i=t.reduce(((e,t)=>(t.name.startsWith(".")&&!s||e.push({id:t.id,data:{...t}}),e)),[]);return Promise.resolve({values:i})}activate(){}}class hi extends e.EventBus{id;label;previewSearch;store;router;constructor(e,t){super(),this.id="files.filter",this.label="Search current folder ↵",this.store=e,this.router=t,this.previewSearch=new di(e)}activate(e){if(!e)return;const t=p(this.store.getters["Files/files"],e);this.publish("activate",{term:e,resources:t})}reset(){this.publish("reset")}updateTerm(e){this.publish("updateTerm",e)}get available(){return s.isLocationSpacesActive(this.router,"files-spaces-personal")}}class ui{component;cache;router;store;constructor(e,t){this.component=ci,this.router=t,this.store=e,this.cache=new s.Cache({ttl:1e4,capacity:100})}async search(e){if(!e)return{range:null,values:[]};if(this.cache.has(e))return this.cache.get(e);const t=this.store.state.Files?.areHiddenFilesShown,{range:i,results:a}=await s.clientService.owncloudSdk.files.search(e,5,s.DavProperties.Default),r=a.reduce(((e,i)=>{const a=s.buildResource(i);return a.name.startsWith(".")&&!t||e.push({id:a.id,data:{...a}}),e}),[]);return this.cache.set(e,{range:i,values:r})}get available(){return"search-provider-list"!==this.router.currentRoute.name}activate(){}}var pi,mi;e.__decorate([(pi=500,function(t,s,i){const a=i.value,r=e.debounce((async function(e,...t){try{const s=await a.apply(this,t);e.resolve(s)}catch(t){e.reject(t)}}),pi,mi);i.value=function(...e){return new Promise(((t,s)=>{r.apply(this,[{resolve:t,reject:s},...e])}))}})],ui.prototype,"search",null);const fi=new e.VisibilityObserver;const gi=e.defineComponent$1({components:{AppBar:Ue,SideBar:ot,AppLoadingSpinner:e.__vue_component__$1,ContextActions:Ie,ListInfo:Ve,Pagination:Je,NoContentMessage:e.__vue_component__$2,ResourceTable:W,FilesViewWrapper:ct},mixins:[he,ue,Ot],props:{searchResult:{type:Object,default:function(){return{range:null,values:[]}}},loading:{type:Boolean,default:!1}},setup(){const e=s.useStore();return{...M(),resourceTargetLocation:s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.getters.user.id}})}},computed:{...e.mapGetters(["configuration"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount","totalFilesSize"]),displayThumbnails(){return!this.configuration?.options?.disablePreviews},itemCount(){return this.totalFilesCount.files+this.totalFilesCount.folders},rangeSupported(){return this.searchResult.range},rangeItems(){return parseInt(this.searchResult.range?.split("/")[1]||0)},searchResultExceedsLimit(){return!this.rangeSupported||this.rangeItems&&this.rangeItems>_i},searchResultExceedsLimitText(){if(!this.rangeSupported){const e=this.$gettext("Showing up to %{searchLimit} results");return this.$gettextInterpolate(e,{searchLimit:_i})}const e=this.$gettext("Found %{rangeItems}, showing the %{itemCount} best matching results");return this.$gettextInterpolate(e,{itemCount:this.itemCount,rangeItems:this.rangeItems})}},watch:{searchResult:{handler:function(){this.searchResult&&(this.CLEAR_CURRENT_FILES_LIST(),this.LOAD_FILES({currentFolder:null,files:this.searchResult.values.length?this.searchResult.values.map((e=>e.data)):[]}))},immediate:!0}},beforeDestroy(){fi.disconnect()},methods:{...e.mapMutations("Files",["CLEAR_CURRENT_FILES_LIST","LOAD_FILES"]),...e.mapActions("Files",["loadPreview"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:S.Thumbnail,type:x.Thumbnail})}),250);fi.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var bi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-result oc-flex"},[s("files-view-wrapper",[s("app-bar",{attrs:{"has-bulk-actions":!1,"side-bar-open":e.sideBarOpen}}),e._v(" "),e.loading?s("app-loading-spinner"):[e.paginatedResources.length?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!1},attrs:{resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,"has-actions":!0,"is-selectable":!1},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.searchResultExceedsLimit?s("div",{staticClass:"oc-text-nowrap oc-text-center oc-width-1-1 oc-my-s",domProps:{textContent:e._s(e.searchResultExceedsLimitText)}}):e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResourcesIds,callback:function(t){e.selectedResourcesIds=t},expression:"selectedResourcesIds"}}):s("no-content-message",{staticClass:"files-empty",attrs:{icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("p",{staticClass:"oc-text-muted"},[e.$route.query.term?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No resource found")]):s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No search term entered")])])]},proxy:!0}],null,!1,390334571)})]],2),e._v(" "),s("side-bar",{attrs:{open:e.sideBarOpen,"active-panel":e.sideBarActivePanel}})],1)};bi._withStripped=!0;const vi=e.normalizeComponent({render:bi,staticRenderFns:[]},undefined,gi,undefined,false,undefined,!1,void 0,void 0,void 0),_i=200;class Si{component;constructor(){this.component=vi}async search(e){if(!e)return{range:null,values:[]};const{range:t,results:i}=await s.clientService.owncloudSdk.files.search(e,_i,s.DavProperties.Default);return{range:t,values:i.map((e=>{const t=s.buildResource(e);return{id:t.id,data:t}}))}}}class xi extends e.EventBus{id;label;previewSearch;listSearch;store;router;constructor(e,t){super(),this.id="files.sdk",this.label="Search all files ↵",this.previewSearch=new ui(e,t),this.listSearch=new Si,this.store=e,this.router=t}activate(e){const t="files-common-search";(e||this.router.currentRoute.name===t)&&this.router.push({name:t,query:{term:e,provider:this.id}}).catch((()=>{}))}reset(){}updateTerm(){}get available(){return this.store.getters.capabilities?.dav?.reports?.includes("search-files")}}const wi=e.defineComponent$1({name:"FileDetails",inject:["displayedItem"],setup(){const t=e.ref(""),i=s.useRouter(),a=s.useStore(),o=s.useRouteParam("storageId"),n=e.computed((()=>s.isLocationSpacesActive(i,"files-spaces-project")?s.createLocationSpaces("files-spaces-project",{params:{storageId:e.unref(o),item:e.unref(t)}}):s.createLocationSpaces("files-spaces-personal",{params:{storageId:e.unref(o),item:e.unref(t)}})));return{sharedParentDir:t,sharedParentRoute:n,isPublicLinkContext:r.usePublicLinkContext({store:a}),accessToken:s.useAccessToken({store:a})}},data:()=>({loading:!1,sharedByName:"",sharedByDisplayName:"",sharedTime:0,sharedItem:null,shareIndicators:[],copiedDirect:!1,copiedEos:!1,timeout:null}),computed:{...e.mapGetters("Files",["versions","sharesTree","sharesTreeLoading"]),...e.mapGetters(["user","configuration"]),file(){return this.displayedItem.value},runningOnEos(){return!!this.configuration?.options?.runningOnEos},hasContent(){return this.hasTimestamp||this.ownerDisplayName||this.showSize||this.showShares||this.showVersions},noContentText(){return this.$gettext("No information to display")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected file")},sharedViaLabel(){return this.$gettext("Shared via")},sharedViaTooltip(){return this.$gettextInterpolate(this.$gettext("Navigate to '%{folder}'"),{folder:this.sharedParentDir||""},!0)},showSharedBy(){return this.showShares&&!this.ownedByCurrentUser&&!this.sharesTreeLoading&&this.sharedByDisplayName&&this.sharedByName!==this.file.ownerId},showSharedVia(){return this.showShares&&!this.sharesTreeLoading&&this.file.path!==this.sharedParentDir&&this.sharedParentDir},showShares(){return!this.isPublicLinkContext&&this.hasAnyShares},detailSharingInformation(){return"folder"===this.file.type?this.$gettext("This folder has been shared."):this.$gettext("This file has been shared.")},sharedByLabel(){return this.$gettext("Shared by")},hasTimestamp(){return this.file.mdate?.length>0},timestampLabel(){return this.$gettext("Last modified")},ownerLabel(){return this.$gettext("Owner")},ownerDisplayName(){return this.file.ownerDisplayName||this.file.shareOwnerDisplayname||this.file.owner?.[0].displayName},ownerAdditionalInfo(){return this.file.owner?.[0].additionalInfo},directLink(){return`${this.configuration.server}files/spaces/personal/home${n.encodePath(this.file.path)}`},directLinkLabel(){return this.$gettext("Direct link")},copyDirectLinkLabel(){return this.$gettext("Copy direct link")},eosPathLabel(){return this.$gettext("EOS Path")},copyEosPathLabel(){return this.$gettext("Copy EOS path")},resourceSize(){return H(this.file.size,this.$language.current)},showSize(){return"?"!==this.resourceSize},sizeLabel(){return this.$gettext("Size")},showVersions(){if("folder"!==this.file.type&&!this.isPublicLinkContext)return this.versions.length>0},versionsLabel(){return this.$gettext("Versions")},seeVersionsLabel(){return this.$gettext("See all versions")},capitalizedTimestamp(){const t=((t,s,i=e.DateTime_1.DATETIME_MED)=>z(e.DateTime_1.fromHTTP(t),s,i))(this.file.mdate,this.$language.current);return e.upperFirst(t)},hasAnyShares(){return this.file.shareTypes?.length>0||this.file.indicators?.length>0||null!==this.sharedItem},ownedByCurrentUser(){return this.file.ownerId===this.user.id||this.file.owner?.[0].username===this.user.id||this.file.shareOwner===this.user.id}},watch:{file(){this.loadData(),this.refreshShareDetailsTree()},sharesTree(){this.sharedItem=null,this.shareIndicators=s.getIndicators(this.file,this.sharesTree);const e=this.getParentSharePath(this.file.path,this.sharesTree);if(null===e)return;const t=this.sharesTree[e]?.filter((e=>i.ShareTypes.containsAnyValue([...i.ShareTypes.individuals,...i.ShareTypes.unauthenticated],[e.shareType])));0!==t.length&&(this.sharedItem=t[0],this.sharedByName=this.sharedItem.owner?.name,this.sharedByDisplayName=this.sharedItem.owner?.displayName,this.sharedItem.owner?.additionalInfo&&(this.sharedByDisplayName+=" ("+this.sharedItem.owner.additionalInfo+")"),this.sharedTime=this.sharedItem.stime,this.sharedParentDir=e)}},mounted(){this.loadData(),this.refreshShareDetailsTree()},asyncComputed:{preview:{async get(){return await new Promise((e=>setTimeout(e,500))),o.loadPreview({resource:this.file,isPublic:this.isPublicLinkContext,dimensions:S.Preview,server:this.configuration.server,userId:this.user.id,token:this.accessToken})},lazy:!0,watch:["file.id"]}},methods:{...e.mapActions("Files",["loadPreview","loadVersions","loadSharesTree"]),async refreshShareDetailsTree(){await this.loadSharesTree({client:this.$client,path:this.file.path,$gettext:this.$gettext,storageId:this.file.fileId}),this.shareIndicators=s.getIndicators(this.file,this.sharesTree)},getParentSharePath(t,s){let i=t;if(!i)return null;for(;"/"!==i;){const t=s[i];if(void 0!==t&&void 0!==t[0])return i;i=e.path.dirname(i)}return null},expandVersionsPanel(){e.bus.publish(s.SideBarEventTopics.setActivePanel,"versions-item")},async loadData(){const e=[];"file"!==this.file.type||this.isPublicLinkContext||e.push(this.loadVersions({client:this.$client,fileId:this.file.id})),await Promise.all(e.map((e=>e.catch((e=>e))))),this.loading=!1},copyEosPathToClipboard(){e.copyToClipboard(this.file.path),this.copiedEos=!0,this.clipboardSuccessHandler(),this.showMessage({title:this.$gettext("EOS path copied"),desc:this.$gettext("The EOS path has been copied to your clipboard.")})},copyDirectLinkToClipboard(){e.copyToClipboard(this.directLink),this.copiedDirect=!0,this.clipboardSuccessHandler(),this.showMessage({title:this.$gettext("Direct link copied"),desc:this.$gettext("The direct link has been copied to your clipboard.")})},clipboardSuccessHandler(){clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.copiedDirect=!1,this.copiedEos=!1}),550)}}});var yi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-sidebar"}},[e.hasContent?s("div",[e.file.thumbnail?s("div",{key:"file-thumbnail",staticClass:"details-preview oc-flex oc-flex-middle oc-flex-center oc-mb",style:{"background-image":e.$asyncComputed.preview.updating?"none":"url("+e.preview+")"},attrs:{"data-testid":"preview"}},[e.$asyncComputed.preview.updating?s("oc-spinner"):e._e()],1):s("div",{staticClass:"details-icon-wrapper oc-width-1-1 oc-flex oc-flex-middle oc-flex-center oc-mb"},[s("oc-resource-icon",{staticClass:"details-icon",attrs:{resource:e.file,size:"xxxlarge"}})],1),e._v(" "),e.shareIndicators.length?s("div",{key:"file-shares",staticClass:"oc-flex oc-flex-middle oc-my-m",attrs:{"data-testid":"sharingInfo"}},[s("oc-status-indicators",{attrs:{resource:e.file,indicators:e.shareIndicators}}),e._v(" "),s("p",{staticClass:"oc-my-rm oc-mx-s",domProps:{textContent:e._s(e.detailSharingInformation)}})],1):e._e(),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[e.hasTimestamp?s("tr",{attrs:{"data-testid":"timestamp"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.timestampLabel)}}),e._v(" "),s("td",[e.showVersions?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.capitalizedTimestamp)},on:{click:e.expandVersionsPanel}}):s("span",{domProps:{textContent:e._s(e.capitalizedTimestamp)}})],1)]):e._e(),e._v(" "),e.showSharedVia?s("tr",{attrs:{"data-testid":"shared-via"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedViaLabel)}}),e._v(" "),s("td",[s("router-link",{attrs:{to:e.sharedParentRoute}},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.sharedViaTooltip,expression:"sharedViaTooltip"}],domProps:{textContent:e._s(e.sharedParentDir)}})])],1)]):e._e(),e._v(" "),e.showSharedBy?s("tr",{attrs:{"data-testid":"shared-by"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedByLabel)}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.sharedByDisplayName)}})])]):e._e(),e._v(" "),e.ownerDisplayName?s("tr",{attrs:{"data-testid":"ownerDisplayName"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.ownerLabel)}}),e._v(" "),s("td",[s("p",{staticClass:"oc-m-rm"},[e._v("\n            "+e._s(e.ownerDisplayName)+"\n            "),e.ownedByCurrentUser?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("(me)")]):e._e(),e._v(" "),!e.ownedByCurrentUser&&e.ownerAdditionalInfo?s("span",[e._v("("+e._s(e.ownerAdditionalInfo)+")")]):e._e()])])]):e._e(),e._v(" "),e.showSize?s("tr",{attrs:{"data-testid":"sizeInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeLabel)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.resourceSize)}})]):e._e(),e._v(" "),e.showVersions?s("tr",{attrs:{"data-testid":"versionsInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.versionsLabel)}}),e._v(" "),s("td",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.versions.length)},on:{click:e.expandVersionsPanel}})],1)]):e._e(),e._v(" "),e.runningOnEos?s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.eosPathLabel)}}),e._v(" "),s("td",[s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-width-1-1"},[s("p",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.file.path,expression:"file.path"}],ref:"filePath",staticClass:"oc-my-rm oc-text-truncate",domProps:{textContent:e._s(e.file.path)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.copyEosPathLabel,expression:"copyEosPathLabel"}],attrs:{"aria-label":e.copyEosPathLabel,appearance:"raw",variation:e.copiedEos?"success":"passive"},on:{click:e.copyEosPathToClipboard}},[e.copiedEos?s("oc-icon",{key:"oc-copy-to-clipboard-copied",staticClass:"_clipboard-success-animation",attrs:{name:"checkbox-circle"}}):s("oc-icon",{key:"oc-copy-to-clipboard-copy",attrs:{name:"clipboard"}})],1)],1)])]):e._e(),e._v(" "),e.runningOnEos?s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.directLinkLabel)}}),e._v(" "),s("td",[s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-width-1-1"},[s("p",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.directLink,expression:"directLink"}],ref:"directLink",staticClass:"oc-my-rm oc-text-truncate",domProps:{textContent:e._s(e.directLink)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.copyDirectLinkLabel,expression:"copyDirectLinkLabel"}],attrs:{"aria-label":e.copyDirectLinkLabel,appearance:"raw",variation:e.copiedDirect?"success":"passive"},on:{click:e.copyDirectLinkToClipboard}},[e.copiedDirect?s("oc-icon",{key:"oc-copy-to-clipboard-copied",staticClass:"_clipboard-success-animation",attrs:{name:"checkbox-circle"}}):s("oc-icon",{key:"oc-copy-to-clipboard-copy",attrs:{name:"clipboard"}})],1)],1)])]):e._e()])]):s("p",{attrs:{"data-testid":"noContentText"},domProps:{textContent:e._s(e.noContentText)}})])};yi._withStripped=!0;const Ci=e.normalizeComponent({render:yi,staticRenderFns:[]},undefined,wi,"data-v-414917de",false,undefined,!1,void 0,void 0,void 0);const $i=e.defineComponent$1({name:"FileDetailsMultiple",computed:{...e.mapGetters("Files",["selectedFiles"]),selectedFilesCount(){return this.selectedFiles.length},selectedFilesString(){return this.$gettextInterpolate(this.$ngettext("%{ itemCount } item selected","%{ itemCount } items selected",this.selectedFilesCount),{itemCount:this.selectedFilesCount})},sizeValue(){let e=0;return this.selectedFiles.forEach((t=>e+=parseInt(t.size))),H(e,this.$language.current)},sizeText(){return this.$gettext("Size")},filesCount(){return this.selectedFiles.filter((e=>"file"===e.type)).length},filesText(){return this.$gettext("Files")},foldersCount(){return this.selectedFiles.filter((e=>"folder"===e.type)).length},foldersText(){return this.$gettext("Folders")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected files")}}});var Ei=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-multiple-sidebar"}},[s("div",{staticClass:"files-preview oc-mb"},[s("div",{staticClass:"files-preview-body"},[s("oc-icon",{staticClass:"preview-icon",attrs:{size:"xxlarge",variation:"passive",name:"file-copy"}}),e._v(" "),s("p",{staticClass:"preview-text",attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)]),e._v(" "),s("div",[s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[s("tr",{attrs:{"data-testid":"filesCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.filesText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.filesCount)}})]),e._v(" "),s("tr",{attrs:{"data-testid":"foldersCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.foldersText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.foldersCount)}})]),e._v(" "),s("tr",{attrs:{"data-testid":"size"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.sizeValue)}})])])])])};Ei._withStripped=!0;const Ri=e.normalizeComponent({render:Ei,staticRenderFns:[]},undefined,$i,"data-v-c1e0f2fa",false,undefined,!1,void 0,void 0,void 0);const ki=e.defineComponent$1({name:"FileActions",components:{ActionMenuItem:fe},mixins:[he],computed:{...e.mapGetters("Files",["highlightedFile"]),resources(){return[this.highlightedFile]},actions(){return this.$_fileActions_getAllAvailableActions(this.resources)}}});var Ii=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-mt-s",attrs:{id:"oc-files-actions-sidebar"}},e._l(e.actions,(function(t,i){return s("action-menu-item",{key:"action-"+i,staticClass:"oc-py-xs",attrs:{action:t,items:e.resources}})})),1)};Ii._withStripped=!0;const Fi=e.normalizeComponent({render:Ii,staticRenderFns:[]},undefined,ki,undefined,false,undefined,!1,void 0,void 0,void 0);const Ti={name:"FileVersions",data:()=>({loading:!1,DavProperty:s.DavProperty}),computed:{...e.mapGetters("Files",["highlightedFile","versions"]),hasVersion(){return this.versions.length>0}},watch:{highlightedFile(){this.fetchFileVersions()}},mounted(){this.fetchFileVersions()},methods:{...e.mapActions("Files",["loadVersions"]),...e.mapMutations("Files",["UPDATE_RESOURCE"]),currentVersionId(e){const t=e.name.split("/");return t[t.length-1]},async fetchFileVersions(){this.loading=!0,await this.loadVersions({client:this.$client,fileId:this.highlightedFile.fileId}),this.loading=!1},revertVersion(e){this.$client.fileVersions.restoreFileVersion(this.highlightedFile.id,this.currentVersionId(e),this.highlightedFile.path).then((()=>{this.$client.files.fileInfo(this.highlightedFile.webDavPath,s.DavProperties.Default).then((e=>{const t=s.buildResource(e);this.UPDATE_RESOURCE(t)})),this.fetchFileVersions()}))},downloadVersion(e){const t=this.currentVersionId(e);return this.downloadFile(this.highlightedFile,t)},formatVersionDate(t){return i=t.fileInfo[s.DavProperty.LastModifiedDate],a=this.$language.current,q(e.DateTime_1.fromHTTP(i),a);var i,a},formatVersionFileSize(e){return H(e.fileInfo[s.DavProperty.ContentLength],this.$language.current)}}};var Li=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-versions-sidebar"}},[e.loading?s("oc-loader"):e._e(),e._v(" "),!e.loading&&e.hasVersion?s("oc-table-simple",[s("oc-tbody",e._l(e.versions,(function(t,i){return s("oc-tr",{key:i,staticClass:"file-row"},[s("oc-td",{attrs:{width:"shrink","data-testid":"file-versions-file-icon"}},[s("oc-resource-icon",{attrs:{resource:e.highlightedFile,size:"medium"}})],1),e._v(" "),s("oc-td",{staticClass:"oc-text-muted oc-text-nowrap",attrs:{width:"shrink","data-testid":"file-versions-file-last-modified-date"}},[e._v("\n          "+e._s(e.formatVersionDate(t))+"\n        ")]),e._v(" "),s("oc-td",{staticClass:"oc-text-muted oc-text-nowrap",attrs:{"data-testid":"file-versions-file-size"}},[e._v("\n          "+e._s(e.formatVersionFileSize(t))+"\n        ")]),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Restore older version"),expression:"$gettext('Restore older version')"}],attrs:{"data-testid":"file-versions-revert-button",appearance:"raw","aria-label":e.$gettext("Restore older version")},on:{click:function(s){return e.revertVersion(t)}}},[s("oc-icon",{attrs:{name:"restart","fill-type":"line"}})],1)],1),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Download older version"),expression:"$gettext('Download older version')"}],attrs:{"data-testid":"file-versions-download-button",appearance:"raw","aria-label":e.$gettext("Download older version")},on:{click:function(s){return e.downloadVersion(t)}}},[s("oc-icon",{attrs:{name:"download-cloud","fill-type":"line"}})],1)],1)],1)})),1)],1):s("div",[s("p",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"file-versions-no-versions"}},[e._v("No Versions available for this file")])])],1)};Li._withStripped=!0;const Di=e.normalizeComponent({render:Li,staticRenderFns:[]},undefined,Ti,undefined,false,undefined,!1,void 0,void 0,void 0);const Ai={title:"Invite specific people",text:"Enter a name or group to share this item.",list:[{text:"Subfolders",headline:!0},{text:"If you share a folder, all of its contents and subfolders will be shared as well."},{text:"Notification",headline:!0},{text:"Invited people will be notified via email or in-app notification."},{text:"Incognito",headline:!0},{text:"Invited people can not see who else has access.."},{text:"“via folder”",headline:!0},{text:"The “via folder” is shown next to a share, if access has already been given via a parent folder. Click on the “via folder” to edit the share on its parent folder."}],readMoreLink:"https://doc.owncloud.com/webui/next/owncloud_web/web_for_users.html#sharing"},Pi={list:[{text:"Search for service or secondary Account",headline:!0},{text:'To search for service or secondary accounts prefix the username with "a:" (like "a:doe") and for guest accounts prefix the username with "l:" (like "l:doe").'}]},Mi={title:"Add members to this Space",text:"Enter a name to add people or groups as members to this Space.",list:[{text:"What members can do",headline:!0},{text:"Members can see who else has access to this space and can access all files in this space. Read or write permissions can be set by the member’s role such as “Viewer” or “Editor”."},{text:"What Space managers can do",headline:!0},{text:"Members with the Manager role can edit all properties and content of a Space, such as adding or removing members, sharing subfolders with non-members, or creating links to share."}],readMoreLink:"https://doc.owncloud.com/webui/next/owncloud_web/web_for_users.html#sharing"},Oi={title:"Choose how access is granted",list:[{text:"Only invited people can access",headline:!0},{text:'Account and login is required. Only people from the list "Invited people" can access.'},{text:"Everyone with the link",headline:!0},{text:'No login required. Everyone with the link can access. If you share this link with people from the list "Invited people", they need to login so that their individual assigned permissions can take effect. If they are not logged-in, the permissions of the link take effect.'},{text:"Quicklink",headline:!0},{text:'The quicklink is the default link that is copied when you select "Get link” from the context menu.'}],readMoreLink:"https://doc.owncloud.com/webui/next/owncloud_web/web_for_users.html#sharing"},Ni={title:"What are indirect links?",text:"Indirect links are links giving access by a parent folder.",list:[{text:"How to edit indirect links",headline:!0},{text:"Indirect links can only be edited in their parent folder. Click on the folder icon below the link to navgate to the parent folder."}],readMoreLink:"https://doc.owncloud.com/webui/next/owncloud_web/web_for_users.html#sharing"};const Bi=e.defineComponent({name:"DetailsAndEdit",props:{availableRoleOptions:{type:Array,required:!0},canRename:{type:Boolean,default:!1},expirationDate:{type:Object,default:()=>({}),required:!0},isFolderShare:{type:Boolean,default:!1},isModifiable:{type:Boolean,default:!1},isPasswordEnforced:{type:Boolean,default:!1},link:{type:Object,required:!0}},data(){return{newExpiration:this.link.expiration}},computed:{currentLinkRoleDescription(){return i.LinkShareRoles.getByBitmask(parseInt(this.link.permissions),this.isFolderShare).description(!1)},currentLinkRoleLabel(){return i.LinkShareRoles.getByBitmask(parseInt(this.link.permissions),this.isFolderShare).label},editOptions(){const e=[];return this.canRename&&e.push({id:"rename",title:this.$gettext("Rename"),icon:"pencil",method:this.showRenameModal}),this.link.expiration?(e.push({id:"edit-expiration",title:this.$gettext("Edit expiration date"),method:this.updateLink,icon:"calendar-event",showDatepicker:!0}),this.expirationDate.enforced||e.push({id:"remove-expiration",title:this.$gettext("Remove expiration date"),icon:"calendar",method:()=>this.updateLink({link:{...this.link,expiration:""}})})):e.push({id:"add-expiration",title:this.$gettext("Add expiration date"),method:this.updateLink,icon:"calendar-event",showDatepicker:!0}),this.link.password&&(e.push({id:"edit-password",title:this.$gettext("Edit password"),icon:"lock-password",method:this.showPasswordModal}),this.isPasswordEnforced||e.push({id:"remove-password",title:this.$gettext("Remove password"),icon:"lock-unlock",method:()=>this.updateLink({link:{...this.link,password:""}})})),this.isPasswordEnforced||this.link.password||e.push({id:"add-password",title:this.$gettext("Add password"),icon:"lock-password",method:this.showPasswordModal}),e},deleteOption(){return{id:"delete",title:this.$gettext("Delete link"),method:this.deleteLink,icon:"delete-bin-5",variation:"danger"}},viaRouterParams(){const t=this.link.path,i=s.isLocationSpacesActive(this.$router,"files-spaces-project")?"files-spaces-project":"files-spaces-personal";return s.createLocationSpaces(i,{params:{item:t||"/",storageId:this.$route.params.storageId},query:{scrollTo:e.basename(t)}})},localExpirationDate(){return z(e.DateTime_1.fromISO(this.link.expiration).endOf("day"),this.$language.current)},expirationDateRelative(){return q(e.DateTime_1.fromISO(this.link.expiration).endOf("day"),this.$language.current)},expirationDateTooltip(){return this.$gettextInterpolate(this.$gettext("Expires in %{timeToExpiry} (%{expiryDate})"),{timeToExpiry:this.expirationDateRelative,expiryDate:this.localExpirationDate},!0)},viaTooltip(){return this.link.indirect?this.$gettextInterpolate(this.$gettext("Navigate to the parent (%{folderName})"),{folderName:e.basename(this.link.path)},!0):null},passwortProtectionTooltip(){return this.$gettext("This link is password-protected")}},watch:{newExpiration(e){this.updateLink({link:{...this.link,expiration:e}})}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage"]),updateLink({link:e=this.link,dropRef:t=this.$refs.editPublicLinkDropdown,onSuccess:s=(()=>{})}){this.$emit("updateLink",{link:e,onSuccess:s}),t.hide()},deleteLink(){this.$emit("removePublicLink",{link:this.link}),this.$refs.editPublicLinkDropdown.hide()},showRenameModal(){const e={variation:"passive",title:this.$gettext("Edit name"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Save"),hasInput:!0,inputValue:this.link.name,inputLabel:this.$gettext("Link name"),onCancel:this.hideModal,onConfirm:e=>this.updateLink({link:{...this.link,name:e},onSuccess:()=>{this.hideModal()}})};this.createModal(e)},checkPasswordNotEmpty(e){return""===e?this.setModalInputErrorMessage(this.$gettext("Password can't be empty")):this.setModalInputErrorMessage(null)},showPasswordModal(){const e={variation:"passive",title:this.link.password?this.$gettext("Edit password"):this.$gettext("Add password"),cancelText:this.$gettext("Cancel"),confirmText:this.link.password?this.$gettext("Apply"):this.$gettext("Set"),hasInput:!0,inputDescription:this.$gettext("Password can't be empty"),inputLabel:this.$gettext("Password"),inputType:"password",onCancel:this.hideModal,onInput:e=>this.checkPasswordNotEmpty(e),onConfirm:e=>{this.updateLink({link:{...this.link,password:e},onSuccess:()=>{this.hideModal()}})}};this.createModal(e)}}});var Ui=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"link-details oc-flex oc-flex-between oc-flex-middle oc-pl-s"},[e.isModifiable?s("div",[s("oc-button",{staticClass:"edit-public-link-role-dropdown-toggle oc-text-left",attrs:{id:"edit-public-link-role-dropdown-toggle-"+e.link.id,appearance:"raw","gap-size":"none"}},[s("span",{staticClass:"link-current-role",domProps:{textContent:e._s(e.$gettext(e.currentLinkRoleLabel))}}),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s"}})],1),e._v(" "),s("oc-drop",{ref:"editPublicLinkRoleDropdown",staticClass:"edit-public-link-role-dropdown",attrs:{"drop-id":"edit-public-link-role-dropdown",toggle:"#edit-public-link-role-dropdown-toggle-"+e.link.id,"padding-size":"small",offset:"0",mode:"click"}},[s("oc-list",{staticClass:"roleDropdownList"},e._l(e.availableRoleOptions,(function(t){return s("li",{key:"role-dropdown-"+t.label.toLowerCase()},[s("oc-button",{staticClass:"oc-p-s",class:{selected:parseInt(e.link.permissions)===t.bitmask(!1),"oc-background-primary-gradient":parseInt(e.link.permissions)===t.bitmask(!1)},attrs:{id:"files-role-"+t.label.toLowerCase(),appearance:"raw",variation:parseInt(e.link.permissions)===t.bitmask(!1)?"inverse":"passive","justify-content":"space-between"},on:{click:function(s){e.updateLink({link:Object.assign({},e.link,{permissions:t.bitmask(!1)}),dropRef:e.$refs.editPublicLinkRoleDropdown})}}},[s("span",{staticClass:"oc-flex oc-flex-middle"},[s("oc-icon",{staticClass:"oc-pl-s oc-pr-m",attrs:{name:t.icon}}),e._v(" "),s("span",[s("span",{staticClass:"oc-text-bold oc-display-block oc-width-1-1",domProps:{textContent:e._s(e.$gettext(t.label))}}),e._v(" "),s("span",{staticClass:"oc-text-small"},[e._v(e._s(e.$gettext(t.description())))])])],1),e._v(" "),s("span",{staticClass:"oc-flex"},[parseInt(e.link.permissions)===t.bitmask(!1)?s("oc-icon",{attrs:{name:"check"}}):e._e()],1)])],1)})),0)],1)],1):s("p",{staticClass:"oc-my-rm"},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext(e.currentLinkRoleDescription),expression:"$gettext(currentLinkRoleDescription)"}],staticClass:"link-current-role",domProps:{textContent:e._s(e.$gettext(e.currentLinkRoleLabel))}})]),e._v(" "),s("div",{staticClass:"details-buttons",class:{"oc-pr-s":!e.isModifiable}},[e.link.indirect?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viaTooltip,expression:"viaTooltip"}],staticClass:"oc-files-file-link-via",attrs:{"area-label":e.viaTooltip,type:"router-link",appearance:"raw",to:e.viaRouterParams}},[s("oc-icon",{attrs:{name:"folder-shared","fill-type":"line"}})],1):e._e(),e._v(" "),e.link.password?s("oc-icon",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.passwortProtectionTooltip,expression:"passwortProtectionTooltip"}],attrs:{name:"lock-password","fill-type":"line","aria-label":e.passwortProtectionTooltip}}):e._e(),e._v(" "),e.link.expiration?s("oc-icon",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDateTooltip,expression:"expirationDateTooltip"}],staticClass:"oc-files-public-link-expires",attrs:{"data-testid":"files-link-id-"+e.link.id+"-expiration-date","aria-label":e.expirationDateTooltip,name:"calendar-event","fill-type":"line"}}):e._e(),e._v(" "),e.isModifiable?s("div",[s("oc-button",{staticClass:"edit-drop-trigger",attrs:{id:"edit-public-link-dropdown-toggl-"+e.link.id,appearance:"raw","data-testid":"files-link-id-"+e.link.id+"-btn-edit"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{ref:"editPublicLinkDropdown",attrs:{"drop-id":"edit-public-link-dropdown",toggle:"#edit-public-link-dropdown-toggl-"+e.link.id,"padding-size":"small",mode:"click"}},[s("oc-list",{staticClass:"edit-public-link-dropdown-menu oc-files-context-actions-border oc-pb-s"},e._l(e.editOptions,(function(t,i){return s("li",{key:"public-link-edit-option-"+i,staticClass:"oc-rounded oc-menu-item-hover"},[t.showDatepicker?s("oc-datepicker",{staticClass:"link-expiry-picker",attrs:{"min-date":e.expirationDate.min,"max-date":e.expirationDate.max,locale:e.$language.current,"is-required":e.expirationDate.enforce},scopedSlots:e._u([{key:"default",fn:function(i){var a=i.togglePopover;return[s("oc-button",{staticClass:"oc-p-s action-menu-item",attrs:{"data-testid":"files-link-id-"+e.link.id+"-edit-"+t.id,appearance:"raw",variation:t.variation},on:{click:a}},[s("oc-icon",{attrs:{name:t.icon,"fill-type":"line",size:"medium"}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.title)}})],1)]}}],null,!0),model:{value:e.newExpiration,callback:function(t){e.newExpiration=t},expression:"newExpiration"}}):s("oc-button",{staticClass:"oc-p-s action-menu-item",attrs:{appearance:"raw","data-testid":"files-link-id-"+e.link.id+"-edit-"+t.id},on:{click:t.method}},[s("oc-icon",{attrs:{name:t.icon,"fill-type":"line",size:"medium"}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.title)}})],1)],1)})),0),e._v(" "),s("oc-list",{staticClass:"edit-public-link-dropdown-menu oc-pt-s"},[s("li",{staticClass:"oc-rounded oc-menu-item-hover"},[s("oc-button",{staticClass:"oc-p-s action-menu-item",attrs:{appearance:"raw","data-testid":"files-link-id-"+e.link.id+"-edit-"+e.deleteOption.id},on:{click:e.deleteOption.method}},[s("oc-icon",{attrs:{name:e.deleteOption.icon,"fill-type":"line",size:"medium"}}),e._v(" "),s("span",{domProps:{textContent:e._s(e.deleteOption.title)}})],1)],1)])],1)],1):e._e()],1)])};Ui._withStripped=!0;const zi=e.normalizeComponent({render:Ui,staticRenderFns:[]},undefined,Bi,"data-v-4fef0011",false,undefined,!1,void 0,void 0,void 0);const qi={name:"NameAndCopy",props:{link:{type:Object,required:!0}},data:()=>({copied:!1,timeout:null}),computed:{linkName(){return this.link.name},copyBtnLabel(){return this.$gettext("Copy")},copyBtnHint(){return this.$gettext("Copy link to clipboard")},copiedLabel(){return this.$gettext("Copied")}},methods:{...e.mapActions(["showMessage"]),copyLinkToClipboard(){e.copyToClipboard(this.link.url),this.clipboardSuccessHandler(),this.showMessage({title:this.link.quicklink?this.$gettext("The quicklink has been copied to your clipboard."):this.$gettextInterpolate(this.$gettext('The link "%{linkName}" has been copied to your clipboard.'),{linkName:this.linkName},!0)})},clipboardSuccessHandler(){this.copied=!0,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.copied=!1}),550)}}};var Hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mb-s oc-width-1-1"},[s("h4",{staticClass:"oc-text-truncate oc-text-normal oc-files-file-link-name oc-m-rm",domProps:{textContent:e._s(e.linkName)}}),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-width-1-1 oc-p-s link-name-container"},[e.copied?s("div",{staticClass:"oc-flex oc-flex-middle oc-text-truncate"},[s("oc-icon",{attrs:{variation:"success",name:"checkbox-circle"}}),e._v(" "),s("p",{staticClass:"oc-files-file-link-url url-copied oc-ml-s oc-my-rm",domProps:{textContent:e._s(e.copiedLabel)}})],1):s("div",{staticClass:"oc-flex oc-flex-middle oc-text-truncate"},[s("oc-icon",{attrs:{name:"link","fill-type":"line"}}),e._v(" "),s("p",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.link.url,expression:"link.url"}],staticClass:"oc-files-file-link-url oc-ml-s oc-text-truncate oc-my-rm",domProps:{textContent:e._s(e.link.url)}})],1),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.copyBtnHint,expression:"copyBtnHint"}],staticClass:"oc-files-public-link-copy-url",attrs:{appearance:"raw","aria-label":e.copyBtnHint},domProps:{textContent:e._s(e.copyBtnLabel)},on:{click:e.copyLinkToClipboard}})],1)])};Hi._withStripped=!0;const Gi=e.normalizeComponent({render:Hi,staticRenderFns:[]},undefined,qi,"data-v-27abf966",false,undefined,!1,void 0,void 0,void 0);const ji={name:"CreateQuickLink",props:{expirationDate:{type:Object,default:()=>{},required:!0}},computed:{heading(){return this.$gettext("Quick link")},createLinkHint(){return this.$gettext("Create quick link")},createLinkLabel(){return this.$gettext("Create link")},noLinkLabel(){return this.$gettext("No link")}},methods:{createQuickLink(){this.$emit("createPublicLink",{link:{name:this.$gettext("Quicklink"),permissions:1,expiration:this.expirationDate.enforced?this.expirationDate.default:null,quicklink:!0,password:!1}})}}};var Vi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mb-s oc-width-1-1 oc-mb-l"},[s("h4",{staticClass:"oc-text-truncate oc-text-normal oc-files-file-link-name oc-my-rm",domProps:{textContent:e._s(e.heading)}}),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-width-1-1 oc-p-s link-name-container"},[s("div",{staticClass:"oc-flex oc-flex-middle oc-text-truncate"},[s("oc-icon",{attrs:{name:"link","fill-type":"line"}}),e._v(" "),s("p",{staticClass:"oc-files-file-link-url oc-ml-s oc-text-truncate oc-my-rm",domProps:{textContent:e._s(e.noLinkLabel)}})],1),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.createLinkHint,expression:"createLinkHint"}],attrs:{appearance:"raw","aria-label":e.createLinkHint},domProps:{textContent:e._s(e.createLinkLabel)},on:{click:e.createQuickLink}})],1)])};Vi._withStripped=!0;const Wi=e.normalizeComponent({render:Vi,staticRenderFns:[]},undefined,ji,undefined,false,undefined,!1,void 0,void 0,void 0);const Qi=e.defineComponent$1({name:"FileLinks",components:{CreateQuickLink:Wi,DetailsAndEdit:zi,NameAndCopy:Gi},setup(){const e=s.useStore(),t=!e.getters.configuration.options.sidebar.shares.showAllOnLoad,i=!e.getters.configuration.options.sidebar.shares.showAllOnLoad;return{...s.useGraphClient(),hasSpaces:s.useCapabilitySpacesEnabled(),hasShareJail:s.useCapabilityShareJailEnabled(),hasResharing:s.useCapabilityFilesSharingResharing(),hasPublicLinkEditing:s.useCapabilityFilesSharingPublicCanEdit(),hasPublicLinkAliasSupport:s.useCapabilityFilesSharingPublicAlias(),indirectLinkListCollapsed:i,linkListCollapsed:t}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingLinks"]),...e.mapGetters(["capabilities","configuration"]),...e.mapState(["user"]),...e.mapState("Files",["sharesTree"]),addButtonLabel(){return this.$gettext("Add link")},collapseButtonTitle(){return this.linkListCollapsed?this.$gettext("Show all"):this.$gettext("Show less")},collapseButtonIcon(){return this.linkListCollapsed?"arrow-down-s":"arrow-up-s"},indirectCollapseButtonTitle(){return this.indirectLinkListCollapsed?this.$gettext("Show"):this.$gettext("Hide")},indirectCollapseButtonIcon(){return this.indirectLinkListCollapsed?"arrow-down-s":"arrow-up-s"},quicklink(){return this.currentFileOutgoingLinks.find((e=>!0===e.quicklink))},share(){return this.sharesTree[""]?.find((e=>e.incoming))},expirationDate(){const t=this.capabilities.files_sharing.public.expire_date;let s=null,i=null;if(t.days){const i=parseInt(t.days);s=e.DateTime_1.now().setLocale(U(this.$language.current)).plus({days:i}).toJSDate()}if(t.enforced){const s=parseInt(t.days);i=e.DateTime_1.now().setLocale(U(this.$language.current)).plus({days:s}).toJSDate()}return{enforced:t.enforced,default:s,min:e.DateTime_1.now().setLocale(U(this.$language.current)).toJSDate(),max:i}},availableRoleOptions(){return this.share?.incoming&&this.canCreatePublicLinks?i.LinkShareRoles.filterByBitmask(parseInt(this.share.permissions),this.highlightedFile.isFolder,this.hasPublicLinkEditing,this.hasPublicLinkAliasSupport):i.LinkShareRoles.list(this.highlightedFile.isFolder,this.hasPublicLinkEditing,this.hasPublicLinkAliasSupport)},passwordEnforced(){return this.capabilities.files_sharing.public.password?.enforced_for||{read_only:!1,upload_only:!1,read_write:!1}},helpersEnabled(){return this.configuration?.options?.contextHelpers},viaLinkHelp:()=>Oi,indirectLinkHelp:()=>Ni,canCreatePublicLinks(){if(this.highlightedFile.isReceivedShare()&&!this.hasResharing)return!1;return!(s.isLocationSpacesActive(this.$router,"files-spaces-share")&&!this.hasResharing)&&this.highlightedFile.canShare({user:this.user})},canEdit(){return this.canCreatePublicLinks},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},linksHeading(){return this.hasSpaces?this.$gettext("Share via link"):this.$gettext("Share via public link")},indirectLinksHeading(){const e=this.$gettext("Indirect links (%{ count })");return this.$gettextInterpolate(e,{count:this.indirectLinks.length})},links(){return this.currentFileOutgoingLinks.filter((e=>!e.quicklink)).map((e=>(e.key="direct-link-"+e.id,e))).sort(((e,t)=>t.stime-e.stime))},displayLinks(){return this.links.length>3&&this.linkListCollapsed?this.links.slice(0,3):this.links},displayIndirectLinks(){return this.indirectLinkListCollapsed?[]:this.indirectLinks},indirectLinks(){const e=[],t=s.getParentPaths(this.highlightedFile.path,!1);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=X(this.sharesTree[t]);s&&s.forEach((t=>{t.outgoing&&t.shareType===i.ShareTypes.link.value&&(t.key="indirect-link-"+t.id,e.push(t))}))})),e.sort(((e,t)=>t.stime-e.stime)))},resourceIsSpace(){return"space"===this.highlightedFile.type},currentStorageId(){return this.resourceIsSpace?this.highlightedFile.id:this.$route.params.storageId||null}},methods:{...e.mapActions("Files",["addLink","updateLink","removeLink"]),...e.mapActions(["showMessage","createModal","hideModal"]),toggleLinkListCollapsed(){this.linkListCollapsed=!this.linkListCollapsed},toggleIndirectLinkListCollapsed(){this.indirectLinkListCollapsed=!this.indirectLinkListCollapsed},isPasswordEnforcedFor(e){const t=i.LinkShareRoles.getByBitmask(parseInt(e.permissions),e.indirect||this.highlightedFile.isFolder),s=t.hasPermission(i.SharePermissions.read),a=t.hasPermission(i.SharePermissions.update),r=t.hasPermission(i.SharePermissions.create),o=t.hasPermission(i.SharePermissions.delete);return!0===this.passwordEnforced.read_only?s&&!a&&!r&&!o:!0===this.passwordEnforced.upload_only?!s&&!a&&r&&!o:!0===this.passwordEnforced.read_write?s&&!a&&r&&!o:!0===this.passwordEnforced.read_write_delete&&(s&&a&&r&&o)},addNewLink(){this.checkLinkToCreate({link:{name:this.$gettext("Link"),permissions:1,expiration:this.expirationDate.default,password:!1}})},checkLinkToCreate({link:e,onError:t=(()=>{})}){const s=this.getParamsForLink(e);this.isPasswordEnforcedFor(e)?$e({store:this.$store},(e=>{this.createLink({params:{...s,password:e},onError:t})})):this.createLink({params:s,onError:t})},checkLinkToUpdate({link:e,onSuccess:t=(()=>{})}){const s=this.getParamsForLink(e);!e.password&&this.isPasswordEnforcedFor(e)?$e({store:this.$store},(e=>{this.updatePublicLink({params:{...s,password:e},onSuccess:t})})):this.updatePublicLink({params:s,onSuccess:t})},getParamsForLink(t){let s,i="";switch(t.expiration&&(i=("string"==typeof t.expiration?e.DateTime_1.fromISO(t.expiration):e.DateTime_1.fromJSDate(t.expiration)).setLocale(U(this.$language.current)).endOf("day").toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ")),t.password){case!1:s=void 0;break;case"":s="";break;case!0:s=void 0;break;default:s=t.password}return{expireDate:i,password:s,id:t.id,permissions:t.permissions.toString(),quicklink:t.quicklink,name:t.name,spaceRef:this.highlightedFile.fileId,...this.currentStorageId&&{storageId:this.currentStorageId}}},async createLink({params:e,onError:t=(e=>{})}){let s=this.highlightedFile.path;this.hasShareJail&&"/"===s&&(s=`/${this.highlightedFile.name}`),await this.addLink({path:s,client:this.$client,$gettext:this.$gettext,storageId:this.highlightedFile.fileId||this.highlightedFile.id,params:e}).catch((e=>{t(e),console.error(e),this.showMessage({title:this.$gettext("Failed to create link"),status:"danger"})})),this.showMessage({title:this.$gettext("Link was created successfully")})},async updatePublicLink({params:e,onSuccess:t=(()=>{}),onError:s=(e=>{})}){await this.updateLink({id:e.id,client:this.$client,params:e}).then(t).catch((e=>{s(e),console.error(e),this.showMessage({title:this.$gettext("Failed to update link"),status:"danger"})})),this.showMessage({title:this.$gettext("Link was updated successfully")})},deleteLinkConfirmation({link:e}){const t={variation:"danger",icon:"alarm-warning",title:this.$gettext("Delete link"),message:this.$gettext("Are you sure you want to delete this link? Recreating the same link again is not possible."),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:()=>this.deleteLink({client:this.$client,share:e,resource:this.highlightedFile})};this.createModal(t)},async deleteLink({client:e,share:t,resource:s}){this.hideModal();let i=s.path;this.hasShareJail&&"/"===i&&(i=`/${s.name}`),await this.removeLink({client:e,share:t,path:i,storageId:s.fileId}).then(this.showMessage({title:this.$gettext("Link was deleted successfully")})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to delete link"),status:"danger"})}))}}});var Ji=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-file-link"}},[s("div",{staticClass:"oc-flex"},[s("h3",{staticClass:"oc-text-bold oc-text-medium oc-m-rm",domProps:{textContent:e._s(e.linksHeading)}}),e._v(" "),e.helpersEnabled?s("oc-contextual-helper",e._b({staticClass:"oc-pl-xs"},"oc-contextual-helper",e.viaLinkHelp,!1)):e._e()],1),e._v(" "),e.canCreatePublicLinks?e._e():s("p",{staticClass:"oc-mt-m",attrs:{"data-testid":"files-links-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),s("div",{staticClass:"oc-mt-m"},[e.quicklink?s("name-and-copy",{attrs:{link:e.quicklink}}):e.canCreatePublicLinks?s("create-quick-link",{attrs:{"expiration-date":e.expirationDate},on:{createPublicLink:e.checkLinkToCreate}}):e._e(),e._v(" "),e.quicklink?s("details-and-edit",{attrs:{"available-role-options":e.availableRoleOptions,"can-rename":!1,"expiration-date":e.expirationDate,"is-folder-share":e.highlightedFile.isFolder,"is-modifiable":e.canEdit,"is-password-enforced":e.isPasswordEnforcedFor(e.quicklink),link:e.quicklink},on:{updateLink:e.checkLinkToUpdate,removePublicLink:e.deleteLinkConfirmation}}):e._e(),e._v(" "),s("hr",{staticClass:"oc-my-m"}),e._v(" "),e.canCreatePublicLinks?s("oc-button",{attrs:{id:"files-file-link-add",variation:"primary",appearance:"raw","data-testid":"files-link-add-btn"},domProps:{textContent:e._s(e.addButtonLabel)},on:{click:e.addNewLink}}):e._e()],1),e._v(" "),e.links.length?s("oc-list",{staticClass:"oc-overflow-hidden oc-my-m"},e._l(e.displayLinks,(function(t){return s("li",{key:t.key,staticClass:"oc-py-s",attrs:{"data-testid":"files-link-id-"+t.id}},[s("name-and-copy",{attrs:{link:t}}),e._v(" "),s("details-and-edit",{attrs:{"available-role-options":e.availableRoleOptions,"can-rename":!0,"expiration-date":e.expirationDate,"is-folder-share":e.highlightedFile.isFolder,"is-modifiable":e.canEdit,"is-password-enforced":e.isPasswordEnforcedFor(t),link:t},on:{updateLink:e.checkLinkToUpdate,removePublicLink:e.deleteLinkConfirmation}})],1)})),0):e._e(),e._v(" "),e.links.length>3?s("div",{staticClass:"oc-flex oc-flex-center"},[s("oc-button",{attrs:{appearance:"raw"},on:{click:e.toggleLinkListCollapsed}},[s("span",{domProps:{textContent:e._s(e.collapseButtonTitle)}}),e._v(" "),s("oc-icon",{attrs:{name:e.collapseButtonIcon,"fill-type":"line"}})],1)],1):e._e(),e._v(" "),e.indirectLinks.length?s("div",{attrs:{id:"indirect-link-list"}},[s("hr",{staticClass:"oc-my-m"}),e._v(" "),s("div",{staticClass:"oc-flex"},[s("h3",{staticClass:"oc-text-bold oc-m-rm oc-text-medium"},[s("span",{domProps:{textContent:e._s(e.indirectLinksHeading)}})]),e._v(" "),e.helpersEnabled?s("oc-contextual-helper",e._b({staticClass:"oc-pl-xs"},"oc-contextual-helper",e.indirectLinkHelp,!1)):e._e()],1),e._v(" "),e.indirectLinkListCollapsed?e._e():s("oc-list",{staticClass:"oc-overflow-hidden oc-my-m"},e._l(e.displayIndirectLinks,(function(t){return s("li",{key:t.key,staticClass:"oc-py-s",attrs:{"data-testid":"files-link-id-"+t.id}},[s("name-and-copy",{attrs:{link:t}}),e._v(" "),s("details-and-edit",{attrs:{"available-role-options":e.availableRoleOptions,"expiration-date":e.expirationDate,"is-folder-share":!0,"is-modifiable":!1,link:t}})],1)})),0),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-center"},[s("oc-button",{attrs:{id:"indirect-link-list-toggle",appearance:"raw"},on:{click:e.toggleIndirectLinkListCollapsed}},[s("span",{domProps:{textContent:e._s(e.indirectCollapseButtonTitle)}}),e._v(" "),s("oc-icon",{attrs:{name:e.indirectCollapseButtonIcon,"fill-type":"line"}})],1)],1)],1):e._e()],1)};Ji._withStripped=!0;const Yi=e.normalizeComponent({render:Ji,staticRenderFns:[]},undefined,Qi,undefined,false,undefined,!1,void 0,void 0,void 0);function Ki(e){const t=[];let s,i=0,a=-1,r=0;for(;i<e.length;){s=e.charAt(i);const o=!r&&"."===s||s>="0"&&s<="9";o!==r&&(a++,t[a]="",r=o),t[a]+=s,i++}return t}const Xi={naturalSortCompare:function(e,t){const s=Ki(e),i=Ki(t);let a,r,o;for(a=0;s[a]&&i[a];a++)if(s[a]!==i[a])return r=Number(s[a]),o=Number(i[a]),r==s[a]&&o==i[a]?r-o:s[a].localeCompare(i[a],"en");return s.length-i.length}};const Zi={name:"AutocompleteItem",props:{item:{type:Object,required:!0}},data:()=>({loading:!1}),computed:{shareType(){return i.ShareTypes.getByValue(this.item.value.shareType)},isUser(){return this.shareType===i.ShareTypes.user},isSpace(){return this.shareType===i.ShareTypes.space},isGuest(){return this.shareType===i.ShareTypes.guest},isGroup(){return this.shareType===i.ShareTypes.group},collaboratorClass(){return`files-collaborators-search-${this.shareType.key}`}}};var ea=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex oc-flex-middle oc-py-xs",class:e.collaboratorClass,attrs:{"data-testid":"recipient-autocomplete-item-"+e.item.label}},[e.isUser||e.isSpace?s("avatar-image",{staticClass:"oc-mr-s",attrs:{width:36,userid:e.item.value.shareWith,"user-name":e.item.label}}):e.isGuest?s("oc-icon",{key:"avatar-guest",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"global",size:"large","accessible-label":e.$gettext("Guest")}}):e.isGroup?s("oc-icon",{key:"avatar-group",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"group",size:"large","accessible-label":e.$gettext("Group")}}):s("oc-icon",{key:"avatar-generic-person",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"person",size:"large","accessible-label":e.$gettext("User")}}),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-user-text oc-text-truncate"},[s("span",{staticClass:"files-collaborators-autocomplete-username",domProps:{textContent:e._s(e.item.label)}}),e._v(" "),e.item.value.shareWithAdditionalInfo?s("span",{staticClass:"files-collaborators-autocomplete-additional-info",domProps:{textContent:e._s("("+e.item.value.shareWithAdditionalInfo+")")}}):e._e(),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-share-type",domProps:{textContent:e._s(e.$gettext(e.shareType.label))}})])],1)};ea._withStripped=!0;const ta=e.normalizeComponent({render:ea,staticRenderFns:[]},undefined,Zi,undefined,false,undefined,!1,void 0,void 0,void 0);const sa=e.defineComponent({name:"RoleItem",props:{role:{type:Object,required:!0},allowSharePermission:{type:Boolean,required:!0}}});var ia=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"roles-select-role-item",attrs:{id:"files-role-"+e.role.name}},[s("span",{staticClass:"oc-text-bold oc-display-block oc-width-1-1",domProps:{textContent:e._s(e.$gettext(e.role.label))}}),e._v(" "),s("span",{staticClass:"oc-m-rm oc-text-small oc-display-block",domProps:{textContent:e._s(e.$gettext(e.role.description(e.allowSharePermission)))}})])};ia._withStripped=!0;const aa=e.normalizeComponent({render:ia,staticRenderFns:[]},undefined,sa,"data-v-0fa28f37",false,undefined,!1,void 0,void 0,void 0);const ra=e.defineComponent({name:"RoleDropdown",components:{RoleItem:aa},props:{resource:{type:Object,required:!0},existingRole:{type:Object,required:!1,default:void 0},existingPermissions:{type:Array,required:!1,default:()=>[]},domSelector:{type:String,required:!1,default:void 0},allowSharePermission:{type:Boolean,required:!0}},data:()=>({selectedRole:null,customPermissions:[]}),computed:{...e.mapState("Files",["sharesTree"]),...e.mapGetters(["capabilities"]),roleButtonId(){return this.domSelector?`files-collaborators-role-button-${this.domSelector}-${e.v4()}`:"files-collaborators-role-button-new"},rolesListAriaLabel(){return this.$gettext("Select role for the invitation")},inviteLabel(){return this.selectedRole.hasCustomPermissions?this.$gettext("Invite with custom permissions"):this.$gettextInterpolate(this.$gettext("Invite as %{ name }"),{name:this.$gettext(this.selectedRole.inlineLabel)||""})},customPermissionsRole(){return i.PeopleShareRoles.custom(this.resource.isFolder)},resourceIsSharable(){return this.allowSharePermission&&this.resource.canShare()},share(){return this.sharesTree[""]?.find((e=>e.incoming))},allowCustomSharing(){return this.capabilities?.files_sharing?.allow_custom},availableRoles(){return this.resourceIsSpace?i.SpacePeopleShareRoles.list():this.share?.incoming&&this.resourceIsSharable?i.PeopleShareRoles.filterByBitmask(parseInt(this.share.permissions),this.resource.isFolder,this.allowSharePermission,!1!==this.allowCustomSharing):i.PeopleShareRoles.list(this.resource.isFolder,!1!==this.allowCustomSharing)},availablePermissions(){return this.share?.incoming&&this.resourceIsSharable?i.SharePermissions.bitmaskToPermissions(parseInt(this.share.permissions)):this.customPermissionsRole.permissions(this.allowSharePermission)},resourceIsSpace(){return"space"===this.resource.type}},created(){this.applyRoleAndPermissions()},beforeDestroy(){window.removeEventListener("keydown",this.cycleRoles)},mounted(){this.applyRoleAndPermissions(),window.addEventListener("keydown",this.cycleRoles)},methods:{applyRoleAndPermissions(){this.existingRole?this.selectedRole=this.existingRole:this.resourceIsSpace?this.selectedRole=i.SpacePeopleShareRoles.list()[0]:this.selectedRole=i.PeopleShareRoles.list(this.resource.isFolder)[0],this.selectedRole.hasCustomPermissions?this.customPermissions=this.existingPermissions:this.customPermissions=[...this.selectedRole.permissions(this.allowSharePermission)]},publishChange(){this.$emit("optionChange",{role:this.selectedRole,permissions:this.customPermissions})},selectRole(e){e.hasCustomPermissions?this.$refs.customPermissionsDrop.show():(this.selectedRole=e,this.customPermissions=e.permissions(this.allowSharePermission),this.publishChange())},isSelectedRole(e){return this.selectedRole.name===e.name},isPermissionDisabled:e=>e.bit===i.SharePermissions.read.bit,confirmCustomPermissions(){this.$refs.customPermissionsDrop.hide();const e=i.SharePermissions.permissionsToBitmask(this.customPermissions);this.selectedRole=i.PeopleShareRoles.getByBitmask(e,this.resource.isFolder,this.allowSharePermission),this.publishChange()},cancelCustomPermissions(){this.customPermissions=this.existingPermissions,this.$refs.customPermissionsDrop.hide(),this.$refs.rolesDrop.show()},cycleRoles(t){if(!e.get(this.$refs.rolesDrop,"tippy.state.isShown",!1))return;const{keyCode:s}=t,i=38===s,a=40===s;if(!i&&!a)return;const r=this.$refs.roleSelect||[];if(r.length<=1)return;const o=r.find((e=>e.$el===document.activeElement))||r.find((e=>e.$el.classList.contains("selected")))||r[0],n=r.indexOf(o),l=e=>r[e].$el.focus();i&&n-1<0?l(r.length-1):a&&n+1>=r.length?l(0):l(n+(i?-1:1))}}});var oa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.selectedRole?s("span",{staticClass:"oc-flex oc-flex-middle"},[1===e.availableRoles.length?s("span",[e.existingRole?s("span",[e._v(e._s(e.$gettext(e.selectedRole.label)))]):s("span",{domProps:{textContent:e._s(e.inviteLabel)}})]):s("oc-button",{staticClass:"files-recipient-role-select-btn",attrs:{id:e.roleButtonId,appearance:"raw","gap-size":"none"}},[e.existingRole?s("span",[e._v(e._s(e.$gettext(e.selectedRole.label)))]):s("span",{domProps:{textContent:e._s(e.inviteLabel)}}),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s"}})],1),e._v(" "),e.availableRoles.length>1?s("oc-drop",{ref:"rolesDrop",staticClass:"files-recipient-role-drop",attrs:{toggle:"#"+e.roleButtonId,mode:"click","padding-size":"small",offset:"0","close-on-click":""}},[s("oc-list",{staticClass:"files-recipient-role-drop-list",attrs:{"aria-label":e.rolesListAriaLabel}},e._l(e.availableRoles,(function(t){return s("li",{key:t.key},[s("oc-button",{ref:"roleSelect",refInFor:!0,staticClass:"files-recipient-role-drop-btn oc-p-s",class:{"oc-background-primary-gradient":e.isSelectedRole(t),selected:e.isSelectedRole(t)},attrs:{id:"files-recipient-role-drop-btn-"+t.name,appearance:"raw","justify-content":"space-between",variation:e.isSelectedRole(t)?"inverse":"passive"},on:{click:function(s){return e.selectRole(t)}}},[s("span",{staticClass:"oc-flex oc-flex-middle"},[s("oc-icon",{staticClass:"oc-pl-s oc-pr-m",attrs:{name:t.icon}}),e._v(" "),s("role-item",{attrs:{role:t,"allow-share-permission":e.allowSharePermission}})],1),e._v(" "),s("span",{staticClass:"oc-flex"},[e.isSelectedRole(t)?s("oc-icon",{attrs:{name:"check"}}):e._e()],1)])],1)})),0)],1):e._e(),e._v(" "),e.availableRoles.length>1?s("oc-drop",{ref:"customPermissionsDrop",staticClass:"files-recipient-custom-permissions-drop",attrs:{mode:"manual",target:"#"+e.roleButtonId,"padding-size":"remove"}},[s("h4",{staticClass:"oc-text-bold oc-m-rm oc-px-m oc-pt-m oc-pb-s",domProps:{textContent:e._s(e.$gettext(e.customPermissionsRole.label))}}),e._v(" "),s("oc-list",e._l(e.availablePermissions,(function(t){return s("li",{key:"files-collaborators-permission-"+t.key,staticClass:"oc-my-s oc-px-m"},[s("oc-checkbox",{key:"files-collaborators-permission-checkbox-"+t.key,staticClass:"oc-mr-xs files-collaborators-permission-checkbox",attrs:{id:"files-collaborators-permission-"+t.key,size:"large","data-testid":"files-collaborators-permission-"+t.key,label:e.$gettext(t.label),option:t,disabled:e.isPermissionDisabled(t)},model:{value:e.customPermissions,callback:function(t){e.customPermissions=t},expression:"customPermissions"}})],1)})),0),e._v(" "),s("div",{staticClass:"\n        files-recipient-custom-permissions-drop-cancel-confirm-btns\n        oc-px-m oc-py-s oc-mt-m oc-rounded-bottom\n      "},[s("oc-button",{attrs:{size:"small"},domProps:{textContent:e._s(e.$gettext("Cancel"))},on:{click:e.cancelCustomPermissions}}),s("oc-button",{staticClass:"oc-ml-s",attrs:{size:"small",variation:"primary",appearance:"filled"},domProps:{textContent:e._s(e.$gettext("Apply"))},on:{click:e.confirmCustomPermissions}})],1)],1):e._e()],1):e._e()};oa._withStripped=!0;const na=e.normalizeComponent({render:oa,staticRenderFns:[]},undefined,ra,"data-v-6fc419bb",false,undefined,!1,void 0,void 0,void 0);const la={props:{recipient:{type:Object,required:!0},deselect:{type:Function,required:!1,default:null}},setup(){const e=s.useStore();return{accessToken:s.useAccessToken({store:e})}},data(){return{formattedRecipient:{name:this.recipient.label,icon:this.getRecipientIcon(),hasAvatar:[i.ShareTypes.user.value,i.ShareTypes.space.value].includes(this.recipient.value.shareType),isLoadingAvatar:!0}}},computed:{...e.mapGetters(["configuration","capabilities"]),btnDeselectRecipientLabel(){const e=this.$gettext("Deselect %{name}");return this.$gettextInterpolate(e,{name:this.recipient.label})}},async created(){if(this.capabilities.files_sharing.user.profile_picture&&this.hasAvatar)try{this.formattedRecipient.avatar=await Zs({clientService:this.$clientService,server:this.configuration.server,username:this.recipient.value.shareWith,token:this.accessToken})}catch(e){console.error(e)}this.formattedRecipient.isLoadingAvatar=!1},methods:{getRecipientIcon(){switch(this.recipient.value.shareType){case i.ShareTypes.group.value:return{name:i.ShareTypes.group.icon,label:this.$gettext("Group")};case i.ShareTypes.guest.value:return{name:i.ShareTypes.guest.icon,label:this.$gettext("Guest user")};case i.ShareTypes.remote.value:return{name:i.ShareTypes.remote.icon,label:this.$gettext("Remote user")};default:return{name:i.ShareTypes.user.icon,label:this.$gettext("User")}}}}};var ca=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-recipient",{staticClass:"files-share-invite-recipient",attrs:{"data-testid":"recipient-container-"+e.formattedRecipient.name,recipient:e.formattedRecipient},scopedSlots:e._u([{key:"append",fn:function(){return[s("oc-button",{staticClass:"files-share-invite-recipient-btn-remove",attrs:{appearance:"raw","aria-label":e.btnDeselectRecipientLabel},on:{click:function(t){return t.stopPropagation(),e.deselect(e.recipient)}}},[s("oc-icon",{attrs:{name:"close",size:"small"}})],1)]},proxy:!0}])})};ca._withStripped=!0;const da=e.normalizeComponent({render:ca,staticRenderFns:[]},undefined,la,undefined,false,undefined,!1,void 0,void 0,void 0);const ha=e.defineComponent$1({name:"DateCurrentpicker",props:{shareTypes:{type:Array,required:!1,default:()=>[]}},setup(t,{emit:a}){const r=e.getCurrentInstance().proxy,o=e.computed((()=>r.$language)),n=s.useStore(),l=e.computed((()=>n.getters.capabilities)),c=e.computed((()=>l.value.files_sharing.user?.expire_date)),d=e.computed((()=>l.value.files_sharing.group?.expire_date)),h=e.computed((()=>c.value||d.value)),u=e.computed((()=>c.value?.enforced||d.value?.enforced)),p=e.DateTime_1.now().setLocale(o.value.current).toJSDate(),m=e.computed((()=>{const s=t.shareTypes.includes(i.ShareTypes.user.value),a=t.shareTypes.includes(i.ShareTypes.group.value),r=parseInt(c.value?.days),n=parseInt(d.value?.days);if(!c.value?.enabled&&!d.value?.enabled)return null;let l=0;return r&&s&&n&&a?l=Math.min(r,n):r&&s?l=r:n&&a&&(l=n),l?e.DateTime_1.now().setLocale(U(o.value.current)).plus({days:l}).toJSDate():null})),f=e.computed((()=>u.value?m.value:null)),g=e.customRef(((e,t)=>{let s=null;return{get:()=>(e(),s||m.value),set(e){s=e,t()}}})),b=e.computed((()=>q(e.DateTime_1.fromJSDate(g.value).endOf("day"),o.value.current)));return e.watch(g,(t=>{const s=e.DateTime_1.fromJSDate(t).setLocale(U(o.value.current)).endOf("day");a("optionChange",{expirationDate:s.isValid?s.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):null})})),e.watch(f,(e=>{!e||g.value<e||(g.value=e)})),{language:o,enforced:u,available:h,dateCurrent:g,dateMin:p,dateMax:f,dateExpire:b}}});var ua=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.available?s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-nowrap"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.dateMin,"max-date":e.dateMax,locale:e.language.current,"is-required":e.enforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw","gap-size":"none"},on:{click:i}},[e.dateCurrent?s("translate",{key:"set-expiration-date-label",attrs:{"translate-params":{expires:e.dateExpire}}},[e._v("\n          Expires %{expires}\n        ")]):s("translate",{key:"no-expiration-date-label"},[e._v("Set expiration date")]),e._v(" "),e.dateCurrent?e._e():s("oc-icon",{attrs:{name:"arrow-down-s"}})],1)]}}],null,!1,3138950553),model:{value:e.dateCurrent,callback:function(t){e.dateCurrent=t},expression:"dateCurrent"}}),e._v(" "),!e.enforced&&e.dateCurrent?s("oc-button",{staticClass:"recipient-edit-expiration-btn-remove",attrs:{appearance:"raw","aria-label":e.$gettext("Remove expiration date")},on:{click:function(t){e.dateCurrent=null}}},[s("oc-icon",{attrs:{name:"close"}})],1):e._e()],1):e._e()};ua._withStripped=!0;const pa=e.normalizeComponent({render:ua,staticRenderFns:[]},undefined,ha,"data-v-01d777c0",false,undefined,!1,void 0,void 0,void 0);const ma=e.defineComponent({name:"InviteCollaboratorForm",components:{AutocompleteItem:ta,RoleDropdown:na,RecipientContainer:da,ExpirationDatepicker:pa},props:{saveButtonLabel:{type:String,required:!1,default:()=>"Share"},inviteLabel:{type:String,required:!1,default:""}},setup:()=>({...s.useGraphClient(),hasResharing:s.useCapabilityFilesSharingResharing(),hasShareJail:s.useCapabilityShareJailEnabled()}),data:()=>({autocompleteResults:[],announcement:"",searchInProgress:!1,selectedCollaborators:[],selectedRole:null,customPermissions:null,saving:!1,expirationDate:null,searchQuery:""}),computed:{...e.mapGetters("Files",["currentFileOutgoingCollaborators","highlightedFile"]),...e.mapGetters(["configuration","user","capabilities"]),$_announcementWhenCollaboratorAdded(){return this.$gettext("Person was added")},$_isValid(){return this.selectedCollaborators.length>0},minSearchLength(){return parseInt(this.user.capabilities.files_sharing.search_min_length,10)},selectedCollaboratorsLabel(){return this.inviteLabel||this.$gettext("Invite")},resourceIsSpace(){return"space"===this.highlightedFile.type}},mounted(){this.fetchRecipients=e.debounce(this.fetchRecipients,500),this.selectedRole=this.resourceIsSpace?i.SpacePeopleShareRoles.list()[0]:i.PeopleShareRoles.list(this.highlightedFile.isFolder)[0]},methods:{...e.mapActions("Files",["addShare"]),async fetchRecipients(e){try{const t=await this.$client.shares.getRecipients(e,"folder",1,this.configuration?.options?.sharingRecipientsPerPage),s=t.exact.users.concat(t.users).filter((e=>e.value.shareWith!==this.user.id)).map((e=>{const t=this.resourceIsSpace?i.ShareTypes.space.value:e.value.shareType;return{...e,value:{...e.value,shareType:t}}}));let a=[];this.resourceIsSpace||(a=t.exact.groups.concat(t.groups));const r=t.exact.remotes.concat(t.remotes);this.autocompleteResults=s.concat(a,r).filter((e=>{const t=this.selectedCollaborators.find((t=>e.value.shareWith===t.value.shareWith&&parseInt(e.value.shareType,10)===parseInt(t.value.shareType,10))),s=this.currentFileOutgoingCollaborators.find((t=>e.value.shareWith===t.collaborator.name&&parseInt(e.value.shareType,10)===t.shareType));return!t&&!s&&(this.announcement=this.$_announcementWhenCollaboratorAdded,!0)}))}catch(e){console.error(e)}this.searchInProgress=!1},onSearch(e){this.autocompleteResults=[],this.searchQuery=e,e.length<this.minSearchLength?this.searchInProgress=!1:(this.searchInProgress=!0,this.fetchRecipients(e))},filterRecipients:(e,t)=>e.length<1?[]:(t=t.split(":")[1]||t,e.filter((e=>e.value.shareType===i.ShareTypes.remote.value||e.label.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||e.value.shareWith.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||(e.value.shareWithAdditionalInfo||"").toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1))),collaboratorRoleChanged({role:e,permissions:t}){this.selectedRole=e,this.customPermissions=t},collaboratorExpiryChanged({expirationDate:e}){this.expirationDate=e},async share(){this.saving=!0;const t=new e._default({concurrency:4}),s=[];this.selectedCollaborators.forEach((e=>{s.push(t.add((()=>{const t=this.selectedRole.hasCustomPermissions?i.SharePermissions.permissionsToBitmask(this.customPermissions):i.SharePermissions.permissionsToBitmask(this.selectedRole.permissions(this.hasResharing||this.resourceIsSpace));let s=this.highlightedFile.path;this.hasShareJail&&"/"===s&&(s=`/${this.highlightedFile.name}`),this.addShare({client:this.$client,graphClient:this.graphClient,path:s,$gettext:this.$gettext,shareWith:e.value.shareWith,displayName:e.label,shareType:e.value.shareType,permissions:t,role:this.selectedRole,expirationDate:this.expirationDate,storageId:this.highlightedFile.fileId||this.highlightedFile.id})})))})),await Promise.all(s),this.selectedCollaborators=[],this.saving=!1},resetFocusOnInvite(){this.autocompleteResults=[],this.$nextTick((()=>{document.getElementById("files-share-invite-input").focus()}))}}});var fa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"new-collaborators-form","data-testid":"new-collaborators-form"}},[s("oc-select",{ref:"ocSharingAutocomplete",attrs:{id:"files-share-invite-input",options:e.autocompleteResults,loading:e.searchInProgress,multiple:!0,filter:e.filterRecipients,label:e.selectedCollaboratorsLabel,"aria-describedby":"files-share-invite-hint","dropdown-should-open":function(t){var s=t.open,i=t.search;return s&&i.length>=e.minSearchLength&&!e.searchInProgress}},on:{"search:input":e.onSearch,input:e.resetFocusOnInvite},scopedSlots:e._u([{key:"option",fn:function(e){return[s("autocomplete-item",{attrs:{item:e}})]}},{key:"no-options",fn:function(){return[e.resourceIsSpace?s("translate",[e._v(" No users found. ")]):s("translate",[e._v(" No users or groups found. ")])]},proxy:!0},{key:"selected-option-container",fn:function(e){var t=e.option,i=e.deselect;return[s("recipient-container",{key:t.value.shareWith,attrs:{recipient:t,deselect:i}})]}},{key:"open-indicator",fn:function(){return[s("span")]},proxy:!0}]),model:{value:e.selectedCollaborators,callback:function(t){e.selectedCollaborators=t},expression:"selectedCollaborators"}}),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-mb-l oc-mt-s"},[s("role-dropdown",{attrs:{resource:e.highlightedFile,"allow-share-permission":e.hasResharing||e.resourceIsSpace},on:{optionChange:e.collaboratorRoleChanged}}),e._v(" "),s("expiration-datepicker",{attrs:{"share-types":e.selectedCollaborators.map((function(e){return e.value.shareType}))},on:{optionChange:e.collaboratorExpiryChanged}}),e._v(" "),e.saving?s("oc-button",{key:"new-collaborator-saving-button",attrs:{disabled:!0}},[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Creating share"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"aria-hidden":!0},domProps:{textContent:e._s(e.saveButtonLabel)}})],1):s("oc-button",{key:"new-collaborator-save-button",attrs:{id:"new-collaborators-form-create-button","data-testid":"new-collaborators-form-create-button",disabled:!e.$_isValid,variation:"primary",appearance:"filled",submit:"submit"},domProps:{textContent:e._s(e.$gettext(e.saveButtonLabel))},on:{click:e.share}})],1),e._v(" "),s("oc-hidden-announcer",{attrs:{level:"assertive",announcement:e.announcement}})],1)};fa._withStripped=!0;const ga=e.normalizeComponent({render:fa,staticRenderFns:[]},undefined,ma,undefined,false,undefined,!1,void 0,void 0,void 0);const ba={name:"EditDropdown",props:{expirationDate:{type:Date,required:!1,default:void 0},shareCategory:{type:String,required:!1,default:null,validator:function(e){return["user","group"].includes(e)||!e}},canEditOrDelete:{type:Boolean,required:!0}},data:function(){return{enteredExpirationDate:null}},computed:{...e.mapGetters(["capabilities"]),options(){const e=[];return this.isRemoveExpirationPossible&&e.push({title:this.$gettext("Remove expiration date"),method:this.removeExpirationDate,class:"remove-expiration-date",enabled:this.canEditOrDelete,icon:"calendar",additionalAttributes:{"data-testid":"collaborator-remove-expiration-btn"}}),[...e,{title:this.$gettext("Remove share"),method:this.removeShare,class:"remove-share",enabled:this.canEditOrDelete,icon:"delete-bin-5",additionalAttributes:{"data-testid":"collaborator-remove-share-btn"}},{title:this.$gettext("Access details"),method:this.showAccessDetails,enabled:!0,icon:"information",class:"show-access-details"}]},editShareBtnId(){return"files-collaborators-edit-button-"+this._uid},shareEditOptions(){return this.$gettext("Context menu of the share")},editingUser(){return"user"===this.shareCategory},editingGroup(){return"group"===this.shareCategory},isExpirationSupported(){return this.editingUser&&this.userExpirationDate||this.editingGroup&&this.groupExpirationDate},isExpirationDateSet(){return!!this.expirationDate},isRemoveExpirationPossible(){return this.isExpirationSupported&&this.isExpirationDateSet&&!this.isExpirationDateEnforced},isDefaultExpirationEnabled(){return this.editingUser?this.userExpirationDate.enabled:this.editingGroup?this.groupExpirationDate.enabled:this.userExpirationDate.enabled||this.groupExpirationDate.enabled},userExpirationDate(){return this.capabilities.files_sharing.user.expire_date},groupExpirationDate(){return this.capabilities.files_sharing.group?.expire_date},defaultExpirationDate(){if(!this.isDefaultExpirationEnabled)return null;const e=parseInt(this.userExpirationDate.days),t=parseInt(this.groupExpirationDate.days);let s=0;s=this.editingUser?e:this.editingGroup?t:e&&t?Math.min(e,t):e||t;const i=new Date;return i.setDate((new Date).getDate()+s),i},isExpirationDateEnforced(){return this.editingUser?this.userExpirationDate.enforced:this.editingGroup?this.groupExpirationDate.enforced:this.userExpirationDate.enforced||this.groupExpirationDate.enforced},maxExpirationDate(){return this.isExpirationDateEnforced?this.defaultExpirationDate:null},minExpirationDate(){const e=new Date;return e.setDate((new Date).getDate()+1),e},relativeExpirationDate(){return q(e.DateTime_1.fromJSDate(this.enteredExpirationDate).endOf("day"),this.$language.current)}},watch:{enteredExpirationDate:{handler:"updateExpirationDate"}},methods:{updateExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:e.DateTime_1.fromJSDate(this.enteredExpirationDate).endOf("day").toISO()}),this.$refs.expirationDateDrop.hide()},removeExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:null}),this.$refs.expirationDateDrop.hide()},removeShare(){this.$emit("removeShare")},showAccessDetails(){this.$emit("showAccessDetails")}}};var va=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"oc-flex oc-flex-middle"},[s("oc-button",{staticClass:"collaborator-edit-dropdown-options-btn",attrs:{id:e.editShareBtnId,appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{ref:"expirationDateDrop",attrs:{toggle:"#"+e.editShareBtnId,mode:"click","padding-size":"small"}},[s("oc-list",{staticClass:"collaborator-edit-dropdown-options-list",attrs:{"aria-label":e.shareEditOptions}},[e.isExpirationSupported?s("li",{staticClass:"oc-rounded oc-menu-item-hover"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.minExpirationDate,"max-date":e.maxExpirationDate,locale:e.$language.current,"is-required":e.isExpirationDateEnforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button oc-p-s action-menu-item",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw"},on:{click:i}},[s("oc-icon",{attrs:{name:"calendar-event","fill-type":"line",size:"medium",variation:"passive"}}),e._v(" "),e.isExpirationDateSet?s("span",{domProps:{textContent:e._s(e.$gettext("Edit expiration date"))}}):s("span",{domProps:{textContent:e._s(e.$gettext("Set expiration date"))}})],1)]}}],null,!1,2455376250),model:{value:e.enteredExpirationDate,callback:function(t){e.enteredExpirationDate=t},expression:"enteredExpirationDate"}})],1):e._e(),e._v(" "),e._l(e.options,(function(t,i){return s("li",{key:i,staticClass:"oc-rounded oc-menu-item-hover"},[t.enabled?s("oc-button",e._b({staticClass:"oc-p-s action-menu-item",class:t.class,attrs:{appearance:"raw"},on:{click:function(e){return t.method()}}},"oc-button",t.additionalAttributes||{},!1),[s("oc-icon",{attrs:{name:t.icon,"fill-type":"line",size:"medium",variation:"passive"}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.title)}})],1):e._e()],1)}))],2)],1)],1)};va._withStripped=!0;const _a=e.normalizeComponent({render:va,staticRenderFns:[]},undefined,ba,undefined,false,undefined,!1,void 0,void 0,void 0);const Sa=e.defineComponent$1({name:"ListItem",components:{EditDropdown:_a,RoleDropdown:na},props:{share:{type:Object,required:!0},modifiable:{type:Boolean,default:!1},sharedParentRoute:{type:Object,default:null}},setup:()=>({...s.useGraphClient(),hasResharing:s.useCapabilityFilesSharingResharing()}),computed:{...e.mapGetters("Files",["highlightedFile"]),...e.mapState(["user"]),shareType(){return i.ShareTypes.getByValue(this.share.shareType)},shareTypeIcon(){return this.shareType.icon},shareTypeKey(){return this.shareType.key},shareDomSelector(){if(this.share.id)return i.extractDomSelector(this.share.id)},isGroup(){return this.shareType===i.ShareTypes.group},isUser(){return this.shareType===i.ShareTypes.user},isSpace(){return this.shareType===i.ShareTypes.space},shareTypeText(){return this.$gettext(this.shareType.label)},shareCategory(){return i.ShareTypes.isIndividual(this.shareType)?"user":"group"},shareDisplayName(){return this.user.id===this.share.collaborator.name?this.$gettextInterpolate(this.$gettext("%{collaboratorName} (me)"),{collaboratorName:this.share.collaborator.displayName}):this.share.collaborator.displayName},shareAdditionalInfo(){return this.share.collaborator.additionalInfo},shareDisplayNameTooltip(){return this.shareDisplayName+(this.shareAdditionalInfo?`(${this.shareAdditionalInfo})`:"")},screenreaderShareDisplayName(){const e={displayName:this.share.collaborator.displayName,...this.share.collaborator.additionalInfo&&{additionalInfo:this.share.collaborator.additionalInfo}};let t=this.$gettext("Share receiver name: %{ displayName }");return this.shareAdditionalInfo&&(t=this.$gettext("Share receiver name: %{ displayName } (%{ additionalInfo })")),this.$gettextInterpolate(t,e)},shareExpirationText(){const e=this.$gettext("Expires %{ expiryDateRelative }");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative})},screenreaderShareExpiration(){const e=this.$gettext("Share expires %{ expiryDateRelative } (%{ expiryDate })");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative,expiryDate:this.expirationDate})},canEditOrDelete(){return this.modifiable},hasExpirationDate(){return this.share.expires},expirationDate(){return z(e.DateTime_1.fromJSDate(this.share.expires).endOf("day"),this.$language.current)},expirationDateRelative(){return q(e.DateTime_1.fromJSDate(this.share.expires).endOf("day"),this.$language.current)},sharedParentDir(){return this.sharedParentRoute?.params?.item.split("/").pop()},shareDetailsHelperContent(){return{text:this.$gettext("Invite persons or groups to access this file or folder.")}},editDropDownToggleId:()=>e.v4(),shareDate(){return z(e.DateTime_1.fromSeconds(parseInt(this.share.stime)),this.$language.current)},shareOwnerDisplayName(){return this.share.owner.displayName},shareOwnerAdditionalInfo(){return this.share.owner.additionalInfo},accessDetailsPropsSpace(){const e=[];return e.push({text:this.$gettext("Name"),headline:!0},{text:this.shareDisplayName}),this.shareAdditionalInfo&&e.push({text:this.$gettext("Additional info"),headline:!0},{text:this.shareAdditionalInfo}),e.push({text:this.$gettext("Type"),headline:!0},{text:this.shareTypeText}),{title:this.$gettext("Access details"),list:e}},accessDetailsProps(){const e=[];return e.push({text:this.$gettext("Name"),headline:!0},{text:this.shareDisplayName}),this.shareAdditionalInfo&&e.push({text:this.$gettext("Additional info"),headline:!0},{text:this.shareAdditionalInfo}),e.push({text:this.$gettext("Type"),headline:!0},{text:this.shareTypeText}),e.push({text:this.$gettext("Access expires"),headline:!0},{text:this.hasExpirationDate?this.expirationDate:this.$gettext("no")}),e.push({text:this.$gettext("Shared on"),headline:!0},{text:this.shareDate}),e.push({text:this.$gettext("Invited by"),headline:!0},{text:this.shareOwnerAdditionalInfo?`${this.shareOwnerDisplayName} (${this.shareOwnerAdditionalInfo})`:this.shareOwnerDisplayName}),{title:this.$gettext("Access details"),list:e}}},methods:{...e.mapActions(["showMessage"]),...e.mapActions("Files",["changeShare"]),removeShare(){this.$emit("onDelete",this.share)},showAccessDetails(){this.$refs.accessDetailsDrop.$refs.drop.show()},shareRoleChanged({role:e,permissions:t}){const s=this.share.expires;try{this.saveShareChanges({role:e,permissions:t,expirationDate:s})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply new permissions"),status:"danger"})}},shareExpirationChanged({expirationDate:e}){const t=this.share.role,s=this.share.customPermissions;try{this.saveShareChanges({role:t,permissions:s,expirationDate:e})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply expiration date"),status:"danger"})}},saveShareChanges({role:e,permissions:t,expirationDate:s}){const a=e.hasCustomPermissions?i.SharePermissions.permissionsToBitmask(t):i.SharePermissions.permissionsToBitmask(e.permissions(this.hasResharing||this.shareType===i.ShareTypes.space));this.changeShare({client:this.$client,graphClient:this.graphClient,share:this.share,permissions:a,expirationDate:s||"",role:e})}}});var xa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-collaborators-collaborator oc-py-xs",attrs:{"data-testid":"collaborator-"+(e.isUser||e.isSpace?"user":"group")+"-item-"+e.share.collaborator.name}},[s("div",{staticClass:"oc-width-1-1 oc-flex oc-flex-middle files-collaborators-collaborator-details"},[s("div",{staticClass:"oc-width-2-3 oc-flex oc-flex-middle"},[s("div",[e.isUser||e.isSpace?s("avatar-image",{staticClass:"files-collaborators-collaborator-indicator",attrs:{userid:e.share.collaborator.name,"user-name":e.share.collaborator.displayName,width:36}}):s("oc-avatar-item",{staticClass:"files-collaborators-collaborator-indicator",attrs:{width:36,"icon-size":"medium",icon:e.shareTypeIcon,name:e.shareTypeKey}})],1),e._v(" "),s("div",{staticClass:"oc-pl-s oc-text-truncate"},[s("div",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.shareDisplayNameTooltip,expression:"shareDisplayNameTooltip"}],staticClass:"oc-text-truncate"},[s("span",{staticClass:"files-collaborators-collaborator-name",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareDisplayName)}}),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareDisplayName)}})]),e._v(" "),s("div",[e.canEditOrDelete?s("div",{staticClass:"oc-flex oc-flex-nowrap oc-flex-middle"},[s("role-dropdown",{staticClass:"files-collaborators-collaborator-role",attrs:{resource:e.highlightedFile,"dom-selector":e.shareDomSelector,"existing-permissions":e.share.customPermissions,"existing-role":e.share.role,"allow-share-permission":e.hasResharing||e.isSpace},on:{optionChange:e.shareRoleChanged}})],1):e.share.role?s("div",[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext(e.share.role.description(!1)),expression:"$gettext(share.role.description(false))"}],staticClass:"oc-mr-xs",domProps:{textContent:e._s(e.$gettext(e.share.role.label))}})]):e._e()])])]),e._v(" "),s("div",{staticClass:"oc-flex flex-en oc-flex-middle oc-width-1-3",staticStyle:{"justify-content":"end"}},[e.sharedParentRoute?s("div",{staticClass:"oc-resource-indicators oc-text-truncate"},[s("router-link",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Navigate to parent folder"),expression:"$gettext('Navigate to parent folder')"}],staticClass:"parent-folder oc-text-truncate",attrs:{to:e.sharedParentRoute}},[s("span",{staticClass:"text",domProps:{textContent:e._s(e.$gettext("via"))}}),e._v(" "),s("oc-icon",{staticClass:"oc-px-xs",attrs:{name:"folder-2",size:"small","fill-type":"line"}}),e._v(" "),s("span",{staticClass:"text oc-text-truncate",domProps:{textContent:e._s(e.sharedParentDir)}})],1)],1):e._e(),e._v(" "),e.hasExpirationDate?s("span",[s("oc-icon",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDate,expression:"expirationDate"}],staticClass:"files-collaborators-collaborator-expiration",attrs:{"data-testid":"recipient-info-expiration-date","aria-label":e.expirationDate,name:"calendar","fill-type":"line"}}),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareExpiration)}})],1):e._e(),e._v(" "),s("edit-dropdown",{staticClass:"files-collaborators-collaborator-edit",attrs:{id:"edit-drop-down-"+e.editDropDownToggleId,"data-testid":"collaborator-edit","expiration-date":e.share.expires?e.share.expires:null,"share-category":e.shareCategory,"can-edit-or-delete":e.canEditOrDelete},on:{expirationDateChanged:e.shareExpirationChanged,removeShare:e.removeShare,showAccessDetails:e.showAccessDetails}}),e._v(" "),s("oc-info-drop",e._b({ref:"accessDetailsDrop",staticClass:"share-access-details-drop",attrs:{mode:"manual",target:"#edit-drop-down-"+e.editDropDownToggleId}},"oc-info-drop",e.isSpace?e.accessDetailsPropsSpace:e.accessDetailsProps,!1))],1)])])};xa._withStripped=!0;const wa=e.normalizeComponent({render:xa,staticRenderFns:[]},undefined,Sa,"data-v-5b222926",false,undefined,!1,void 0,void 0,void 0);const ya={name:"FileShares",components:{InviteCollaboratorForm:ga,CollaboratorListItem:wa},setup(){const t=s.useStore(),i=e.ref(null),a=e.ref([]),r=s.useRouteParam("storageId");e.watch(r,(e=>{i.value=t.state.runtime.spaces?.spaces?.find((t=>t.id===e))}),{immediate:!0});const o=e.computed((()=>"project"===e.unref(i)?.driveType)),{graphClient:n}=s.useGraphClient({store:t}),l=e.q((function*(t,r){const o=[],l=[];for(const t of Object.keys(e.unref(i).spaceRoles))for(const a of e.unref(i).spaceRoles[t])o.push(e.unref(n).users.getUser(a).then((a=>{l.push(s.buildSpaceShare({...a.data,role:t},e.unref(i).id))})));yield Promise.all(o).then((()=>{a.value=ti(l)}))})),c=!t.getters.configuration.options.sidebar.shares.showAllOnLoad;return{currentStorageId:r,currentSpace:i,spaceMembers:a,isCurrentSpaceTypeProject:o,loadSpaceMembersTask:l,sharesListCollapsed:c,hasProjectSpaces:s.useCapabilityProjectSpacesEnabled(),hasShareJail:s.useCapabilityShareJailEnabled(),hasResharing:s.useCapabilityFilesSharingResharing()}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators"]),...e.mapGetters(["configuration"]),...e.mapState("Files",["incomingShares","sharesTree"]),...e.mapState(["user"]),inviteCollaboratorHelp(){if(!!this.configuration?.options?.cernFeatures){const e=Ai;return e.list=[...Pi.list,...Ai.list],e}return Ai},helpersEnabled(){return this.configuration?.options?.contextHelpers},sharedWithLabel(){return this.$gettext("Shared with")},spaceMemberLabel(){return this.$gettext("Space members")},collapseButtonTitle(){return this.sharesListCollapsed?this.$gettext("Show more"):this.$gettext("Show less")},hasSharees(){return this.collaborators.length>0},$_allIncomingShares(){const e=[...this.incomingShares],t=s.getParentPaths(this.highlightedFile.path,!0);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.incoming&&e.push(t)}))})),e)},collaborators(){return[...this.currentFileOutgoingCollaborators,...this.indirectOutgoingShares].sort(this.collaboratorsComparator).map((e=>(e.key="collaborator-"+e.id,e.owner.name!==e.fileOwner.name&&e.owner.name!==this.user.id&&(e.resharers=[e.owner]),e)))},displayCollaborators(){return this.collaborators.length>3&&this.sharesListCollapsed?this.collaborators.slice(0,3):this.collaborators},displaySpaceMembers(){return this.spaceMembers.length>3&&this.sharesListCollapsed?this.spaceMembers.slice(0,3):this.spaceMembers},showShareToggle(){return this.spaceMembers.length>3||this.collaborators.length>3},indirectOutgoingShares(){const e=[],t=s.getParentPaths(this.highlightedFile.path,!1);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.outgoing&&this.$_isCollaboratorShare(t)&&(t.key="indirect-collaborator-"+t.id,e.push(t))}))})),e)},currentUserCanShare(){if(this.highlightedFile.isReceivedShare()&&!this.hasResharing)return!1;return!(s.isLocationSpacesActive(this.$router,"files-spaces-share")&&!this.hasResharing)&&this.highlightedFile.canShare({user:this.user})},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},currentUsersPermissions(){if(this.$_allIncomingShares.length>0){let e=0;for(const t of this.$_allIncomingShares)e|=t.permissions;return e}return null},currentUserIsMemberOfSpace(){return this.currentSpace?.spaceMemberIds?.includes(this.user.uuid)},showSpaceMembers(){return this.currentSpace&&this.isCurrentSpaceTypeProject&&"space"!==this.highlightedFile.type&&this.currentUserIsMemberOfSpace}},mounted(){this.showSpaceMembers&&this.loadSpaceMembersTask.perform()},methods:{...e.mapActions("Files",["deleteShare"]),...e.mapActions(["createModal","hideModal","showMessage"]),toggleShareesListCollapsed(){this.sharesListCollapsed=!this.sharesListCollapsed},$_isCollaboratorShare:e=>i.ShareTypes.containsAnyValue(i.ShareTypes.authenticated,[e.shareType]),collaboratorsComparator(e,t){const s=e.collaborator?e.collaborator.displayName:e.displayName,a=t.collaborator?t.collaborator.displayName:t.displayName,r=s.toLowerCase().trim(),o=a.toLowerCase().trim(),n=i.ShareTypes.containsAnyValue(i.ShareTypes.individuals,[e.shareType]),l=i.ShareTypes.containsAnyValue(i.ShareTypes.individuals,[t.shareType]),c=!e.indirect,d=!t.indirect;return n===l?c===d?r===o?Xi.naturalSortCompare(e.stime+"",t.stime+""):Xi.naturalSortCompare(r,o):c?-1:1:n?-1:1},$_ocCollaborators_deleteShare_trigger(e){const t={variation:"danger",icon:"alarm-warning",title:this.$gettext("Remove share"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Remove"),message:this.$gettext("Are you sure you want to remove this share?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_ocCollaborators_deleteShare(e)};this.createModal(t)},$_ocCollaborators_deleteShare(e){let t=this.highlightedFile.path;this.hasShareJail&&"/"===t&&(t=`/${this.highlightedFile.name}`),this.deleteShare({client:this.$client,share:e,path:t,storageId:this.highlightedFile.fileId}).then((()=>{this.hideModal(),this.showMessage({title:this.$gettext("Share was removed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to remove share"),status:"danger"})}))},getSharedParentRoute(e){return e.indirect&&this.sharesTree[e.path]?s.isLocationSpacesActive(this.$router,"files-spaces-project")?s.createLocationSpaces("files-spaces-project",{params:{storageId:this.currentStorageId,item:e.path}}):s.createLocationSpaces("files-spaces-personal",{params:{storageId:this.currentStorageId,item:e.path}}):null},isShareModifiable(e){return!(this.currentUserIsMemberOfSpace&&!this.currentSpace?.spaceRoles.manager.includes(this.user.uuid))&&!e.indirect}}};var Ca=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-sharing-sidebar"}},[s("div",{staticClass:"oc-flex"},[s("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-bold oc-text-medium oc-m-rm"},[e._v("Share with people")]),e._v(" "),e.helpersEnabled?s("oc-contextual-helper",e._b({staticClass:"oc-pl-xs"},"oc-contextual-helper",e.inviteCollaboratorHelp,!1)):e._e()],1),e._v(" "),e.currentUserCanShare?s("invite-collaborator-form",{key:"new-collaborator",staticClass:"oc-my-s"}):s("p",{key:"no-reshare-permissions-message",attrs:{"data-testid":"files-collaborators-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),e.hasSharees?s("div",{staticClass:"avatars-wrapper oc-flex oc-flex-middle oc-flex-between"},[s("h4",{staticClass:"oc-text-bold oc-my-rm",domProps:{textContent:e._s(e.sharedWithLabel)}})]):e._e(),e._v(" "),e.hasSharees?[s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden",class:{"oc-mb-l":e.showSpaceMembers,"oc-m-rm":!e.showSpaceMembers},attrs:{id:"files-collaborators-list","aria-label":e.$gettext("Share receivers")}},e._l(e.displayCollaborators,(function(t){return s("li",{key:t.key},[s("collaborator-list-item",{attrs:{share:t,modifiable:e.isShareModifiable(t),"shared-parent-route":e.getSharedParentRoute(t)},on:{onDelete:e.$_ocCollaborators_deleteShare_trigger}})],1)})),0),e._v(" "),e.showShareToggle?s("div",{staticClass:"oc-flex oc-flex-center"},[s("oc-button",{attrs:{appearance:"raw"},domProps:{textContent:e._s(e.collapseButtonTitle)},on:{click:e.toggleShareesListCollapsed}})],1):e._e()]:e._e(),e._v(" "),e.showSpaceMembers?[s("h4",{staticClass:"oc-text-bold oc-my-s",domProps:{textContent:e._s(e.spaceMemberLabel)}}),e._v(" "),s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden oc-m-rm",attrs:{id:"space-collaborators-list","aria-label":e.spaceMemberLabel}},e._l(e.displaySpaceMembers,(function(e){return s("li",{key:e.key},[s("collaborator-list-item",{attrs:{share:e,modifiable:!1}})],1)})),0),e._v(" "),e.showShareToggle?s("div",{staticClass:"oc-flex oc-flex-center"},[s("oc-button",{attrs:{appearance:"raw"},domProps:{textContent:e._s(e.collapseButtonTitle)},on:{click:e.toggleShareesListCollapsed}})],1):e._e()]:e._e()],2)};Ca._withStripped=!0;const $a=e.normalizeComponent({render:Ca,staticRenderFns:[]},undefined,ya,undefined,false,undefined,!1,void 0,void 0,void 0);const Ea=e.defineComponent$1({name:"SpaceMembers",components:{CollaboratorListItem:wa,InviteCollaboratorForm:ga},inject:["displayedItem"],setup(){const{graphClient:e}=s.useGraphClient();return{graphClient:e}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators"]),...e.mapGetters(["configuration"]),...e.mapState(["user"]),helpersEnabled(){return this.configuration?.options?.contextHelpers},spaceAddMemberHelp:()=>Mi,space(){return this.displayedItem.value},members(){return this.currentFileOutgoingCollaborators.filter((e=>e.shareType===i.ShareTypes.space.value))},hasCollaborators(){return this.members.length>0},currentUserCanShare(){return this.currentUserIsManager},currentUserIsManager(){return this.members.find((e=>e.collaborator.name===this.user.id))?.role?.name===i.spaceRoleManager.name}},methods:{...e.mapActions("Files",["deleteShare"]),...e.mapActions(["createModal","hideModal","showMessage"]),isModifiable(e){if(!this.currentUserIsManager)return!1;if(e.role.name!==i.spaceRoleManager.name)return!0;return this.members.filter((e=>e.role.name===i.spaceRoleManager.name)).length>1},$_ocCollaborators_deleteShare_trigger(e){const t={variation:"danger",icon:"alarm-warning",title:this.$gettext("Remove share"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Remove"),message:this.$gettext("Are you sure you want to remove this share?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_ocCollaborators_deleteShare(e)};this.createModal(t)},async $_ocCollaborators_deleteShare(e){try{if(await this.deleteShare({client:this.$client,graphClient:this.graphClient,share:e,path:this.highlightedFile.path,reloadResource:!1}),this.showMessage({title:this.$gettext("Share was removed successfully")}),e.collaborator.name===this.user.id)return s.isLocationSpacesActive(this.$router,"files-spaces-projects")?this.$router.go():this.$router.push(s.createLocationSpaces("files-spaces-projects"))}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to remove share"),status:"danger"})}finally{this.hideModal()}}}});var Ra=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-sharing-sidebar"}},[s("div",{staticClass:"oc-flex"},[s("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-bold oc-text-medium oc-m-rm"},[e._v("Members")]),e._v(" "),e.helpersEnabled?s("oc-contextual-helper",e._b({staticClass:"oc-pl-xs"},"oc-contextual-helper",e.spaceAddMemberHelp,!1)):e._e()],1),e._v(" "),e.currentUserCanShare?s("invite-collaborator-form",{key:"new-collaborator",staticClass:"oc-my-s",attrs:{"save-button-label":e.$gettext("Add"),"invite-label":e.$gettext("Add members")}}):e._e(),e._v(" "),e.hasCollaborators?[s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden oc-m-rm",attrs:{id:"files-collaborators-list","aria-label":e.$gettext("Space members")}},e._l(e.members,(function(t){return s("li",{key:t.key},[s("collaborator-list-item",{attrs:{share:t,modifiable:e.isModifiable(t)},on:{onDelete:function(s){return e.$_ocCollaborators_deleteShare_trigger(t)}}})],1)})),0)]:e._e()],2)};Ra._withStripped=!0;const ka=e.normalizeComponent({render:Ra,staticRenderFns:[]},undefined,Ea,undefined,false,undefined,!1,void 0,void 0,void 0);const Ia=e.defineComponent$1({name:"SharesPanel",components:{FileLinks:Yi,FileShares:$a,SpaceMembers:ka},inject:["activePanel"],props:{showSpaceMembers:{type:Boolean,default:!1},showLinks:{type:Boolean,default:!1}},setup(){const t=s.useStore(),i=e.computed((()=>t.getters["Files/currentFileOutgoingSharesLoading"])),a=e.computed((()=>t.state.Files.incomingSharesLoading)),r=e.computed((()=>t.state.Files.sharesTreeLoading)),o=((t,s,i)=>{const a=e.ref(t);return e.customRef(((t,r)=>({get:()=>(t(),a.value),set:e.debounce((e=>{a.value=e,r()}),s,i)})))})(!0,250);e.watch([i,a,r],(()=>{o.value=i.value||a.value||r.value}));const{graphClient:n}=s.useGraphClient(),l=e.q((function*(e,t){yield t.loadCurrentFileOutgoingShares({client:t.$client,graphClient:n,path:t.space.id,storageId:t.space.id,resource:t.space})}));return{graphClient:n,loadSpaceMembersTask:l,sharesLoading:o}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingSharesLoading"]),...e.mapState("Files",["incomingSharesLoading","sharesTreeLoading"])},watch:{sharesLoading:{handler:function(){!this.loading&&e.unref(this.activePanel)&&this.$nextTick((()=>{const[t,s]=e.unref(this.activePanel).split("#");s&&this.$refs[s]&&this.$emit("scrollToElement",{element:this.$refs[s].$el,panelName:t})}))}},highlightedFile:{handler:function(e,t){t!==e&&(this.$_reloadShares(),this.showSpaceMembers&&this.loadSpaceMembersTask.perform(this))},immediate:!0}},methods:{...e.mapActions("Files",["loadCurrentFileOutgoingShares","loadSharesTree","loadIncomingShares"]),$_reloadShares(){this.loadCurrentFileOutgoingShares({client:this.$client,graphClient:this.graphClient,path:this.highlightedFile.path,$gettext:this.$gettext,storageId:this.highlightedFile.fileId,resource:this.highlightedFile}),this.loadIncomingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext,storageId:this.highlightedFile.fileId}),this.loadSharesTree({client:this.$client,path:""===this.highlightedFile.path?"/":e.dirname(this.highlightedFile.path),$gettext:this.$gettext,storageId:this.highlightedFile.fileId})}}});var Fa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.sharesLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading list of shares")}}):[e.showSpaceMembers?s("space-members",{ref:"peopleShares",staticClass:"oc-background-highlight oc-p-m oc-mb-s"}):s("file-shares",{ref:"peopleShares",staticClass:"oc-background-highlight oc-p-m oc-mb-s"}),e._v(" "),e.showLinks?s("file-links",{ref:"linkShares",staticClass:"oc-background-highlight oc-p-m"}):e._e()]],2)};Fa._withStripped=!0;const Ta=e.normalizeComponent({render:Fa,staticRenderFns:[]},undefined,Ia,undefined,false,undefined,!1,void 0,void 0,void 0);const La=e.defineComponent$1({name:"NoSelection",computed:{selectedFilesString(){return this.$gettext("Select a file or folder to view details.")}}});var Da=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-center oc-mt-xl",attrs:{id:"oc-no-selection"}},[s("oc-icon",{attrs:{size:"xxlarge",name:"drag-drop","fill-type":"line"}}),e._v(" "),s("p",{attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)};Da._withStripped=!0;const Aa=e.normalizeComponent({render:Da,staticRenderFns:[]},undefined,La,undefined,false,undefined,!1,void 0,void 0,void 0);const Pa=e.defineComponent$1({name:"SpaceActions",components:{ActionMenuItem:fe,QuotaModal:gs,ReadmeContentModal:_s},mixins:[xs,Ss,Es,Cs,Fs,Rs,ws,Is,$s],computed:{...e.mapGetters("Files",["highlightedFile"]),resources(){return[this.highlightedFile]},actions(){return[...this.$_rename_items,...this.$_editDescription_items,...this.$_uploadImage_items,...this.$_editReadmeContent_items,...this.$_editQuota_items,...this.$_deletedFiles_items,...this.$_restore_items,...this.$_delete_items,...this.$_disable_items].filter((e=>e.isEnabled({resources:this.resources})))},readmeContentModalIsOpen(){return this.$data.$_editReadmeContent_modalOpen},quotaModalIsOpen(){return this.$data.$_editQuota_modalOpen},supportedSpaceImageMimeTypes:()=>se.getSupportedMimeTypes("image/").join(",")},methods:{closeReadmeContentModal(){this.$_editReadmeContent_closeModal()},closeQuotaModal(){this.$_editQuota_closeModal()}}});var Ma=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.readmeContentModalIsOpen?s("readme-content-modal",{attrs:{cancel:e.closeReadmeContentModal,space:e.resources[0]}}):e._e(),e._v(" "),e.quotaModalIsOpen?s("quota-modal",{attrs:{cancel:e.closeQuotaModal,space:e.resources[0]}}):e._e(),e._v(" "),s("input",{ref:"spaceImageInput",attrs:{id:"space-image-upload-input",type:"file",name:"file",tabindex:"-1",accept:e.supportedSpaceImageMimeTypes},on:{change:e.$_uploadImage_uploadImageSpace}}),e._v(" "),s("oc-list",{attrs:{id:"oc-spaces-actions-sidebar","class-name":"oc-mt-s"}},e._l(e.actions,(function(t,i){return s("action-menu-item",{key:"action-"+i,staticClass:"oc-py-xs",attrs:{action:t,items:e.resources}})})),1)],1)};Ma._withStripped=!0;const Oa=e.normalizeComponent({render:Ma,staticRenderFns:[]},undefined,Pa,undefined,false,undefined,!1,void 0,void 0,void 0);const Na={name:"SpaceQuota",props:{spaceQuota:{type:Object,required:!0}},computed:{spaceStorageDetailsLabel(){return this.spaceQuota.total?this.$gettextInterpolate(this.$gettext("%{used} of %{total} used (%{percentage}% used)"),{used:this.quotaUsed,total:this.quotaTotal,percentage:this.quotaUsagePercent}):this.$gettextInterpolate(this.$gettext("%{used} used (no restriction)"),{used:this.quotaUsed})},quotaTotal(){return e.filesize_min(this.spaceQuota.total)},quotaUsed(){return e.filesize_min(this.spaceQuota.used)},quotaUsagePercent(){return parseFloat((this.spaceQuota.used/this.spaceQuota.total*100).toFixed(2))},quotaProgressVariant(){switch(this.spaceQuota.state){case"normal":return"primary";case"nearing":case"critical":return"warning";default:return"danger"}}}};var Ba=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space-quota"},[s("p",{staticClass:"oc-mb-s oc-mt-rm",domProps:{textContent:e._s(e.spaceStorageDetailsLabel)}}),e._v(" "),s("oc-progress",{attrs:{value:e.quotaUsagePercent,max:100,size:"small",variation:e.quotaProgressVariant}})],1)};Ba._withStripped=!0;const Ua=e.normalizeComponent({render:Ba,staticRenderFns:[]},undefined,Na,undefined,false,undefined,!1,void 0,void 0,void 0);const za=e.defineComponent$1({name:"SpaceDetails",components:{SpaceQuota:Ua},inject:["displayedItem"],setup(){const t=s.useStore(),a=s.useAccessToken({store:t}),r=e.ref("");return{loadImageTask:e.q((function*(t,l){if(!l.space?.spaceImageData)return void(r.value=void 0);const c=decodeURI(l.space.spaceImageData.webDavUrl).split("/"),d=c.find((e=>e.startsWith(l.space.id)));if(!d)return;const h=c.slice(c.indexOf(d)+1).join("/"),u=yield l.$client.files.fileInfo(i.buildWebDavSpacesPath(d,decodeURIComponent(h))),p=s.buildResource(u);r.value=yield o.loadPreview({resource:p,isPublic:!1,dimensions:S.Preview,server:n.configurationManager.serverUrl,userId:l.user.id,token:e.unref(a)})})),spaceImage:r}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators","currentFileOutgoingLinks"]),...e.mapGetters(["user"]),space(){return this.displayedItem.value},hasShares(){return this.hasMemberShares||this.hasLinkShares},shareLabel(){if(this.hasMemberShares&&!this.hasLinkShares)return this.memberShareLabel;if(!this.hasMemberShares&&this.hasLinkShares)return this.linkShareLabel;switch(this.memberShareCount){case 1:return this.$gettextInterpolate(this.$ngettext("This space has one member and %{linkShareCount} link.","This space has one member and %{linkShareCount} links.",this.linkShareCount),{linkShareCount:this.linkShareCount});default:return 1===this.linkShareCount?this.$gettextInterpolate("This space has %{memberShareCount} members and one link.",{memberShareCount:this.memberShareCount}):this.$gettextInterpolate("This space has %{memberShareCount} members and %{linkShareCount} links.",{memberShareCount:this.memberShareCount,linkShareCount:this.linkShareCount})}},openSharesPanelHint(){return this.$gettext("Open share panel")},openSharesPanelLinkHint(){return this.$gettext("Open link list in share panel")},openSharesPanelMembersHint(){return this.$gettext("Open member list in share panel")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected space")},lastModifiedDate(){return((t,s,i=e.DateTime_1.DATETIME_MED)=>z(e.DateTime_1.fromISO(t),s,i))(this.space.mdate,this.$language.current)},ownerUsernames(){const e=this.user?.id;return this.currentFileOutgoingCollaborators.filter((e=>e.role.name===i.spaceRoleManager.name)).map((t=>t.collaborator.name===e?this.$gettextInterpolate(this.$gettext("%{displayName} (me)"),{displayName:t.collaborator.displayName}):t.collaborator.displayName)).join(", ")},hasMemberShares(){return this.memberShareCount>0},hasLinkShares(){return this.linkShareCount>0},memberShareCount(){return this.currentFileOutgoingCollaborators.length},linkShareCount(){return this.currentFileOutgoingLinks.length},memberShareLabel(){return this.$gettextInterpolate(this.$ngettext("This space has %{memberShareCount} member.","This space has %{memberShareCount} members.",this.memberShareCount),{memberShareCount:this.memberShareCount})},linkShareLabel(){return this.$gettextInterpolate(this.$ngettext("%{linkShareCount} link giving access.","%{linkShareCount} links giving access.",this.linkShareCount),{linkShareCount:this.linkShareCount})}},watch:{"space.spaceImageData":{handler(){this.loadImageTask.perform(this)},deep:!0}},mounted(){this.loadImageTask.perform(this)},methods:{expandSharesPanel(){e.bus.publish(s.SideBarEventTopics.setActivePanel,"space-share-item")}}});var qa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-space-details-sidebar"}},[s("div",{staticClass:"oc-space-details-sidebar-image oc-text-center"},[e.loadImageTask.isRunning?s("oc-spinner"):e.spaceImage?s("div",{staticClass:"oc-position-relative"},[s("img",{staticClass:"oc-mb-m",attrs:{src:e.spaceImage,alt:""}})]):s("oc-icon",{staticClass:"space-default-image oc-px-m oc-py-m",attrs:{name:"layout-grid",size:"xxlarge"}})],1),e._v(" "),e.hasShares?s("div",{staticClass:"oc-flex oc-flex-middle oc-mb-m oc-text-small",staticStyle:{gap:"15px"}},[e.hasMemberShares?s("oc-button",{attrs:{appearance:"raw","aria-label":e.openSharesPanelMembersHint},on:{click:e.expandSharesPanel}},[s("oc-icon",{attrs:{name:"group"}})],1):e._e(),e._v(" "),e.hasLinkShares?s("oc-button",{attrs:{appearance:"raw","aria-label":e.openSharesPanelLinkHint},on:{click:e.expandSharesPanel}},[s("oc-icon",{attrs:{name:"link"}})],1):e._e(),e._v(" "),s("p",{domProps:{textContent:e._s(e.shareLabel)}}),e._v(" "),s("oc-button",{attrs:{appearance:"raw","aria-label":e.openSharesPanelHint,size:"small"},on:{click:e.expandSharesPanel}},[s("span",{staticClass:"oc-text-small",domProps:{textContent:e._s(e.$gettext("Show"))}})])],1):e._e(),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Last activity"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.lastModifiedDate)}})]),e._v(" "),e.space.description?s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Subtitle"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.space.description)}})]):e._e(),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Manager"))}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.ownerUsernames)}})])]),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Quota"))}}),e._v(" "),s("td",[s("space-quota",{attrs:{"space-quota":e.space.spaceQuota}})],1)])])])};qa._withStripped=!0;const Ha=e.normalizeComponent({render:qa,staticRenderFns:[]},undefined,za,"data-v-d170ac6e",false,undefined,!1,void 0,void 0,void 0);const Ga={name:"Files",id:"files",icon:"resource-type-folder",isFileEditor:!1,extensions:[],fileSideBars:[({rootFolder:e,highlightedFile:t})=>({app:"no-selection-item",icon:"questionnaire-line",title:"Details",component:Aa,default:()=>!0,get enabled(){return e&&"space"!==t?.type}}),({router:e,multipleSelection:t,rootFolder:i})=>({app:"details-item",icon:"questionnaire-line",title:"Details",component:Ci,default:!s.isLocationTrashActive(e,"files-trash-personal")&&!s.isLocationTrashActive(e,"files-trash-spaces-project"),get enabled(){return!(s.isLocationTrashActive(e,"files-trash-personal")||s.isLocationTrashActive(e,"files-trash-spaces-project")||t||i)}}),({multipleSelection:e,rootFolder:t})=>({app:"details-multiple-item",icon:"questionnaire-line",title:"Details",component:Ri,default:()=>!0,get enabled(){return e&&!t}}),({router:e,highlightedFile:t})=>({app:"details-space-item",icon:"questionnaire-line",title:"Details",component:Ha,default:s.isLocationSpacesActive(e,"files-spaces-projects"),get enabled(){return"space"===t?.type}}),({router:e,multipleSelection:t,rootFolder:i})=>({app:"actions-item",icon:"slideshow-3",title:"Actions",component:Fi,default:s.isLocationTrashActive(e,"files-trash-personal")||s.isLocationTrashActive(e,"files-trash-spaces-project"),get enabled(){return!t&&!i}}),({highlightedFile:e,user:t})=>({app:"space-actions-item",icon:"slideshow-3",title:"Actions",component:Oa,get enabled(){return"space"===e?.type&&[...e.spaceRoles[i.spaceRoleManager.name],...e.spaceRoles[i.spaceRoleEditor.name]].includes(t.uuid)}}),({capabilities:e,router:t,multipleSelection:i,rootFolder:a})=>({app:"sharing-item",icon:"user-add",iconFillType:"line",title:"Shares",component:Ta,componentAttrs:{showSpaceMembers:!1,get showLinks(){return!!e.files_sharing&&e.files_sharing.public.enabled}},get enabled(){return!i&&!a&&(!(s.isLocationTrashActive(t,"files-trash-personal")||s.isLocationTrashActive(t,"files-trash-spaces-project")||s.isLocationPublicActive(t,"files-public-files"))&&(!!e.files_sharing&&e.files_sharing.api_enabled))}}),({highlightedFile:e,capabilities:t})=>({app:"space-share-item",icon:"group",title:"Members",component:Ta,componentAttrs:{showSpaceMembers:!0,get showLinks(){return!!t.files_sharing&&t.files_sharing.public.enabled}},get enabled(){return"space"===e?.type}}),({capabilities:e,highlightedFile:t,router:i,multipleSelection:a,rootFolder:r})=>({app:"versions-item",icon:"git-branch",title:"Versions",component:Di,get enabled(){return!a&&!r&&(!(s.isLocationTrashActive(i,"files-trash-personal")||s.isLocationTrashActive(i,"files-trash-spaces-project")||s.isLocationPublicActive(i,"files-public-files"))&&(!!e.core&&t&&"folder"!==t.type))}})]},ja=[{name:e=>e.spaces?.enabled?"Personal":"All files",icon:Ga.icon,route:{path:`/${Ga.id}/spaces/personal`}},{name:"Favorites",icon:"star",route:{path:`/${Ga.id}/favorites`},enabled:e=>e.files&&e.files.favorites},{name:"Shares",icon:"share-forward",route:{path:`/${Ga.id}/shares`},activeFor:[{path:`/${Ga.id}/spaces/shares`}],enabled:e=>!1!==e.files_sharing?.api_enabled},{name:"Spaces",icon:"layout-grid",route:{path:`/${Ga.id}/spaces/projects`},enabled:e=>e.spaces&&!0===e.spaces.projects},{name:"Deleted files",icon:"delete-bin-5",route:{path:`/${Ga.id}/trash`},enabled:e=>e.dav&&"1.0"===e.dav.trashbin}];var Va;return{appInfo:Ga,store:ri,routes:(Va={App:_,Favorites:pt,Personal:Qt,FilesDrop:xt,PrivateLink:Ct,PublicFiles:Gt,SearchResults:l.__vue_component__,SharedResource:Xt,SharedViaLink:ps,SharedWithMe:rs,SharedWithOthers:cs,Spaces:{Project:Os,Projects:Js,Trashbin:Hs},Trashbin:Xs},[g,...s.buildRoutes(Va),...s.buildRoutes$1(Va),...s.buildRoutes$2(Va),...s.buildRoutes$3(Va),...s.buildRoutes$4(Va),...s.buildRoutes$5(Va),...[{path:"/list",redirect:e=>s.createLocationSpaces("files-spaces-personal",{...e,params:{...e.params,storageId:"home"}})},{path:"/list/all/:item*",redirect:e=>s.createLocationSpaces("files-spaces-personal",{...e,params:{...e.params,storageId:"home"}})},{path:"/list/favorites",redirect:e=>s.createLocationCommon("files-common-favorites",e)},{path:"/list/shared-with-me",redirect:e=>s.createLocationShares("files-shares-with-me",e)},{path:"/list/shared-with-others",redirect:e=>s.createLocationShares("files-shares-with-others",e)},{path:"/list/shared-via-link",redirect:e=>s.createLocationShares("files-shares-via-link",e)},{path:"/trash-bin",redirect:e=>s.createLocationTrash("files-trash-personal",e)},{path:"/public/list/:item*",meta:{auth:!1},redirect:e=>s.createLocationPublic("files-public-files",e)},{path:"/private-link/:fileId",meta:{auth:!1},redirect:e=>s.createLocationOperations("files-operations-resolver-private-link",e)},{path:"/public-link/:token",meta:{auth:!1},redirect:e=>({name:"resolvePublicLink",params:{token:e.params.token}})}].map(f)]),navItems:ja,quickActions:Ee,translations:s.translations,ready({router:t,store:s}){ie.filterSearch=new hi(s,t),ie.sdkSearch=new xi(s,t),e.bus.publish("app.search.register.provider",ie.filterSearch),e.bus.publish("app.search.register.provider",ie.sdkSearch),te.initialize(s.getters.configuration.server||window.location.origin,e.get(s,"getters.capabilities.files.archivers",[{enabled:!0,version:"1.0.0",formats:["tar","zip"],archiver_url:`${s.getters.configuration.server}index.php/apps/files/ajax/download.php`}])),se.initialize(e.get(s,"getters.capabilities.files.thumbnail",{enabled:!0,version:"v0.1",supportedMimeTypes:s.getters.configuration?.options?.previewFileMimeTypes||[]}))}}}));
