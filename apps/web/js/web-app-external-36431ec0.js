define(["./chunks/vendor-e2ecbc23","./chunks/useAppDefaults-5dde407f","./chunks/useClientService-0039200a","./chunks/functions-31457630","./chunks/useRoute-035af8cd","./chunks/useRequest-915f01e1"],(function(e,t,r,a,i,n){"use strict";var s={cs:{},de:{'"%{appName}" app content area':'"%{appName}" Anwendungsinhaltsbereich','"%{appName}" app page':'"%{appName}" Anwendungsseite',"Error in app server response":"Fehler in der Antwort des App-Servers","Error retrieving file information":"Datei-Informationen konnten nicht geladen werden","Loading app":"Lade Anwendung"},es:{},fr:{'"%{appName}" app content area':'Zone de contenu de l\'application "%{appName}"','"%{appName}" app page':'page de l\'application "%{appName}"',"Error in app server response":"Erreur dans la réponse du serveur","Error retrieving file information":"Erreur lors de la récupération des informations du fichier","Loading app":"Chargement de l'app"},gl:{},it:{"Loading app":"Caricamento app"}};const o={name:"ErrorScreen",props:{message:{default:"",type:String,required:!1}}};var p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-icon",{attrs:{size:"xxlarge",name:"error-warning","fill-type":"line"}}),e._v(" "),e.message?r("p",{staticClass:"oc-text-xlarge"},[e._v(e._s(e.message))]):e._e()],1)};p._withStripped=!0;const l=e.normalizeComponent({render:p,staticRenderFns:[]},undefined,o,undefined,false,undefined,!1,void 0,void 0,void 0);const c={name:"LoadingScreen"};var d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-spinner",{attrs:{size:"xlarge"}}),e._v(" "),r("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-invisible"},[e._v("Loading app")])],1)};d._withStripped=!0;const m=e.normalizeComponent({render:d,staticRenderFns:[]},undefined,c,undefined,false,undefined,!1,void 0,void 0,void 0);const h=e.defineComponent({name:"ExternalApp",components:{ErrorScreen:l,LoadingScreen:m},setup(){const a=r.useRouteQuery("app"),i=e.computed((()=>r.queryItemAsString(e.unref(a))));return{...t.useAppDefaults({applicationId:"external",applicationName:i}),applicationName:i}},data:()=>({loading:!1,loadingError:!1,errorMessage:"",appUrl:"",method:"",formParameters:{}}),computed:{...e.mapGetters(["capabilities","configuration"]),pageTitle(){const e=this.$gettext('"%{appName}" app page');return this.$gettextInterpolate(e,{appName:this.applicationName})},iFrameTitle(){const e=this.$gettext('"%{appName}" app content area');return this.$gettextInterpolate(e,{appName:this.applicationName})},fileId(){return this.$route.query.fileId}},async created(){this.loading=!0;try{const e=this.currentFileContext.path,t=this.fileId||(await this.getFileResource(e)).fileId,r=this.configuration.server,a=r+this.capabilities.files.app_providers[0].open_url.replace(/^\/+/,"")+`?file_id=${t}`+(this.applicationName?`&app_name=${this.applicationName}`:""),i=await this.makeRequest("POST",a);if(200!==i.status)return this.errorMessage=i.message,this.loading=!1,this.loadingError=!0,void console.error("Error fetching app information",i.status,this.errorMessage);if(!i.data.app_url||!i.data.method)return this.errorMessage=this.$gettext("Error in app server response"),this.loading=!1,this.loadingError=!0,void console.error("Error in app server response");this.appUrl=i.data.app_url,this.method=i.data.method,i.data.form_parameters&&(this.formParameters=i.data.form_parameters),"POST"===this.method&&this.formParameters&&this.$nextTick((()=>this.$refs.subm.click())),this.loading=!1}catch(e){this.errorMessage=this.$gettext("Error retrieving file information"),console.error("Error retrieving file information",e),this.loading=!1,this.loadingError=!0}}});var u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",{staticClass:"oc-height-1-1",class:{"oc-flex oc-flex-center oc-flex-middle":e.loading||e.loadingError}},[r("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),e.loading?r("loading-screen"):e.loadingError?r("error-screen",{attrs:{message:e.errorMessage}}):e._e(),e._v(" "),e.appUrl&&"GET"===e.method?r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{src:e.appUrl,title:e.iFrameTitle,allowfullscreen:""}}):e._e(),e._v(" "),e.appUrl&&"POST"===e.method&&e.formParameters?r("div",{staticClass:"oc-height-1-1"},[r("form",{attrs:{action:e.appUrl,target:"app-iframe",method:"post"}},[r("input",{ref:"subm",staticClass:"oc-hidden",attrs:{type:"submit"},domProps:{value:e.formParameters}}),e._v(" "),e._l(e.formParameters,(function(e,t,a){return r("div",{key:a},[r("input",{attrs:{name:t,type:"hidden"},domProps:{value:e}})])}))],2),e._v(" "),r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{name:"app-iframe",title:e.iFrameTitle,allowfullscreen:""}})]):e._e()],1)};u._withStripped=!0;return{appInfo:{name:"External",id:"external"},routes:[{name:"apps",path:"/:filePath*",component:e.normalizeComponent({render:u,staticRenderFns:[]},undefined,h,undefined,false,undefined,!1,void 0,void 0,void 0),meta:{auth:!1,patchCleanPath:!0}}],store:{namespaced:!0,state:{mimeTypes:[]},actions:{async fetchMimeTypes({rootGetters:e,commit:t}){if(!e.capabilities.files.app_providers[0]?.enabled)return;const r=e.configuration.server+e.capabilities.files.app_providers[0].apps_url.replace("/app","app"),a=await fetch(r);if(!a.ok)throw new Error("Error fetching app provider MIME types");const{"mime-types":i}=await a.json();t("SET_MIME_TYPES",i)}},mutations:{SET_MIME_TYPES(e,t){e.mimeTypes=t}},getters:{mimeTypes:e=>e.mimeTypes}},translations:s,ready({store:e}){e.dispatch("External/fetchMimeTypes")}}}));
