define(["exports","./vendor-e2ecbc23"],(function(e,t){"use strict";class i{static Internal=0;static Read=1;static Update=2;static Create=4;static Delete=8;static Share=16}class s{_key;_bit;_label;constructor(e,t,i){this._key=e,this._bit=t,this._label=i}get key(){return this._key}get bit(){return this._bit}get label(){return this._label}enabled(e){return(e&this.bit)>0}}class a{static internal=new s("internal",i.Internal,"Internal");static read=new s("read",i.Read,"Read");static update=new s("update",i.Update,"Update");static create=new s("create",i.Create,"Create");static delete=new s("delete",i.Delete,"Delete");static share=new s("share",i.Share,"Share");static permissionsToBitmask(e){return(e||[]).reduce(((e,t)=>e|t.bit),0)}static bitmaskToPermissions(e){return[this.read,this.update,this.create,this.delete,this.share].reduce(((t,i)=>(i.enabled(e)&&t.push(i),t)),[])}}class n{_name;_folder;_label;_inlineLabel;_icon;_permissions;constructor(e,t,i,s,a,n){this._name=e,this._folder=t,this._label=i,this._inlineLabel=s,this._icon=a,this._permissions=n}get key(){return`${this._name}-${this._folder?"folder":"file"}`}get name(){return this._name}get folder(){return this._folder}get label(){return this._label}get inlineLabel(){return this._inlineLabel}get hasCustomPermissions(){return!1}get icon(){return this._icon}permissions(e){return this._permissions.filter((t=>t!==a.share||e))}bitmask(e){return a.permissionsToBitmask(this.permissions(e))}hasPermission(e,t=!1){return this.permissions(t).filter((t=>t.bit===e.bit)).length>0}}class r extends n{get hasCustomPermissions(){return!0}description(e){return"Set detailed permissions"}}class l extends n{description(e){return P[this.bitmask(e)]}}class o extends n{description(e){switch(this.name){case D.name:return"Download and preview";case S.name:return"Upload, edit, delete, download and preview";case U.name:return"Upload, edit, delete, download, preview and share"}}}class d extends n{description(e){return I[this.bitmask(e)]}}const c=new l("viewer",!1,"Viewer","viewer","eye",[a.read,a.share]),u=new l("viewer",!0,"Viewer","viewer","eye",[a.read,a.share]),h=new l("editor",!1,"Editor","editor","pencil",[a.read,a.update,a.share]),p=new l("editor",!0,"Editor","editor","pencil",[a.read,a.update,a.create,a.delete,a.share]),m=new r("custom",!1,"Custom permissions","custom permissions","settings-3",[a.read,a.update,a.share]),w=new r("custom",!0,"Custom permissions","custom permissions","settings-3",[a.read,a.update,a.create,a.delete,a.share]),b=new d("none",!1,"Internal","internal","user",[a.internal]),f=new d("none",!0,"Internal","internal","user",[a.internal]),g=new d("viewer",!1,"Viewer","viewer","eye",[a.read]),v=new d("viewer",!0,"Viewer","viewer","eye",[a.read]),k=new d("contributor",!0,"Contributor","contributor","user-settings",[a.read,a.create]),_=new d("editor",!1,"Editor","editor","pencil",[a.read,a.update]),R=new d("editor",!0,"Editor","editor","pencil",[a.read,a.update,a.create,a.delete]),y=new d("uploader",!0,"Uploader","uploader","upload",[a.create]),D=new o("viewer",!1,"Viewer","viewer","eye",[a.read]),S=new o("editor",!1,"Editor","editor","pencil",[a.read,a.update,a.create,a.delete]),U=new o("manager",!1,"Manager","manager","user",[a.read,a.update,a.create,a.delete,a.share]);class B{static all=[D,S,U];static list(){return this.all}static getByBitmask(e){return this.all.find((t=>t.bitmask(!0)===e))}}class C{static all=[c,u,h,p];static allWithCustom=[...this.all,m,w];static list(e,t=!0){return(t?this.allWithCustom:this.all).filter((t=>t.folder===e))}static custom(e){return this.allWithCustom.find((t=>t.folder===e&&t.hasCustomPermissions))}static getByBitmask(e,t,i){return this.allWithCustom.filter((e=>!e.hasCustomPermissions)).find((s=>s.folder===t&&s.bitmask(i)===e))||this.custom(t)}static filterByBitmask(e,t,i,s){const a=this.all.filter((s=>s.folder===t&&e===(e|s.bitmask(i))));if(s){const e=[m,w];return[...a,...e.filter((e=>e.folder===t))]}return a}}const P={[c.bitmask(!1)]:"Download and preview",[c.bitmask(!0)]:"Download, preview and share",[u.bitmask(!1)]:"Download and preview",[u.bitmask(!0)]:"Download, preview and share",[h.bitmask(!1)]:"Edit, download and preview",[h.bitmask(!0)]:"Edit, download, preview and share",[p.bitmask(!1)]:"Upload, edit, delete, download and preview",[p.bitmask(!0)]:"Upload, edit, delete, download, preview and share"},I={[b.bitmask(!1)]:"People need to be invited and login is required",[f.bitmask(!1)]:"People need to be invited and login is required",[g.bitmask(!1)]:"Recipients can view and download contents.",[v.bitmask(!1)]:"Recipients can view and download contents.",[k.bitmask(!1)]:"Recipients can view, download and upload contents.",[_.bitmask(!1)]:"Recipients can view, download and edit contents.",[R.bitmask(!1)]:"Recipients can view, download, edit, delete and upload contents.",[y.bitmask(!1)]:"Recipients can upload but existing contents are not revealed."};var E;e.ShareStatus=void 0,(E=e.ShareStatus||(e.ShareStatus={}))[E.accepted=0]="accepted",E[E.pending=1]="pending",E[E.declined=2]="declined";class T{_key;_value;_label;_icon;constructor(e,t,i,s){this._key=e,this._value=t,this._label=i,this._icon=s}get key(){return this._key}get value(){return this._value}get label(){return this._label}get icon(){return this._icon}}class V{static user=new T("user",0,"User","user");static group=new T("group",1,"Group","group");static link=new T("link",3,"Link","link");static guest=new T("guest",4,"Guest","global");static remote=new T("remote",6,"Federated","earth");static space=new T("space",7,"User","user");static individuals=[this.user,this.guest,this.remote,this.space];static collectives=[this.group];static unauthenticated=[this.link];static authenticated=[this.user,this.group,this.guest,this.remote,this.space];static all=[this.user,this.group,this.link,this.guest,this.remote,this.space];static isIndividual(e){return this.individuals.includes(e)}static isCollective(e){return this.collectives.includes(e)}static isUnauthenticated(e){return this.unauthenticated.includes(e)}static isAuthenticated(e){return this.authenticated.includes(e)}static getByValue(e){return this.all.find((t=>t.value===e))}static getValues(e){return e.map((e=>e.value))}static containsAnyValue(e,i){return t.intersection(this.getValues(e),i).length>0}}function x(e,t){return"/"+`spaces/${e}/${t}`.split("/").filter(Boolean).join("/")}const L=e=>e.replace(/[^A-Za-z0-9\-_]/g,"");e.LinkShareRoles=class{static all=[g,v,k,R,y];static list(e,t=!1,i=!1){return[...i?[b,f]:[],...this.all,...t?[_]:[]].filter((t=>t.folder===e))}static getByBitmask(e,t){return[...this.all,_,b,f].find((i=>i.folder===t&&i.bitmask(!1)===e))}static filterByBitmask(e,t,i=!1,s=!1){return[...s?[b,f]:[],...this.all,...i?[_]:[]].filter((i=>i.folder===t&&e===(e|i.bitmask(!1))))}},e.PeopleShareRoles=C,e.SharePermissionBit=i,e.SharePermissions=a,e.ShareTypes=V,e.SpacePeopleShareRoles=B,e.buildSpace=function(e){let t,i,s=!1;const a=Object.fromEntries(B.list().map((e=>[e.name,[]])));if(e.special&&(t=e.special.find((e=>"image"===e.specialFolder.name)),i=e.special.find((e=>"readme"===e.specialFolder.name)),t&&(t.webDavUrl=decodeURI(t.webDavUrl)),i&&(i.webDavUrl=decodeURI(i.webDavUrl))),e.root?.permissions){for(const t of e.root.permissions)for(const e of B.list())t.roles.includes(e.name)&&a[e.name].push(...t.grantedTo.map((e=>e.user.id)));e.root.deleted&&(s="trashed"===e.root.deleted?.state)}return{id:e.id,fileId:e.id,storageId:e.id,mimeType:"",name:e.name,description:e.description,extension:"",path:"",webDavPath:x(e.id,""),driveType:e.driveType,type:"space",isFolder:!0,mdate:e.lastModifiedDateTime,size:"",indicators:[],permissions:"",starred:!1,etag:"",sharePermissions:"",shareTypes:[],privateLink:"",downloadURL:"",ownerDisplayName:"",ownerId:e.owner?.user?.id,disabled:s,spaceQuota:e.quota,spaceRoles:a,spaceMemberIds:Object.values(a).reduce(((e,t)=>e.concat(t)),[]),spaceImageData:t,spaceReadmeData:i,canUpload:function({user:e}={}){const t=[...this.spaceRoles[U.name],...this.spaceRoles[S.name]];return e&&t.includes(e.uuid)},canDownload:function(){return!0},canBeDeleted:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return this.disabled&&e&&t.includes(e.uuid)},canRename:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return e&&t.includes(e.uuid)},canEditDescription:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return e&&t.includes(e.uuid)},canRestore:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return this.disabled&&e&&t.includes(e.uuid)},canDisable:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return!this.disabled&&e&&t.includes(e.uuid)},canShare:function({user:e}={}){const t=[...this.spaceRoles[U.name]];return e&&t.includes(e.uuid)},canEditImage:function({user:e}={}){const t=[...this.spaceRoles[U.name],...this.spaceRoles[S.name]];return e&&t.includes(e.uuid)},canEditReadme:function({user:e}={}){const t=[...this.spaceRoles[U.name],...this.spaceRoles[S.name]];return e&&t.includes(e.uuid)},canCreate:function(){return!0},isMounted:function(){return!0},isReceivedShare:function(){return!1},getDomSelector:()=>L(e.id)}},e.buildWebDavSpacesPath=x,e.extractDomSelector=L,e.linkRoleUploaderFolder=y,e.spaceRoleEditor=S,e.spaceRoleManager=U,e.spaceRoleViewer=D}));
