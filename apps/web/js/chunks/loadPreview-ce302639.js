define(["exports","./manager-1f78e82e","./useClientService-0039200a","./vendor-e2ecbc23"],(function(e,i,s,n){"use strict";const r=e=>n.lib.stringify({scalingup:e.scalingup||0,preview:Object.hasOwnProperty.call(e,"preview")?e.preview:1,a:Object.hasOwnProperty.call(e,"a")?e.a:1,...e.etag&&{c:e.etag.replaceAll('"',"")},...e.dimensions&&e.dimensions[0]&&{x:e.dimensions[0]},...e.dimensions&&e.dimensions[1]&&{y:e.dimensions[1]}}),t=async(e,n=!1)=>{if(n)return o(e);const t=[e.server,"remote.php/dav",i.encodePath(e.resource.webDavPath),"?",r({etag:e.resource.etag,dimensions:e.dimensions})].join("");try{const{data:i}=await s.clientService.httpAuthenticated(e.token).get(t,{responseType:"blob"});return window.URL.createObjectURL(i)}catch(e){}},o=async e=>{const i=s.cacheService.filePreview.get(e.resource.id);if(i&&i.etag===e.resource.etag&&n.isEqual(e.dimensions,i.dimensions))return i.src;try{const i=await t(e);return s.cacheService.filePreview.set(e.resource.id,{src:i,etag:e.resource.etag,dimensions:e.dimensions},0).src}catch(e){}};e.loadPreview=async({resource:e,isPublic:i,dimensions:n,server:o,userId:a,token:c},d=!1)=>{let u="";return"folder"!==e.type&&e.extension&&(i||o&&a&&c)?(u=i?await(async e=>{const[i,n]=e.resource.downloadURL.split("?"),t=[i,[r({etag:e.resource.etag,dimensions:e.dimensions}),n].filter(Boolean).join("&")].filter(Boolean).join("?"),{status:o}=await s.clientService.httpUnAuthenticated.head(t);if(404!==o)return t})({resource:e,dimensions:n}):await t({server:o,userId:a,token:c,resource:e,dimensions:n},d),u):u}}));
