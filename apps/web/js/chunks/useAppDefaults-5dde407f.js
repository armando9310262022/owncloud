define(["exports","./vendor-e2ecbc23","./useRoute-035af8cd","./useClientService-0039200a","./useRequest-915f01e1"],(function(e,t,n,i,r){"use strict";function o({store:e,applicationId:n}){return{applicationMeta:t.computed((()=>{const t=e.getters.apps[n];if(!t)throw new Error(`useAppConfig: could not find config for applicationId: ${n}`);return t||{}}))}}function u(e){const n=o(e);return{applicationConfig:t.computed((()=>t.unref(n.applicationMeta).config||{}))}}function s({clientService:{owncloudSdk:e},isPublicLinkContext:n,publicLinkPassword:r}){const o=i.useCapabilityCoreSupportUrlSigning(),u=async(i,o)=>{if(t.unref(n)){const n=await e.publicFiles.download("",i,t.unref(r));n.statusCode=n.status;const u=["arrayBuffer","blob","text"].includes(o?.responseType)?o.responseType:"text";return{response:n,body:await n[u](),headers:{ETag:n.headers.get("etag"),"OC-FileId":n.headers.get("oc-fileid")}}}return e.files.getFileContents(i,{resolveWithResponseObject:!0,noCache:!0,...o})},s=async(i,o)=>t.unref(n)?await e.publicFiles.getFileInfo(i,t.unref(r),o):e.files.fileInfo(i,o);return{getFileContents:u,getUrlForResource:async({webDavPath:i,downloadURL:r},s={})=>{const c=s.signUrlTimeout||86400,l="inline"===(s.disposition||"attachment");let a=!0;if(!r&&!l){let u;u=t.unref(n)?["public-files",i].join("/"):i,r=e.files.getFileUrl(u),t.unref(o)?r=await e.signUrl(r,c):a=!1}if(!a||l){const e=await u(i,{responseType:"blob"});r=URL.createObjectURL(e.body)}return r},revokeUrl:e=>{e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)},getFileInfo:s,getFileResource:async(e,t=i.DavProperties.Default)=>{const n=await s(e,t);return i.buildResource(n)},putFileContents:(i,o,u)=>t.unref(n)?e.publicFiles.putFileContents("",i,t.unref(r),o,u):e.files.putFileContents(i,o,u)}}function c({store:e,currentRoute:n,clientService:{owncloudSdk:r},isPublicLinkContext:o,publicLinkPassword:u}){const s=t.ref(!1),c=t.computed((()=>e.getters["Files/activeFiles"]));return{isFolderLoading:s,loadFolderForFileContext:c=>{const{path:l}=t.unref(c);return(async c=>{if(""===e.getters.activeFile.path){s.value=!0,e.commit("Files/CLEAR_CURRENT_FILES_LIST",null);try{const n=t.unref(o)?r.publicFiles.list(c,t.unref(u),i.DavProperties.PublicLink):r.files.list(c,1,i.DavProperties.Default);let s=await n;s=s.map(i.buildResource),e.commit("Files/LOAD_FILES",{currentFolder:s[0],files:s.slice(1)})}catch(r){if(401===r.statusCode)return i.authService.handleAuthError(t.unref(n));e.commit("Files/SET_CURRENT_FOLDER",null),console.error(r)}s.value=!1}})(t.dirname(t.unref(l)))},activeFiles:c}}function l({store:e,document:n,applicationId:i,applicationName:r,currentFileContext:u}){const s=o({applicationId:i,store:e});!function({document:e,title:n}){t.watch(n,(t=>{e.title=t}),{immediate:!0})}({document:n,title:t.computed((()=>{const n=t.basename(t.unref(t.unref(u).fileName)),i=t.unref(t.unref(s).applicationMeta);return[n,t.unref(r)||i.name||i.id,e.getters.configuration.currentTheme.general.name].filter(Boolean).join(" - ")}))})}e.useAppDefaults=function(e){const o=i.useRouter(),a=i.useStore(),p=n.useRoute(),f=e.clientService??i.useClientService(),d=e.applicationId,m=r.usePublicLinkContext({store:a}),b=r.usePublicLinkPassword({store:a}),F=t.computed((()=>{const e=`/${t.unref(p).params.filePath?.split("/").filter(Boolean).join("/")}`;return{path:e,fileName:t.basename(e),routeName:i.queryItemAsString(t.unref(p).query[i.contextRouteNameKey]),...i.contextQueryToFileContextProps(t.unref(p).query)}}));return l({store:a,document:document,applicationId:d,applicationName:e.applicationName,currentFileContext:F}),{isPublicLinkContext:m,currentFileContext:F,...u({store:a,...e}),...i.useAppNavigation({router:o,currentFileContext:F}),...s({clientService:f,isPublicLinkContext:m,publicLinkPassword:b}),...c({clientService:f,store:a,currentRoute:p,isPublicLinkContext:m,publicLinkPassword:b}),...r.useRequest({clientService:f,store:a,currentRoute:t.unref(p)})}}}));
