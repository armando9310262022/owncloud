define(["./chunks/List-f2d4a9c4","./chunks/vendor-e2ecbc23"],(function(e,t){"use strict";const r={name:"SearchBar",filters:{truncate:t.truncate},data:()=>({term:"",optionsVisible:!1,activeProvider:void 0,providerStore:e.providerStore}),computed:{rangeSupported(){return this.searchResult.range},rangeItems(){return parseInt(this.searchResult.range?.split("/")[1]||0)},showMoreMatches(){return this.rangeSupported&&this.rangeItems>this.searchResult.values.length},moreMatchesText(){const e=this.rangeItems-this.searchResult.values.length;return this.$gettextInterpolate(this.$ngettext("%{moreCount} more result","%{moreCount} more results",e),{moreCount:e})},showNoMatches(){return 0===this.searchResult?.values?.length},availableProviders(){return this.providerStore.availableProviders},searchLabel(){return this.$gettext("Enter search term")}},watch:{$route:{handler(e,r){r&&this.activeProvider&&!this.activeProvider.available&&(this.activeProvider=void 0),this.$nextTick((()=>{if(!this.availableProviders.length)return;const r=t.get(e,"query.term"),i=this.$el.getElementsByTagName("input")[0];i&&r&&(this.term=r,i.value=r)}))},immediate:!0}},asyncComputed:{searchResult:{get(){return this.optionsVisible&&this.activeProvider&&this.activeProvider.previewSearch&&this.activeProvider.previewSearch.available?this.activeProvider.previewSearch.search(this.term):{values:[]}},watch:["term","activeProvider","optionsVisible"]}},created(){window.addEventListener("keyup",this.onEvent),window.addEventListener("focusin",this.onEvent),window.addEventListener("click",this.onEvent)},beforeDestroy(){window.removeEventListener("keyup",this.onEvent),window.removeEventListener("focusin",this.onEvent),window.removeEventListener("click",this.onEvent)},methods:{updateTerm(e){this.term=e,this.activeProvider.updateTerm(e)},resetProvider(){this.optionsVisible=!1,this.availableProviders.forEach((e=>e.reset())),this.$router.go(-1)},activateProvider(e){this.optionsVisible=!1,this.activeProvider=e,e.activate(this.term)},onEvent(e){this.activeProvider||(this.activeProvider=this.availableProviders[0]);const t=this.optionsVisible,r=this.$el.contains(e.target),i=e.target.classList.contains("oc-search-clear"),s=38===e.keyCode,a=40===e.keyCode,o=13===e.keyCode,n=27===e.keyCode,c=this.availableProviders.indexOf(this.activeProvider);if(e.stopPropagation(),this.optionsVisible=!i&&!n&&r,!this.optionsVisible)return;if(o)return void this.activateProvider(this.activeProvider);let l;if((s||a)&&this.availableProviders.length>0&&t){const e=a?c<this.availableProviders.length-1:c>0,t=a?0:this.availableProviders.length-1,r=a?c+1:c-1;l=e?r:t}isNaN(l)||l===c||(this.activeProvider=this.availableProviders[l])}}};var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.availableProviders.length?r("div",{class:{"options-visible":e.optionsVisible&&e.term},attrs:{id:"files-global-search"}},[r("oc-search-bar",{ref:"search",attrs:{id:"files-global-search-bar",label:e.searchLabel,"type-ahead":!0,placeholder:e.searchLabel,"button-hidden":!0},on:{input:e.updateTerm,clear:e.resetProvider}}),e._v(" "),e.optionsVisible&&e.term?r("div",{ref:"options",staticClass:"oc-mt-s oc-rounded",attrs:{id:"files-global-search-options"}},[r("ul",{staticClass:"oc-list oc-list-divider"},[e._l(e.availableProviders,(function(t){return r("li",{key:t.id,staticClass:"provider",class:{selected:!!e.activeProvider&&t.id===e.activeProvider.id},on:{click:function(r){return e.activateProvider(t)}}},[r("oc-icon",{attrs:{name:"search","fill-type":"line","accessible-label":"Search"}}),e._v(" "),r("span",{staticClass:"term"},[e._v(e._s(e._f("truncate")(e.term)))]),e._v(" "),t.label?r("button",{staticClass:"label oc-rounded"},[e._v(e._s(t.label))]):e._e()],1)})),e._v(" "),e.$asyncComputed.searchResult.updating?r("li",{staticClass:"loading spinner"},[r("oc-spinner",{attrs:{size:"small","aria-hidden":!0,"aria-label":""}})],1):e._e(),e._v(" "),e.$asyncComputed.searchResult.updating?e._e():[e._l(e.searchResult.values,(function(t,i){return r("li",{key:t.id,staticClass:"preview",class:{first:0===i},on:{click:function(r){return e.activeProvider.previewSearch.activate(t)}}},[r(e.activeProvider.previewSearch.component,{tag:"component",attrs:{provider:e.activeProvider,"search-result":t}})],1)})),e._v(" "),e.showNoMatches?r("li",{staticClass:"oc-text-center oc-text-muted",attrs:{id:"no-matches"},domProps:{textContent:e._s(e.$gettext("No result"))}}):e._e(),e._v(" "),e.showMoreMatches?r("li",{staticClass:"oc-text-center oc-text-muted",attrs:{id:"more-matches"}},[e._v("\n          "+e._s(e.moreMatchesText)+"\n        ")]):e._e()]],2)]):e._e()],1):r("div")};i._withStripped=!0;const s=t.normalizeComponent({render:i,staticRenderFns:[]},undefined,r,undefined,false,undefined,!1,void 0,void 0,void 0);const a={name:"Search"};var o=function(){var e=this.$createElement,t=this._self._c||e;return t("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"search"}},[t("router-view",{attrs:{id:"search-view"}})],1)};o._withStripped=!0;const n=t.normalizeComponent({render:o,staticRenderFns:[]},undefined,a,undefined,false,undefined,!1,void 0,void 0,void 0);var c={cs:{Search:"Hledat"},de:{"%{moreCount} more result":["%{moreCount} weiteres Ergebnis","%{moreCount} weitere Ergebnisse"],"Enter search term":"Suchbegriff eingeben","No result":"Keine Ergebnisse",Search:"Suchen"},es:{"Enter search term":"Introduzca termino de búsqueda",Search:"Buscar"},fr:{"Enter search term":"Saisissez le terme à rechercher",Search:"Recherche"},gl:{Search:"Buscar"},it:{}};return t.bus.subscribe("app.search.register.provider",(t=>{e.providerStore.addProvider(t)})),{appInfo:{name:"Search",id:"search",icon:"folder"},routes:[{name:"search",path:"/",component:n,children:[{name:"provider-list",path:"list/:page?",component:e.__vue_component__,meta:{contextQueryItems:["term","provider"]}}]}],translations:c,mounted({portal:e}){e.open("runtime","header",1,[s])}}}));
